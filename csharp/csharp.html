<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>C#基础 | Coder XX</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="stylesheet" href="styles/index.styl">
    <link rel="icon" href="favicon.ico">
    <meta name="description" content="">
    
    <link rel="preload" href="/blog/assets/css/0.styles.cd12c23a.css" as="style"><link rel="preload" href="/blog/assets/js/app.65a534cf.js" as="script"><link rel="preload" href="/blog/assets/js/2.9b17f659.js" as="script"><link rel="preload" href="/blog/assets/js/10.b6e5bbc7.js" as="script"><link rel="prefetch" href="/blog/assets/js/11.21536efd.js"><link rel="prefetch" href="/blog/assets/js/12.f992f6db.js"><link rel="prefetch" href="/blog/assets/js/13.3553f0d1.js"><link rel="prefetch" href="/blog/assets/js/14.04d611c8.js"><link rel="prefetch" href="/blog/assets/js/15.20c1edb0.js"><link rel="prefetch" href="/blog/assets/js/3.14a7fb2e.js"><link rel="prefetch" href="/blog/assets/js/4.784db7c8.js"><link rel="prefetch" href="/blog/assets/js/5.082bf8bb.js"><link rel="prefetch" href="/blog/assets/js/6.5b8cc223.js"><link rel="prefetch" href="/blog/assets/js/7.0168c993.js"><link rel="prefetch" href="/blog/assets/js/8.061e2d81.js"><link rel="prefetch" href="/blog/assets/js/9.45cddbd3.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.cd12c23a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">Coder XX</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/webfront/HTML.html" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/blog/webfront/CSS.html" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/blog/webfront/JavaScript.html" class="nav-link">
  JS
</a></li><li class="dropdown-item"><!----> <a href="/blog/webfront/jQuery.html" class="nav-link">
  jQuery
</a></li><li class="dropdown-item"><!----> <a href="/blog/webfront/layui.html" class="nav-link">
  layui
</a></li><li class="dropdown-item"><!----> <a href="/blog/webfront/vue.html" class="nav-link">
  Vue
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label=".NET" class="dropdown-title"><span class="title">.NET</span> <span class="arrow down"></span></button> <button type="button" aria-label=".NET" class="mobile-dropdown-title"><span class="title">.NET</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/csharp/csharp.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  C#
</a></li><li class="dropdown-item"><!----> <a href="/blog/csharp/test.html" class="nav-link">
  test
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/webfront/HTML.html" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/blog/webfront/CSS.html" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/blog/webfront/JavaScript.html" class="nav-link">
  JS
</a></li><li class="dropdown-item"><!----> <a href="/blog/webfront/jQuery.html" class="nav-link">
  jQuery
</a></li><li class="dropdown-item"><!----> <a href="/blog/webfront/layui.html" class="nav-link">
  layui
</a></li><li class="dropdown-item"><!----> <a href="/blog/webfront/vue.html" class="nav-link">
  Vue
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label=".NET" class="dropdown-title"><span class="title">.NET</span> <span class="arrow down"></span></button> <button type="button" aria-label=".NET" class="mobile-dropdown-title"><span class="title">.NET</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/csharp/csharp.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  C#
</a></li><li class="dropdown-item"><!----> <a href="/blog/csharp/test.html" class="nav-link">
  test
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>C#基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/csharp/csharp.html#数据类型" class="sidebar-link">数据类型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#值类型-不需要实例化" class="sidebar-link">值类型（不需要实例化）</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#引用类型" class="sidebar-link">引用类型</a></li></ul></li><li><a href="/blog/csharp/csharp.html#枚举enum" class="sidebar-link">枚举enum</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#泛型" class="sidebar-link">泛型</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#interface接口" class="sidebar-link">interface接口</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#抽象工厂模式" class="sidebar-link">抽象工厂模式</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#反射" class="sidebar-link">反射</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#委托" class="sidebar-link">委托</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#事件" class="sidebar-link">事件</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#异步async" class="sidebar-link">异步Async</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#多线程" class="sidebar-link">多线程</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#线程池" class="sidebar-link">线程池</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#task任务" class="sidebar-link">Task任务</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#异步编程async-await" class="sidebar-link">异步编程Async/Await</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#lambda表达式" class="sidebar-link">lambda表达式</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#扩展方法" class="sidebar-link">扩展方法</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#类型转换" class="sidebar-link">类型转换</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#运算符" class="sidebar-link">运算符</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#流程控制" class="sidebar-link">流程控制</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#函数" class="sidebar-link">函数</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#类" class="sidebar-link">类</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#构造函数" class="sidebar-link">构造函数</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#析构函数" class="sidebar-link">析构函数</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#继承" class="sidebar-link">继承</a></li></ul></li><li><a href="/blog/csharp/csharp.html#ado-net" class="sidebar-link">ADO.NET</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#ado通过纯sql语句操作数据库" class="sidebar-link">ADO通过纯sql语句操作数据库</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#ado通过存储过程操作数据库" class="sidebar-link">ADO通过存储过程操作数据库</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#ado通过sql语句-存储过程操作数据库-推荐" class="sidebar-link">ADO通过SQL语句+存储过程操作数据库（推荐）</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#ado中事务的使用" class="sidebar-link">ADO中事务的使用</a></li></ul></li><li><a href="/blog/csharp/csharp.html#webform框架" class="sidebar-link">Webform框架</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#三种解析模板" class="sidebar-link">三种解析模板</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#repeater组件" class="sidebar-link">repeater组件</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#dropdownlist组件" class="sidebar-link">Dropdownlist组件</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#fileupload控件" class="sidebar-link">FileUpload控件</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#webform框架的生命周期" class="sidebar-link">WebForm框架的生命周期</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#一般处理程序" class="sidebar-link">一般处理程序</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#跨域设置" class="sidebar-link">跨域设置</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#母版页" class="sidebar-link">母版页</a></li></ul></li><li><a href="/blog/csharp/csharp.html#富文本编辑器" class="sidebar-link">富文本编辑器</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#哈希表" class="sidebar-link">哈希表</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#session" class="sidebar-link">session</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#cookie" class="sidebar-link">cookie</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#cookie与session的联系" class="sidebar-link">cookie与session的联系</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#cache" class="sidebar-link">Cache</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#i-o读写" class="sidebar-link">I/O读写</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#字符串处理方法" class="sidebar-link">字符串处理方法</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#nuget" class="sidebar-link">Nuget</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#序列化与反序列化" class="sidebar-link">序列化与反序列化</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#xml" class="sidebar-link">XML</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#xpath表达式" class="sidebar-link">XPath表达式</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#远程访问类-webclient" class="sidebar-link">远程访问类（WebClient）</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#html解析库htmlagilitypack" class="sidebar-link">HTML解析库HtmlAgilityPack</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#类库" class="sidebar-link">类库</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#康辉类库的使用" class="sidebar-link">康辉类库的使用</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#webcontrols使用" class="sidebar-link">WebControls使用</a></li></ul></li><li><a href="/blog/csharp/csharp.html#三层架构" class="sidebar-link">三层架构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#实体" class="sidebar-link">实体</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#dal层需掌握的方法" class="sidebar-link">DAL层需掌握的方法：</a></li></ul></li><li><a href="/blog/csharp/csharp.html#orm对象关系映射" class="sidebar-link">ORM对象关系映射</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#ef的创建方式" class="sidebar-link">EF的创建方式</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#通过ef对数据进行增删改查" class="sidebar-link">通过EF对数据进行增删改查</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#ef常用的方法" class="sidebar-link">EF常用的方法</a></li></ul></li><li><a href="/blog/csharp/csharp.html#ienumerable、iqueryable、list" class="sidebar-link">IEnumerable、IQueryable、List</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#mvc框架" class="sidebar-link">MVC框架</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#asp-net-mvc" class="sidebar-link">ASP.NET MVC</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#路由" class="sidebar-link">路由</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#actionresult的常用返回类型" class="sidebar-link">ActionResult的常用返回类型</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#viewdata和viewbag" class="sidebar-link">ViewData和ViewBag</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#viewstart" class="sidebar-link">ViewStart</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#母版页-2" class="sidebar-link">母版页</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#区域" class="sidebar-link">区域</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#静态资源导入" class="sidebar-link">静态资源导入</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#bundler打包" class="sidebar-link">Bundler打包</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#分组视图-用户控件" class="sidebar-link">分组视图（用户控件）</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#控制器接收视图form表单传递的数据" class="sidebar-link">控制器接收视图form表单传递的数据</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#razor" class="sidebar-link">Razor</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#filter拦截器-过滤器" class="sidebar-link">Filter拦截器（过滤器）</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#模型注解" class="sidebar-link">模型注解</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#实现下拉框的绑定和选中" class="sidebar-link">实现下拉框的绑定和选中</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#验证码实现" class="sidebar-link">验证码实现</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#通过路由实现多项搜索" class="sidebar-link">通过路由实现多项搜索</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#mvc插件" class="sidebar-link">MVC插件</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#支付宝沙箱使用" class="sidebar-link">支付宝沙箱使用</a></li></ul></li><li><a href="/blog/csharp/csharp.html#依赖注入di" class="sidebar-link">依赖注入DI</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#控制反转ioc" class="sidebar-link">控制反转IOC</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#autofac" class="sidebar-link">AutoFac</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#automapper" class="sidebar-link">AutoMapper</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#autocomplete" class="sidebar-link">AutoComplete</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#asp-net-webapi框架" class="sidebar-link">ASP.NET WebAPI框架</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#restful协议规范" class="sidebar-link">Restful协议规范</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#特性标签" class="sidebar-link">特性标签</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#特性路由" class="sidebar-link">特性路由</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#配置默认返回类型" class="sidebar-link">配置默认返回类型</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#跨域访问" class="sidebar-link">跨域访问</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#参数的传递" class="sidebar-link">参数的传递</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#swaggerui" class="sidebar-link">SwaggerUI</a></li></ul></li><li><a href="/blog/csharp/csharp.html#asp-net-core" class="sidebar-link">ASP.NET Core</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#托管方式" class="sidebar-link">托管方式</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#appsettings-json文件" class="sidebar-link">appsettings.json文件</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#asp-net内置注入服务" class="sidebar-link">ASP.NET内置注入服务</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#中间件" class="sidebar-link">中间件</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#常用的服务" class="sidebar-link">常用的服务</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#常用中间件" class="sidebar-link">常用中间件</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#asp-net-core-mvc使用" class="sidebar-link">ASP.NET Core MVC使用</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#viewstart和viewimport" class="sidebar-link">ViewStart和ViewImport</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#libman使用" class="sidebar-link">LibMan使用</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#asp-net-core自带的ioc容器" class="sidebar-link">ASP.NET Core自带的IOC容器</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#ef-orm-的使用" class="sidebar-link">EF(ORM)的使用</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#数据迁移" class="sidebar-link">数据迁移</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#种子数据" class="sidebar-link">种子数据</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#sqlsugar-orm-的使用" class="sidebar-link">SqlSugar(ORM)的使用</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#session-2" class="sidebar-link">Session</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#日志记录nlog" class="sidebar-link">日志记录nlog</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#filter拦截器" class="sidebar-link">Filter拦截器</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#获取当前项目路径" class="sidebar-link">获取当前项目路径</a></li></ul></li><li><a href="/blog/csharp/csharp.html#sqlsuger" class="sidebar-link">SqlSuger</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#实体-2" class="sidebar-link">实体</a></li></ul></li><li><a href="/blog/csharp/csharp.html#comet技术" class="sidebar-link">Comet技术</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#socket" class="sidebar-link">Socket</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#websocket" class="sidebar-link">WebSocket</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#" class="sidebar-link">/csharp/csharp.html#</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#singalr" class="sidebar-link">SingalR</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#sqldependency-signalr实现数据即时更新" class="sidebar-link">SqlDependency+SignalR实现数据即时更新</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#jwt-json-web-token" class="sidebar-link">JWT(Json Web Token)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#jwt的结构" class="sidebar-link">JWT的结构</a></li><li class="sidebar-sub-header"><a href="/blog/csharp/csharp.html#使用" class="sidebar-link">使用</a></li></ul></li><li><a href="/blog/csharp/csharp.html#单一职责-single-responsibility-principle" class="sidebar-link">单一职责（Single Responsibility Principle）</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#开闭原则-open-closed-principle" class="sidebar-link">开闭原则（open closed principle）</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#里氏替换" class="sidebar-link">里氏替换</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#迪米特法则" class="sidebar-link">迪米特法则</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#接口隔离" class="sidebar-link">接口隔离</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#依赖倒置dependence-inversion-principle" class="sidebar-link">依赖倒置Dependence Inversion Principle</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/csharp/csharp.html#公共响应参数" class="sidebar-link">公共响应参数</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="c-基础"><a href="#c-基础" class="header-anchor">#</a> C#基础</h1> <div class="language-csharp extra-class"><pre class="language-csharp"><code>Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 	<span class="token comment">// 输出不换行</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 输出自动换行</span>
</code></pre></div><h2 id="数据类型"><a href="#数据类型" class="header-anchor">#</a> 数据类型</h2> <h3 id="值类型-不需要实例化"><a href="#值类型-不需要实例化" class="header-anchor">#</a> 值类型（不需要实例化）</h3> <blockquote><p>int，short，long，float，double，decimal，布尔类型，枚举类型，char，结构</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">short</span></span> n0 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>		<span class="token comment">//-2 16次方 - 2 16次方</span>
<span class="token class-name"><span class="token keyword">int</span></span> n1 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>		<span class="token comment">//-2 32次方 - 2 32次方		大概十位数字以内</span>
<span class="token class-name"><span class="token keyword">long</span></span> n1 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>		<span class="token comment">//-2 64次方 - 2 64次方</span>

<span class="token comment">//float需要以f/F结尾，double需要以d/D结尾，decimal需要以m结尾</span>
<span class="token class-name"><span class="token keyword">float</span></span> f <span class="token operator">=</span> <span class="token number">2.1f</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">double</span></span> d <span class="token operator">=</span> <span class="token number">2.22222d</span><span class="token punctuation">;</span>	<span class="token comment">//不是指小数点后面两位，而是两位及以上都归double管</span>
<span class="token class-name"><span class="token keyword">decimal</span></span> c <span class="token operator">=</span> <span class="token number">3.1m</span><span class="token punctuation">;</span>		<span class="token comment">//framework提供的扩展类型，单精度和双精度都可以用decimal</span>
<span class="token class-name"><span class="token keyword">decimal</span></span> c1 <span class="token operator">=</span> <span class="token number">3.222m</span><span class="token punctuation">;</span>

布尔类型
<span class="token class-name"><span class="token keyword">bool</span></span> res <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token class-name">Boolean</span> res1 <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">char</span></span> char1 <span class="token operator">=</span> <span class="token char">'a'</span><span class="token punctuation">;</span>		<span class="token comment">//单引号，长度只能为1</span>
</code></pre></div><h3 id="引用类型"><a href="#引用类型" class="header-anchor">#</a> 引用类型</h3> <blockquote><p>string，类，数组，接口，委托，事件，抽象类...</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//由于string是一种编程中特别常用的数据类型，所以我们的C# framework CLR公共语言运行平台,帮我们进行的字符串实例化</span>
<span class="token class-name"><span class="token keyword">string</span></span> str1 <span class="token operator">=</span> <span class="token string">&quot;123abc&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> str2 <span class="token operator">=</span> <span class="token string">&quot;asdfgh&quot;</span><span class="token punctuation">;</span>

数组
<span class="token comment">//一维数组</span>
<span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> intList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">int</span></span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>	<span class="token comment">//声明一个整型数组，长度为10</span>
<span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> intList2 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">//声明一个数组，直接赋值，长度就是里面数的个数，不能添加</span>
<span class="token class-name"><span class="token keyword">string</span></span> strList <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token char">'1'</span><span class="token punctuation">,</span><span class="token char">'s'</span><span class="token punctuation">,</span><span class="token char">'a'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//二维数组</span>
<span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token punctuation">]</span></span> intList3 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

类
<span class="token class-name">Student</span> s1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="枚举enum"><a href="#枚举enum" class="header-anchor">#</a> 枚举enum</h2> <p>枚举类型是一种<strong>值类型</strong>，定义好的值会存放到栈中。</p> <p>枚举类型在定义时使用 enum 关键字表示，枚举类型的定义与类成员的定义是一样的，或者直接定义在命名空间中。</p> <p>定义枚举类型的变量的语法形式如下</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>访问修饰符 <span class="token keyword">enum</span> 变量名
<span class="token punctuation">{</span>
  值l<span class="token punctuation">,</span>
  值<span class="token number">2</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>枚举的使用</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">Gender</span>
<span class="token punctuation">{</span>
    男<span class="token punctuation">,</span>
    女
<span class="token punctuation">}</span>

<span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>Gender<span class="token punctuation">.</span>男<span class="token punctuation">;</span> <span class="token comment">// 输出0</span>
<span class="token punctuation">(</span>Gender<span class="token punctuation">)</span><span class="token number">1</span><span class="token punctuation">;</span>	<span class="token comment">//输出女</span>

<span class="token comment">//获取所有枚举成员</span>
<span class="token class-name">Array</span> list<span class="token operator">=</span> Enum<span class="token punctuation">.</span><span class="token function">GetValues</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">Gender</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//['男','女']</span>

<span class="token comment">//获取所有枚举成员的字段名</span>
<span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> foo <span class="token operator">=</span> Enum<span class="token punctuation">.</span><span class="token function">GetNames</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">Gender</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="泛型"><a href="#泛型" class="header-anchor">#</a> 泛型</h2> <blockquote><p>一种宽泛的数据类型</p></blockquote> <p>泛型是程序设计语言的一种特性。允许程序员在强类型程序设计语言中编写代码时定义一些可变部分，那些部分在使用前必须作出指明。各种程序设计语言和其编译器、运行环境对泛型的支持均不一样。将类型参数化以达到代码复用提高软件开发工作效率的一种数据类型。泛型类是引用类型，是堆对象，主要是引入了类型参数这个概念。</p> <p>优点：
1.使用泛型类、方法，我们可以极大提高代码的重用性，不需要对类型不同代码相同（仅类型参数不同）的代码写多次。
2.创建泛型类，可在编译时创建类型安全的集合，存在泛型约束。
3.避免装箱和拆箱操作降低性能，在大型集合中装箱和拆箱的影响非常大。</p> <p>缺点：</p> <p>编写泛型类或者泛型方法的时候，不能获取未来某一个对象中的特殊的一个值</p> <blockquote><p>使用</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token generic-method"><span class="token function">Say</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">T</span> t<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;您传入的参数类型是:</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">t<span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">,参数的值为：</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">t<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></blockquote> <p><strong>泛型约束</strong></p> <p>约束泛型的类型：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">where</span> <span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token type-list"><span class="token keyword">struct</span></span>
<span class="token comment">// 类型参数必须是值类型。可以指定除 Nullable 以外的任何值类型。有关更多信息，请参见使用可以为 null 的类型（C# 编程指南）。</span>
<span class="token keyword">where</span> <span class="token class-name">T</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token keyword">class</span></span>
<span class="token comment">// 类型参数必须是引用类型；这一点也适用于任何类、接口、委托或数组类型。</span>
<span class="token keyword">where</span> <span class="token class-name">T</span>：<span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 类型参数必须具有无参数的公共构造函数。当与其他约束一起使用时，new() 约束必须最后指定。</span>
<span class="token keyword">where</span> <span class="token class-name">T</span>：<span class="token operator">&lt;</span>基类名<span class="token operator">&gt;</span>
<span class="token comment">// 类型参数必须是指定的基类或基类的派生类。</span>
<span class="token keyword">where</span> <span class="token class-name">T</span>：<span class="token operator">&lt;</span>接口名称<span class="token operator">&gt;</span>
<span class="token comment">// 类型参数必须是指定的接口或实现指定的接口。可以指定多个接口约束。约束接口也可以是泛型的。</span>
<span class="token keyword">where</span> <span class="token class-name">T</span>：U
<span class="token comment">// 为 T 提供的类型参数必须是为 U 提供的参数或派生自为 U 提供的参数。</span>
</code></pre></div><p>例：因为在该方法中进行了实例化，所以必须要求类有无参构造函数</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name">T</span> <span class="token generic-method"><span class="token function">ClassFactory</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">where</span> <span class="token class-name">T</span><span class="token punctuation">:</span><span class="token type-list"><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="token punctuation">{</span>
    <span class="token class-name">T</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">T</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> t<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>泛型成员修饰的三个情景</p> <ol><li>泛型方法</li> <li>泛型属性</li> <li>泛型类</li></ol></blockquote> <h2 id="interface接口"><a href="#interface接口" class="header-anchor">#</a> interface接口</h2> <p><strong>应用程序接口API与c#、java的interface接口不是同一个东西，没有一点关系</strong></p> <blockquote><p>概念：一组行为规范，包含一些抽象的成员。</p> <p>作用：</p> <ol><li>约束（继承接口的类必须实现接口中的抽象成员）</li> <li>安全（因为进行了约束，该有的都有所以安全）</li></ol> <p>使用：</p> <ol><li>接口不是直接进行调用的，需要让类进行继承的。</li> <li>接口中的所有成员都是public。</li> <li>当一个类继承接口后，需要实现接口中的<strong>所有</strong>抽象成员。</li></ol></blockquote> <p>接口的声明（接口中声明的类都是安全的类）：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IMyTest</span><span class="token punctuation">{</span>
  <span class="token comment">//4个抽象成员</span>
  <span class="token comment">//索引器</span>
　<span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token class-name"><span class="token keyword">int</span></span> index<span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
　<span class="token comment">//事件</span>
　<span class="token keyword">event</span> <span class="token class-name">EventHandler</span> E <span class="token punctuation">;</span>
　<span class="token comment">//方法</span>
　<span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">F</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> <span class="token keyword">value</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
　<span class="token comment">//属性</span>
　<span class="token return-type class-name"><span class="token keyword">string</span></span> P <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>例：</p> <p><code>IMyTest.cs</code>接口</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IMyTest</span><span class="token punctuation">{</span>
　<span class="token comment">//方法</span>
　<span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Say</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> <span class="token keyword">value</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
　<span class="token comment">//属性</span>
　<span class="token return-type class-name"><span class="token keyword">string</span></span> P <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>Teacher.cs</code>继承接口的类</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Teacher</span><span class="token punctuation">:</span><span class="token type-list"><span class="token class-name">IMyTest</span></span>
<span class="token punctuation">{</span>
    <span class="token comment">//不需要override</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Say</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> a<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        a <span class="token operator">=</span> a <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> P <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>main</code></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//通过接口实例化</span>
<span class="token class-name">IMyTest</span> test1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Teacher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div><h2 id="抽象工厂模式"><a href="#抽象工厂模式" class="header-anchor">#</a> 抽象工厂模式</h2> <p><strong>在实例化某一个类的时候，不直接实例化，而是由抽象工厂（接口）进行实例化。</strong></p> <blockquote><p>优点：</p> <ul><li>安全</li> <li>生产的类一定是受到某种约束</li></ul></blockquote> <blockquote><p><strong>三层架构中的接口层</strong></p> <p>接口层主要是对DAL进行行为约束</p> <p>该模式也叫做：抽象工厂三层架构模式</p></blockquote> <p>简单例子：</p> <p>interfaceDemo项目</p> <h2 id="反射"><a href="#反射" class="header-anchor">#</a> 反射</h2> <p>概念：</p> <ul><li><p>通过反射可以提供<strong>类型信息</strong>，从而使得我们开发人员在运行时能够利用这些信息<strong>构造和使用对象</strong>。</p></li> <li><p>反射机制允许程序在执行过程中动态地添加各种功能。</p> <p>白话：利用反射可以动态的创建出一个类对象，不需要知道类到底是谁。</p></li></ul> <p>反射常用类：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>System<span class="token punctuation">.</span>Reflection<span class="token punctuation">.</span>Assembly 
System<span class="token punctuation">.</span>Reflection<span class="token punctuation">.</span>MemberInfo
System<span class="token punctuation">.</span>Reflection<span class="token punctuation">.</span>EventInfo
System<span class="token punctuation">.</span>Reflection<span class="token punctuation">.</span>MethodInfo	<span class="token comment">//获取方法</span>
System<span class="token punctuation">.</span>Reflection<span class="token punctuation">.</span>PropertyInfo	<span class="token comment">//获取属性</span>
System<span class="token punctuation">.</span>Type						<span class="token comment">//获取类型</span>
</code></pre></div><p>以下是上面几个类的使用方法：
（1）使用Assembly定义和加载程序集，加载在程序集清单中列出模块，以及从此程序集中查找类型并创建该类型的实例。
（2）使用Module了解包含模块的程序集以及模块中的类等，还可以获取在模块上定义的所有全局方法或其他特定的非全局方法。</p> <p>（3）使用ConstructorInfo了解构造函数的名称、参数、访问修饰符（如pulic 或private）和实现详细信息（如abstract或virtual）等。使用Type的GetConstructors或 GetConstructor方法来调用特定的构造函数。
（4）使用MethodInfo了解方法的名称、返回类型、参数、访问修饰符（如pulic 或private）和实现详细信息（如abstract或virtual）等。使用Type的GetMethods或GetMethod方法来调用特定的方法。
（5）使用PropertyInfo了解属性的名称、数据类型、声明类型、反射类型和只读或可写状态等，获取或设置属性值。
（6）使用ParameterInfo了解参数的名称、数据类型、是输入参数还是输出参数，以及参数在方法签名中的位置等。</p> <blockquote><p>简单使用：获取类型、方法、属性、加载程序集、创建对象</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Reflection</span><span class="token punctuation">;</span><span class="token comment">//引入反射框架</span>

<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token generic-method"><span class="token function">ClassInfo</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">where</span> <span class="token class-name">T</span><span class="token punctuation">:</span><span class="token type-list"><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="token punctuation">{</span>
    <span class="token comment">// 通过反射获取类型信息</span>
    <span class="token class-name">Type</span> type <span class="token operator">=</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">T</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 通过反射方法信息</span>
    <span class="token class-name">MethodInfo<span class="token punctuation">[</span><span class="token punctuation">]</span></span> methodInfos <span class="token operator">=</span> type<span class="token punctuation">.</span><span class="token function">GetMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//通过类型获取该类型下的所有方法成员</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">MethodInfo</span> method <span class="token keyword">in</span> methodInfos<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>method<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 通过反射获取属性信息</span>
    <span class="token class-name">PropertyInfo<span class="token punctuation">[</span><span class="token punctuation">]</span></span> propertyInfos <span class="token operator">=</span> type<span class="token punctuation">.</span><span class="token function">GetProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//通过类型获取该类型下的所有属性成员</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">PropertyInfo</span> p <span class="token keyword">in</span> propertyInfos<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 通过反射加载程序集				包文件名</span>
    <span class="token class-name">Assembly</span> ass <span class="token operator">=</span> Assembly<span class="token punctuation">.</span><span class="token function">Load</span><span class="token punctuation">(</span><span class="token string">&quot;KangHui.Common&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">//通过反射创建一个对象</span>
    <span class="token comment">/*
    	Ref re = new Ref();
    	Student stu = re.CreateObject&lt;Student&gt;();
    */</span>
    <span class="token punctuation">(</span>T<span class="token punctuation">)</span>Activator<span class="token punctuation">.</span><span class="token function">CreateInstance</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">T</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>调用程序集中的方法</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//加载程序集</span>
<span class="token class-name">Assembly</span> ass <span class="token operator">=</span> Assembly<span class="token punctuation">.</span><span class="token function">Load</span><span class="token punctuation">(</span><span class="token string">&quot;KangHui.Common&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 创建程序集下指定类的对象，返回值为obj类型</span>
<span class="token class-name"><span class="token keyword">object</span></span> obj <span class="token operator">=</span> ass<span class="token punctuation">.</span><span class="token function">CreateInstance</span><span class="token punctuation">(</span><span class="token string">&quot;KangHui.Common.ConvertHelper&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//获取到对象的类型</span>
<span class="token class-name">Type</span> t <span class="token operator">=</span> obj<span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//得到该类下叫GetInteger的方法</span>
<span class="token class-name">MethodInfo</span> method <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">GetMethod</span><span class="token punctuation">(</span><span class="token string">&quot;GetInteger&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//执行该方法，将执行该方法的对象传进去，所需的参数数组传进去</span>
<span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>method<span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">object</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">{</span> <span class="token string">&quot;234&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>获取属性</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Reflection</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Text</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token generic-method"><span class="token function">GetProp</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">T</span> t<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// 得到传进来的对象类型</span>
    <span class="token class-name">Type</span> type <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 获取类型里面的属性</span>
    <span class="token class-name">PropertyInfo<span class="token punctuation">[</span><span class="token punctuation">]</span></span> pList <span class="token operator">=</span> type<span class="token punctuation">.</span><span class="token function">GetProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">StringBuilder</span> builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 循环遍历属性数组</span>
    <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token class-name">PropertyInfo</span> p <span class="token keyword">in</span> pList<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 判断属性的类型，再决定转换为什么类型</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>PropertyType <span class="token operator">==</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name"><span class="token keyword">int</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            builder<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>Name <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>p<span class="token punctuation">.</span><span class="token function">GetValue</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>PropertyType <span class="token operator">==</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name"><span class="token keyword">string</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            builder<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>Name <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">)</span>p<span class="token punctuation">.</span><span class="token function">GetValue</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;您传入对象类型是:</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">type</span><span class="token punctuation">}</span></span><span class="token string"> 他的</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">builder<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>反射的缺点</strong></p> <p>1.生成meta源文件，让你的DLL文件的体积变大。</p> <p>2.反射会影响程序的性能，因为是在程序运行中编译的</p> <p>java/c#:静态语言</p> <p>执行效率快，预编译 jvm clr</p> <p>运行时编译（不进行预编译）</p> <p>3.不安全  比如：一个泛型方法需要一个class  但是传入的是一个int ，而我们并没有进行泛型约束，那么此时这个程序就报错了。</p> <h2 id="委托"><a href="#委托" class="header-anchor">#</a> 委托</h2> <p>语法：修饰符 delegate 返回值  名称(参数...)</p> <blockquote><p>作用：</p> <ol><li>委托中放入方法 使用委托进行调用</li> <li>可以实现程序的解耦     低耦合</li> <li>C#委托是异步的基础</li></ol></blockquote> <blockquote><p>委托基础</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DelegateClass</span><span class="token punctuation">{</span>
    <span class="token comment">// 定义一个委托</span>
    <span class="token keyword">public</span> <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">NoReturnNoParamHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">//无参无返回值的委托</span>
    <span class="token keyword">public</span> <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">NoReturnHasParamHandler</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//有参无返回值的委托</span>
    <span class="token keyword">public</span> <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">HasReturnHasParamHandler</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//有参有返回值</span>
    <span class="token keyword">public</span> <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">HasReturnNoParamHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">//无参有返回值</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">NoReturnNoParam</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;这是一个没有参数没有返回值的方法&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">NoReturnHasParam</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span><span class="token class-name"><span class="token keyword">int</span></span> age<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;这是一个有参数没有返回值的方法,参数为:&quot;</span><span class="token operator">+</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">HasReturnNoParam</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;HasReturnNoParam&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">100</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">HasReturnHasParam</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">100</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">// 调用</span>
<span class="token comment">//1.实例化委托</span>
<span class="token class-name">DelegateClass<span class="token punctuation">.</span>NoReturnNoParamHandler</span> handler1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DelegateClass<span class="token punctuation">.</span>NoReturnNoParamHandler</span><span class="token punctuation">(</span>函数方法名<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 可以简写为:</span>
<span class="token class-name">DelegateClass<span class="token punctuation">.</span>NoReturnNoParamHandler</span> handler1 <span class="token operator">=</span> 函数方法名<span class="token punctuation">;</span>
<span class="token comment">//2.让委托执行</span>
handler1<span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 有参无返回值</span>
<span class="token class-name">DelegateClass<span class="token punctuation">.</span>NoReturnHasParamHandler</span> handler2 <span class="token operator">=</span> delegateClass<span class="token punctuation">.</span>NoReturnHasParam<span class="token punctuation">;</span>
handler2<span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 无参有返回值</span>
<span class="token class-name">DelegateClass<span class="token punctuation">.</span>HasReturnNoParamHandler</span> handler3 <span class="token operator">=</span> delegateClass<span class="token punctuation">.</span>HasReturnNoParam<span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">int</span></span> result1<span class="token operator">=</span> handler3<span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//有参有返回值</span>
<span class="token class-name">DelegateClass<span class="token punctuation">.</span>HasReturnHasParamHandler</span> handler4 <span class="token operator">=</span> delegateClass<span class="token punctuation">.</span>HasReturnHasParam<span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">int</span></span> result2 <span class="token operator">=</span> handler4<span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>.NET中提供的2种类型的委托</p> <ol><li>Action：管的是没返回值的委托</li> <li>Func：管的是有返回值的委托</li></ol></blockquote> <blockquote><p>Action</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">// 无参无返回</span>
<span class="token class-name">Action</span> action1 <span class="token operator">=</span> delegateClass<span class="token punctuation">.</span>NoReturnNoParam<span class="token punctuation">;</span>
action1<span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 有参无返回</span>
<span class="token class-name">Action<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span> action2 <span class="token operator">=</span> delegateClass<span class="token punctuation">.</span>NoReturnHasParam<span class="token punctuation">;</span>
action2<span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>Func：最后一个参数为返回值类型</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">// 无参有返回</span>
<span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span> action3 <span class="token operator">=</span> delegateClass<span class="token punctuation">.</span>HasReturnNoParam<span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">int</span></span> r1<span class="token operator">=</span>  action3<span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 有参有返回</span>
<span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span> action4  <span class="token operator">=</span> delegateClass<span class="token punctuation">.</span>HasReturnHasParam<span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">int</span></span> r2 <span class="token operator">=</span> action4<span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>委托实现解耦</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GreetClass</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">EnglishGreeting</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Good Morning, &quot;</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ChineseGreeting</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;早上好, &quot;</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">JapaneseGreeting</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;偶哈有, &quot;</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//张嘴</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Say</span><span class="token punctuation">(</span><span class="token class-name">Action<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> handler<span class="token punctuation">,</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//打招呼</span>
        handler<span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">GreetClass</span> gc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">GreetClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gc<span class="token punctuation">.</span><span class="token function">Say</span><span class="token punctuation">(</span>gc<span class="token punctuation">.</span>ChineseGreeting<span class="token punctuation">,</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>多播委托（委托链）</strong></p> <blockquote><p>可以将多个方法赋给同一个委托，或者叫将多个方法绑定到同一个委托，当调用这个委托的时候，将依次调用其所绑定的方法。</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">Action</span> action1 <span class="token operator">=</span> delegateClass<span class="token punctuation">.</span>NoReturnNoParam<span class="token punctuation">;</span>
action1 <span class="token operator">+=</span> delegateClass<span class="token punctuation">.</span>NoReturnNoParam1<span class="token punctuation">;</span>
action1<span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>注意：如果委托是有返回值的，那么我们只能拿到最后一个返回值。</p> <h2 id="事件"><a href="#事件" class="header-anchor">#</a> 事件</h2> <p><strong>事件是委托的一个实例，主要是为了保证委托的安全。</strong></p> <blockquote><p>它封装了委托类型的变量，使得：在类的内部，不管你声明它是public还是protected，它总是private 的。在类的外部，注册“+=”和注销“-=”的访问限定符与你在声明事件时使用的访问符相同</p></blockquote> <p>使用事件的目的：</p> <p>事件应该由事件发布者触发，而不应该由事件的客户端（客户程序）来触发。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EventClass</span>
<span class="token punctuation">{</span>	
    <span class="token comment">//委托的声明</span>
    <span class="token keyword">public</span> <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SayHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//事件：委托的一个实例对象</span>
    <span class="token keyword">public</span> <span class="token keyword">event</span> <span class="token class-name">SayHandler</span> EventSay<span class="token punctuation">;</span>

    <span class="token comment">//类内部来执行事件</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        EventSay<span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//实例化类</span>
<span class="token class-name">EventClass</span> eventC <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">EventClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//给事件加函数</span>
eventC<span class="token punctuation">.</span>EventSay <span class="token operator">+=</span> method1<span class="token punctuation">;</span>
eventC<span class="token punctuation">.</span>EventSay <span class="token operator">+=</span> method2<span class="token punctuation">;</span>
<span class="token comment">//调用类内部的Run方法执行该事件</span>
eventC<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="异步async"><a href="#异步async" class="header-anchor">#</a> 异步Async</h2> <p><strong>并行</strong>：一般指并行计算，是说同一时刻有多条指令同时被执行，这些指令可能执行于<strong>同一CPU的多核上</strong>，或者<strong>多个CPU上</strong>，或者<strong>多个物理主机</strong>甚至<strong>多个网络中</strong>。</p> <p><strong>多线程</strong>，一般指同一进程中多个线程（包含其数据结构、上下文与代码片段）协作运行。在多核计算机中多个线程将有机会同时运行于多个核上，如果线程中进行的是计算，则行成并行计算。</p> <p><strong>异步</strong>，与同步相对应，是指呼叫另一操作后，不等待其结果，继续执行之后的操作，若之后没有其他操作，当前线程将进入睡眠状态，而CPU时间将有机会切至其他线程。在异步操作完成后通过回调函数的方式获取通知与结果。异步的实现方式有多种，如多线程与完成端口。多线程将异步操作放入另一线程中运行，通过轮询或回调方法得到完成通知；完成端口，由操作系统接管异步操作的调度，通过硬件中断，在完成时触发回调方法，此方式不需要占用额外线程。</p> <p>异步特点：</p> <p>1异步不会造成阻塞，同步会阻塞</p> <p>2异步可以启用额外的线程去执行任务。</p> <p>3异步并不会缩短单个任务的时间</p> <p>Stopwatch时间统计类</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Diagnostics</span><span class="token punctuation">;</span>

<span class="token class-name">Stopwatch</span> watch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Stopwatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
watch<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
watch<span class="token punctuation">.</span><span class="token function">Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
watch<span class="token punctuation">.</span>ElapsedMilliseconds<span class="token comment">//执行事件</span>
</code></pre></div><p><strong>异步方法调用</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//无参无返回 BeginInvoke俩参数(回调函数，回调函数参数)</span>
<span class="token class-name">Action</span> action1 <span class="token operator">=</span> 方法名<span class="token punctuation">;</span>
<span class="token comment">//				回调函数，没有为null;传递的参数，没有为null	&quot;参数&quot;，new Object[]{&quot;参数1&quot;,&quot;参数2&quot;}</span>
action1<span class="token punctuation">.</span><span class="token function">BeginInvoke</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>



<span class="token comment">//有参无返回	BeginInvoke三参数(原方法参数，回调函数，回调函数参数)</span>
<span class="token class-name">Action<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> action2 <span class="token operator">=</span> 方法名<span class="token punctuation">;</span>
<span class="token comment">//		方法参数,回调函数，没有为null;传递的参数，没有为null	&quot;参数&quot;，new Object[]{&quot;参数1&quot;,&quot;参数2&quot;}</span>
action2<span class="token punctuation">.</span><span class="token function">BeginInvoke</span><span class="token punctuation">(</span><span class="token string">&quot;方法参数&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>



<span class="token comment">//无参有返回 BeginInvoke俩参数(回调函数，回调函数参数)</span>
<span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> action3 <span class="token operator">=</span> 方法名<span class="token punctuation">;</span>
<span class="token class-name">IAsyncResult</span> result <span class="token operator">=</span> action3<span class="token punctuation">.</span><span class="token function">BeginInvoke</span><span class="token punctuation">(</span>t<span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//EndInvoke函数句柄结束  意味：异步函数执行完成了。得到的是返回值</span>
    <span class="token class-name"><span class="token keyword">string</span></span> res <span class="token operator">=</span> action3<span class="token punctuation">.</span><span class="token function">EndInvoke</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//获取传递给回调函数的参数</span>
    t<span class="token punctuation">.</span>AsyncState
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>



<span class="token comment">//有参数有返回 BeginInvoke三参数(原方法参数，回调函数，回调函数参数)</span>
<span class="token comment">//	参数类型，返回值类型</span>
<span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> action3 <span class="token operator">=</span> 方法名<span class="token punctuation">;</span>
<span class="token class-name">IAsyncResult</span> result <span class="token operator">=</span> action3<span class="token punctuation">.</span><span class="token function">BeginInvoke</span><span class="token punctuation">(</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span>t<span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//EndInvoke函数句柄结束  意味：异步函数执行完成了。得到的是返回值</span>
    <span class="token class-name"><span class="token keyword">string</span></span> res <span class="token operator">=</span> action3<span class="token punctuation">.</span><span class="token function">EndInvoke</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//获取传递给回调函数的参数</span>
    t<span class="token punctuation">.</span>AsyncState
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>主线程等待异步结果</strong></p> <p>方式一：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>result<span class="token punctuation">.</span>AsyncWaitHandle<span class="token punctuation">.</span><span class="token function">WaitOne</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//线程一直等待</span>
</code></pre></div><p>方式二：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>result<span class="token punctuation">.</span>IsCompleted<span class="token punctuation">)</span><span class="token comment">//判断是否结束</span>
<span class="token punctuation">{</span>
    Thread<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;请继续等待...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//类似进度条</span>
<span class="token punctuation">}</span>
</code></pre></div><p>方式三：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>method<span class="token punctuation">.</span><span class="token function">EndInvoke</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
</code></pre></div><p>适用范围：</p> <p>1.在执行I/O操作时</p> <p>2.网络读写、调用接口</p> <p>3.数据库的操作（EF、sqlsuger人家自己已经实现异步读取）</p> <p>4.WebService</p> <p>5.耗时操作</p> <p>对于需要长时间CPU运算的场合，图形处理，算法执行不适合使用异步。</p> <p>但是往往由于使用多线程编程的简单和符合习惯，所以很多人往往会使用线程来执行耗时较长的I/O操作，也导致很多人就误认为异步==多线程</p> <p><strong>总结</strong>：需要耗时操作的尽量都使用异步执行。</p> <h2 id="多线程"><a href="#多线程" class="header-anchor">#</a> 多线程</h2> <p>理想的线程数量&lt;=CPU核心数量</p> <blockquote><p>使用</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading</span><span class="token punctuation">;</span>

<span class="token comment">//实例化线程</span>
<span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Thread</span><span class="token punctuation">(</span>方法名<span class="token punctuation">)</span><span class="token punctuation">;</span>
thread<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">//线程传递参数</span>
<span class="token comment">//1.使用ParameterizedThreadStart委托</span>
<span class="token class-name">ParameterizedThreadStart</span> task1 <span class="token operator">=</span> 方法名<span class="token punctuation">;</span>
<span class="token class-name">Thread</span> thread1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Thread</span><span class="token punctuation">(</span>task1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">object</span></span> name <span class="token operator">=</span> <span class="token string">&quot;线程参数&quot;</span><span class="token punctuation">;</span>
thread1<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//2.使用lambda传递参数(推荐)</span>
<span class="token class-name"><span class="token keyword">string</span></span> obj <span class="token operator">=</span> <span class="token string">&quot;张三&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
     Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;你好:&quot;</span> <span class="token operator">+</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
thread<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>线程的挂起</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>Thread<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>；
</code></pre></div><p>线程的阻塞</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>Thread<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>线程终止，不推荐使用，不安全不可控。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>Thread<span class="token punctuation">.</span><span class="token function">Abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>前台线程和后台线程</p></blockquote> <p>.Net的公用语言运行时（Common Language Runtime，CLR）能区分两种不同类型的线程：前台线程和后台线程。这两者的区别就是：应用程序必须运行完所有的前台线程才可以退出；而对于后台线程，应用程序则可以不考虑其是否已经运行完毕而直接退出，所有的后台线程在应用程序退出时都会自动结束。</p> <p>一般后台线程用于处理时间较短的任务，如在一个Web服务器中可以利用后台线程来处理客户端发过来的请求信息。而前台线程一般用于处理需要长时间等待的任务，如在Web服务器中的监听客户端请求的程序，或是定时对某些系统资源进行扫描的程序。</p> <p><strong>（1）有前台，不关闭</strong>
如果线程为前台线程，可能导致UI线程已关闭，但实际还有前台线程暗地里运行，所以程序并没有真正关闭。
<strong>（2）无前台，全关闭</strong>
当然也要注意，如果所有前台线程都关闭，后台线程会自动关闭，后台线程的代码逻辑可能没执行完就终止了。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">Thread</span> thread1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    <span class="token comment">// 默认为 False</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span>CurrentThread<span class="token punctuation">.</span>IsBackground<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置为后台线程</span>
thread1<span class="token punctuation">.</span>IsBackground <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
thread1<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>线程异常</strong></p> <p><strong>注意:只要有线程抛出异常，整个程序就会停止。所以，异常必须处理。</strong></p> <p>对创建线程try catch没用，需要对线程中调用的函数添加异常处理代码</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//正确</span>
<span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Thread</span><span class="token punctuation">(</span>SayHi<span class="token punctuation">)</span><span class="token punctuation">;</span>
    thread<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    thread<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">try</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;hi&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Exception</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>线程安全</strong></p> <p>当多个线程抢夺一个共同资源时，在一个线程使用该资源的过程中，另外一个线程可能对该资源进行修改</p> <p>解决方法：创建一个只读对象对对象处理使用lock（锁操作）</p> <p>基本含义:  lock就是把一段代码定义为临界区，所谓临界区就是同一时刻只能有一个线程来操作临界区的代码，当一个线程位于代码的临界区时，另一个线程不能进入临界区，如果   试图进入临界区，则只能一直等待（即被阻止），直到已经进入临界区的线程访问完毕，并释放锁旗标</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">static</span> <span class="token keyword">readonly</span> <span class="token class-name"><span class="token keyword">object</span></span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">object</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Check</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">lock</span> <span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        User<span class="token punctuation">.</span>Name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">string</span></span> s <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">@&quot;{0} = {1}&quot;</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> User<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
            Thread<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token class-name">Thread</span> thread1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token function">Check</span><span class="token punctuation">(</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Thread</span> thread2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token function">Check</span><span class="token punctuation">(</span><span class="token string">&quot;李四&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
thread1<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
thread2<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>多线程的缺点</strong></p> <p>1线程占用一定资源，比如内存，CPU；创建和销毁操作都比较昂贵</p> <p>2线程调度器要管理线程</p> <p>3大量的创建线程，导致内存不够用，线程调度器繁忙。</p> <p>4当多个线程竞争同一个静态资源时，会造成死锁。</p> <h2 id="线程池"><a href="#线程池" class="header-anchor">#</a> 线程池</h2> <p>由于线程的创建和销毁时比较昂贵的操作，所以在ASP.NET中自己设定了一个线程池，由底层进行统一调配。</p> <p>线程池思想：事先创建好几个对象，需要就从池中分配，用完就返回池中</p> <p>注意：</p> <p>（1）线程池，只适合短时操作，不要阻塞线程池线程
（2）线程池，<strong>线程是后台线程</strong>
（3）线程池的线程数量有上限
（4）ASP.NET 使用自己的线程池</p> <p><strong>优缺点</strong></p> <p>（1）电脑的内存是有限的，每个线程，都会占用内存，如果并发数量很多，内存会爆掉。
（2）使用线程池，当并发超过一定数量，则会排队，所以，并行的请求处理时间会被延长。</p> <blockquote><p>使用</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code>ThreadPool<span class="token punctuation">.</span><span class="token function">QueueUserWorkItem</span><span class="token punctuation">(</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
      方法<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="task任务"><a href="#task任务" class="header-anchor">#</a> Task任务</h2> <p>using System.Threading.Tasks;</p> <p>任务非常强大，极大的简化了异步编程，并且能带来显著的性能提升。</p> <p><strong>线程池的缺点</strong></p> <p>1线程池获取结果并不方便</p> <p>2异步处理不方便</p> <p>3连续的异步操作不方便</p> <p>场景：</p> <p>一、3个并发请求，通过3个接口获取数据，我们希望得到所有接口的数据进行下一步业务处理。</p> <p>二、3个并发请求，只要其中某一个完成了，就触发一个事件结果。</p> <blockquote><p>使用</p></blockquote> <p><strong>任务的创建</strong></p> <p>一、构造函数创建</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>


<span class="token comment">//无返回值</span>
<span class="token class-name">Task</span> task <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Task</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    方法<span class="token punctuation">(</span>参数<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
task<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">//有返回</span>
<span class="token class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> task <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    方法<span class="token punctuation">(</span>参数<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">&quot;admin&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
task<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//获取任务的返回值</span>
task<span class="token punctuation">.</span>Result
</code></pre></div><p>二、任务工厂创建</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//任务工厂模式下，任务会立即调用执行</span>
Task<span class="token punctuation">.</span>Factory<span class="token punctuation">.</span><span class="token function">StartNew</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span>CurrentThread<span class="token punctuation">.</span>IsThreadPoolThread<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>不使用线程池设置</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">Task</span> task <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Task</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    <span class="token comment">// False 不使用线程池</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span>CurrentThread<span class="token punctuation">.</span>IsThreadPoolThread<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> TaskCreationOptions<span class="token punctuation">.</span>LongRunning<span class="token punctuation">)</span><span class="token punctuation">;</span>
task<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>任务的回调</strong></p> <p>task.ContinueWith</p> <p>（1）支持1个 task 接多个ContinueWith
（2）ContinueWith返回下一代 task，下一代可以继续ContinueWith</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> task <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
task<span class="token punctuation">.</span><span class="token function">ContinueWith</span><span class="token punctuation">(</span>t<span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//t.Result获取异步返回值</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>Result <span class="token operator">+</span> <span class="token string">&quot;come on.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">100</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ContinueWith</span><span class="token punctuation">(</span>t <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    <span class="token comment">//					100</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>Result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
task<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Task的线程等待和延续</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">List<span class="token punctuation">&lt;</span>Task<span class="token punctuation">&gt;</span></span> taskList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>Task<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Task</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Task</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;我是第一个任务&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;1号开始了，当前1号线程是:{0}&quot;</span><span class="token punctuation">,</span> Thread<span class="token punctuation">.</span>CurrentThread<span class="token punctuation">.</span>ManagedThreadId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Thread<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;1号任务执行完成&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
taskList<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>t1<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Task</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Task</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;我是第二个任务&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;2号开始了，当前2号线程是:{0}&quot;</span><span class="token punctuation">,</span> Thread<span class="token punctuation">.</span>CurrentThread<span class="token punctuation">.</span>ManagedThreadId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Thread<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">6000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;2号任务执行完成&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
taskList<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>t2<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Task</span> t3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Task</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;我是第三个任务&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;3号开始了，当前3号线程是:{0}&quot;</span><span class="token punctuation">,</span> Thread<span class="token punctuation">.</span>CurrentThread<span class="token punctuation">.</span>ManagedThreadId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Thread<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">8000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;3号任务执行完成&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
taskList<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>t3<span class="token punctuation">)</span><span class="token punctuation">;</span>

t1<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
t2<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
t3<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p><strong>WaitAny</strong></p> <p>任务链表中有一个任务执行完成，主线程就就执行。</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//只要任务链表中有一个执行完成主线程就继续执行</span>
Task<span class="token punctuation">.</span><span class="token function">WaitAny</span><span class="token punctuation">(</span>taskList<span class="token punctuation">.</span><span class="token function">ToArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;主线程开始执行&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p><strong>WaitAll</strong></p> <p>任务链表中所有任务都结束后，主线程继续执行。</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//只要任务链表中有一个执行完成主线程就继续执行</span>
Task<span class="token punctuation">.</span><span class="token function">WaitAll</span><span class="token punctuation">(</span>taskList<span class="token punctuation">.</span><span class="token function">ToArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;主线程开始执行&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p><strong>WhenAny</strong></p> <p>表示任务列表中有任何一个任务结束后，配合ContinueWith进行回调触发。</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code>Task<span class="token punctuation">.</span><span class="token function">WhenAny</span><span class="token punctuation">(</span>taskList<span class="token punctuation">.</span><span class="token function">ToArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ContinueWith</span><span class="token punctuation">(</span>t <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>Result<span class="token punctuation">.</span>Result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p><strong>WhenAll</strong></p> <p>表示任务列表中所有任务结束后，配合ContinueWith进行回调触发。</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code>Task<span class="token punctuation">.</span><span class="token function">WhenAll</span><span class="token punctuation">(</span>taskList<span class="token punctuation">.</span><span class="token function">ToArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ContinueWith</span><span class="token punctuation">(</span>t <span class="token operator">=&gt;</span> 
<span class="token punctuation">{</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>Result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>Result<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>TaskFactory实现线程的等待和延续</strong></p> <p>ContinueWhenAny:等价于Task的WhenAny+ContinueWith</p> <p>ContinueWhenAll:等价于Task的WhenAll+ContinueWith</p> <p><strong>ContinueWhenAny</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>Task<span class="token punctuation">.</span>Factory<span class="token punctuation">.</span><span class="token function">ContinueWhenAny</span><span class="token punctuation">(</span>taskList<span class="token punctuation">.</span><span class="token function">ToArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>t<span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>Result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>ContinueWhenAll</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>Task<span class="token punctuation">.</span>Factory<span class="token punctuation">.</span><span class="token function">ContinueWhenAll</span><span class="token punctuation">(</span>taskList<span class="token punctuation">.</span><span class="token function">ToArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>t<span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>t<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>t<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>t<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Task解决的问题：</p> <p>1.让异步编程更加简单，调用方法简单获取返回值简单</p> <p>2.提供了一些强化功能，异步编程的最大问题是：不可控</p> <p>Task让异步编程变的可控而且更加简化</p> <p>3.链式编程解决方案</p> <h2 id="异步编程async-await"><a href="#异步编程async-await" class="header-anchor">#</a> 异步编程Async/Await</h2> <p><strong>语法</strong></p> <p>① 方法使用async作为修饰符</p> <p>② 方法内部包含一个或者多个await表达式，表示可以异步完成的任务</p> <p>③ 必须具备以下三种返回类型 void 、Task 、Task&lt;T&gt; ,其中后两种的返回对象表示未来完成的工作，调用方法和异步方法可以继续执行。</p> <p>④异步方法的参数可以任意类型，但是不能为out和ref参数</p> <p>⑤约定俗成，一般异步方法都是以 Async作为后缀的。</p> <p>⑥ 除了方法之外，Lambda表达式和匿名函数也可以作为异步对象。</p> <p>如果在async中没有出现await，那么该方法就会变成一个同步方法。</p> <blockquote><p>使用</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code> <span class="token keyword">public</span> <span class="token keyword">async</span>  <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">DoSomething111</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
     Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;异步方法开始1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token comment">//通过第一个异步方法得到结果</span>
     <span class="token class-name"><span class="token keyword">var</span></span> aaa<span class="token operator">=</span> <span class="token keyword">await</span> Task<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
     <span class="token punctuation">{</span>
         Thread<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">return</span> <span class="token number">100</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;结果是{0}&quot;</span><span class="token punctuation">,</span> aaa<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="lambda表达式"><a href="#lambda表达式" class="header-anchor">#</a> lambda表达式</h2> <blockquote><p>是一个匿名函数，没有名字的函数</p> <p>读做goes to</p> <p>符号: =&gt;</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//原始时期	用delegate来表示是一个匿名函数</span>
<span class="token class-name">Action</span> action <span class="token operator">=</span> <span class="token keyword">delegate</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;helloworld&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//进化版本1 =&gt;lambda表达式 匿名函数</span>
<span class="token class-name">Action</span> action2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;helloworld&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//进化版本2   lambda简化写法   代码只有一行的时候 前后花括号可以省略</span>
<span class="token class-name">Action</span> action3 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;helloworld&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//进化版本3   lambda   由于委托中的参数类型和函数中的参数类型一定是相同的   所以lambda中参数类型可以省略</span>
<span class="token class-name">Action<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">&gt;</span></span> action4 <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;helloworld&quot;</span> <span class="token operator">+</span> x <span class="token operator">+</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//lambda中一旦有return 那么就必须要有花括号</span>
<span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span> func1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;这是一个有返回值的函数&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token number">100</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">int</span></span> r1 <span class="token operator">=</span> func1<span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>四种函数类型的写法</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">// 无参无返回</span>
<span class="token class-name">Action</span> action <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Response<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">&quot;我是无参无返回&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
action<span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 有参无返回</span>
<span class="token class-name">Action<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">&gt;</span></span> action2 <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Response<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">&quot;我是有参无返回&quot;</span> <span class="token operator">+</span> x <span class="token operator">+</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
action2<span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token string">&quot;李四&quot;</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 无参有返回</span>
<span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span> func1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token number">100</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">int</span></span> res <span class="token operator">=</span> func1<span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Response<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 有参有返回</span>
<span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> func2 <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> x <span class="token operator">+</span> <span class="token string">&quot;100&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">string</span></span> res2 <span class="token operator">=</span> func2<span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token string">&quot;王五&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Response<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>res2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="扩展方法"><a href="#扩展方法" class="header-anchor">#</a> 扩展方法</h2> <p>可以向现有类型“添加”方法，而无需创建新的派生类型、重新编译或以其他方式修改原始类型。</p> <p>扩展方法的 3 个要求：</p> <ol><li>声明扩展方法的类必须声明为 <code>static</code>；</li> <li>扩展方法本身必须声明为<code>static</code>；</li> <li>扩展方法第一个参数类型前一定要包含关键字 <code>this</code>。</li></ol> <blockquote><p>示例</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//原始方法</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyMethod</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">double</span></span> d1<span class="token punctuation">,</span> d2<span class="token punctuation">,</span> d3<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token function">MyMethod</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">double</span></span> i<span class="token punctuation">,</span><span class="token class-name"><span class="token keyword">double</span></span> j<span class="token punctuation">,</span><span class="token class-name"><span class="token keyword">double</span></span> k<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        d1 <span class="token operator">=</span> i<span class="token punctuation">;</span>
        d2 <span class="token operator">=</span> j<span class="token punctuation">;</span>
        d3 <span class="token operator">=</span> k<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">double</span></span> <span class="token function">SumMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> d1 <span class="token operator">+</span> d2 <span class="token operator">+</span> d3<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//扩展方法</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MythodExtension</span>
<span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">double</span></span> <span class="token function">DivdMethods</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token class-name">MyMethod</span> md<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> md<span class="token punctuation">.</span><span class="token function">SumMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//扩展方法调用</span>
<span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">MyMethod</span> md <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyMethod</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">double</span></span> reslut <span class="token operator">=</span> md<span class="token punctuation">.</span><span class="token function">DivdMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 方法一调用</span>

    <span class="token class-name"><span class="token keyword">double</span></span> reslut <span class="token operator">=</span> MythodExtension<span class="token punctuation">.</span><span class="token function">DivdMethods</span><span class="token punctuation">(</span>md<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//  方法二调用</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="类型转换"><a href="#类型转换" class="header-anchor">#</a> 类型转换</h2> <blockquote><p>显示转换、隐式转换和强制类型转化</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code>隐式转换
<span class="token class-name"><span class="token keyword">short</span></span> n1 <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">int</span></span> n2 <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">long</span></span> n3 <span class="token operator">=</span> n2<span class="token punctuation">;</span> <span class="token comment">//隐式转换，当同数值类型小类型赋值给大类型的时候会自动转化为大的类型</span>

显示转换
<span class="token class-name"><span class="token keyword">int</span></span> n4 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>n3<span class="token punctuation">;</span><span class="token comment">//显示转换，同为数值类型，大类型转化为小类型的时候需要加括号进行转化</span>

强制类型转化
<span class="token class-name"><span class="token keyword">string</span></span> age <span class="token operator">=</span> '<span class="token number">23</span>'<span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">int</span></span> n5 <span class="token operator">=</span> <span class="token number">22</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">int</span></span> age1 <span class="token operator">=</span> Convert<span class="token punctuation">.</span><span class="token function">ToInt32</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">string</span></span> newN <span class="token operator">=</span> n5<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//或者string newN =Convert.ToString(n5);</span>
</code></pre></div><blockquote><p>装箱拆箱</p> <p>装箱：将值类型转化为引用类型过程</p> <p>拆箱：将引用类型转化为值类型过程</p> <p>目的：转化数据类型</p> <p>缺点：装箱需要从栈转到堆，拆箱需要从堆转到栈，频繁转化效率会低</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">int</span></span> n1 <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">string</span></span> s1 <span class="token operator">=</span> n1<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//装箱</span>

<span class="token class-name"><span class="token keyword">int</span></span> n2 <span class="token operator">=</span>Convert<span class="token punctuation">.</span><span class="token function">ToInt32</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//拆箱</span>
</code></pre></div><h2 id="运算符"><a href="#运算符" class="header-anchor">#</a> 运算符</h2> <blockquote><p>一元运算符：++，--</p> <p>二元运算符：+，-，*，/，||，&amp;&amp;，%</p> <p>三元运算符</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>判断表达式<span class="token punctuation">?</span>真<span class="token punctuation">:</span>假
</code></pre></div></blockquote> <h2 id="流程控制"><a href="#流程控制" class="header-anchor">#</a> 流程控制</h2> <blockquote><p>1.单个if</p> <p>2.if else 二选一</p> <p>3.if else if else if ...else 多选一</p> <p>4.switch</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">switch</span><span class="token punctuation">(</span>表达式<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">case</span> 值<span class="token number">1</span><span class="token punctuation">:</span>执行代码<span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> 值<span class="token number">2</span><span class="token punctuation">:</span>执行代码<span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> 值<span class="token number">3</span><span class="token punctuation">:</span>执行代码<span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span>执行代码<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>5.for</p> <p>6.foreach</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//for循环的效率低  foreach循环效率高</span>
<span class="token comment">//foreach循环的对象必须继承IEnumrale接口,foreach循环的时候不检测循环内容</span>
<span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> item <span class="token keyword">in</span> list<span class="token punctuation">)</span><span class="token punctuation">{</span>
    代码块<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>6.while</p> <p>7.do while</p></blockquote> <h2 id="函数"><a href="#函数" class="header-anchor">#</a> 函数</h2> <blockquote><p>修饰符 返回值类型 函数名称(参数){}</p> <p>修饰符：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token number">1</span><span class="token punctuation">.</span><span class="token keyword">public</span>    公有成员    所有人都可以调用，无论是谁        共享单车
<span class="token number">2</span><span class="token punctuation">.</span><span class="token keyword">private</span>   私有成员    只有类的内部可以调用             自己的车
<span class="token number">3</span><span class="token punctuation">.</span><span class="token keyword">protected</span> 保护成员    只有自己和派生类<span class="token punctuation">(</span>继承我的类<span class="token punctuation">)</span>      我和我的后代可以用
<span class="token number">4</span><span class="token punctuation">.</span><span class="token keyword">internal</span>  内部成员    同命名空间下可用                整个家庭都是可用的
<span class="token number">5</span><span class="token punctuation">.</span><span class="token keyword">static</span>    静态修饰符   不需要实例化，可以直接调用，单例模式
<span class="token number">6</span><span class="token punctuation">.</span><span class="token keyword">virtual</span>   虚方法
<span class="token number">7</span><span class="token punctuation">.</span><span class="token keyword">override</span>  重写
</code></pre></div><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Say1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//没参数没有返回值的函数</span>
    代码块<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Say2</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span><span class="token class-name"><span class="token keyword">int</span></span> age<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//有参数没有返回值的函数</span>
    代码块<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">Say3</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span><span class="token class-name"><span class="token keyword">int</span></span> age<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//有返回值有参数的函数  </span>
    代码块<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">100</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">Say4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//有返回值没有参数的函数</span>
    代码块<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">100</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></blockquote> <h2 id="类"><a href="#类" class="header-anchor">#</a> 类</h2> <blockquote><p>变量成员（变量成员可以用修饰符修饰，一个函数里面的变量不可以用修饰符修饰）</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> _age <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">int</span></span> _id<span class="token punctuation">;</span>		<span class="token comment">//只有类内部可以获取</span>
</code></pre></div><p>函数成员</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    代码块<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>属性</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id
<span class="token punctuation">{</span>
    <span class="token comment">//获取属性时会调用</span>
    <span class="token keyword">get</span><span class="token punctuation">{</span><span class="token keyword">return</span> _id<span class="token punctuation">;</span><span class="token punctuation">}</span>
    
    <span class="token comment">//设置时会调用，默认关键词value代表赋给我的值</span>
    <span class="token keyword">set</span><span class="token punctuation">{</span>_id <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></blockquote> <h3 id="构造函数"><a href="#构造函数" class="header-anchor">#</a> 构造函数</h3> <blockquote><p>创建对象初始化类成员的时候调用，一个类可以有多个构造函数，通过参数不同调用不同构造函数</p> <p>语法：与类同名且没有返回值修饰</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Animal</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token function">Animal</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//无参构造</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token function">Animal</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//有参构造</span>
        _id <span class="token operator">=</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token class-name">Animal</span> a1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Animal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用的第一个构造函数</span>
<span class="token class-name">Animal</span> a1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Animal</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用的第二个构造函数</span>
</code></pre></div></blockquote> <h3 id="析构函数"><a href="#析构函数" class="header-anchor">#</a> 析构函数</h3> <blockquote><p>作用：垃圾回收，释放资源  GC帮你释放，不用写</p></blockquote> <h3 id="继承"><a href="#继承" class="header-anchor">#</a> 继承</h3> <blockquote><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//Cat类继承Animal类,父类2，父类3...</span>
<span class="token keyword">internal</span> <span class="token keyword">class</span> <span class="token class-name">Cat</span><span class="token punctuation">:</span>Animal<span class="token punctuation">,</span>父类<span class="token number">2</span><span class="token punctuation">,</span>父类<span class="token number">3</span><span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">{</span>
    <span class="token comment">//重写父类的方法</span>
    <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//调用执行父类的say方法</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;喵喵&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//自己的一些代码块</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">//覆盖父类的方法</span>
    <span class="token keyword">public</span> <span class="token keyword">new</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//自己的代码块</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></blockquote> <h1 id="net"><a href="#net" class="header-anchor">#</a> .NET</h1> <h2 id="ado-net"><a href="#ado-net" class="header-anchor">#</a> ADO.NET</h2> <blockquote><p>connectionString连接字符串，连接字符串有两种编写方式</p> <p>1.window身份验证：Data Source=DESKTOP-EA5IP0C\SQLEXPRESS;DataBase=StudentTest;Integrated Security=True;</p> <p>2.账号登录方式： Server=DESKTOP-EA5IP0C\SQLEXPRESS;uid=sa;pwd=sa;database=StudentTest;</p></blockquote> <p>配置文件中设置连接字符串</p> <blockquote><p>使用时应该using System.Configuration;</p></blockquote> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>connectionStrings</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>StudentinfoConn<span class="token punctuation">&quot;</span></span> <span class="token attr-name">connectionString</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Data Source=.;DataBase=StudentTest;Integrated Security=True;<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>connectionStrings</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="ado通过纯sql语句操作数据库"><a href="#ado通过纯sql语句操作数据库" class="header-anchor">#</a> ADO通过纯sql语句操作数据库</h3> <p><strong>查询</strong></p> <blockquote><p>法一：Adapter + DataSet</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">SqlConnection</span> conn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlConnection</span><span class="token punctuation">(</span><span class="token string">&quot;Data Source=DESKTOP-EA5IP0C\\SQLEXPRESS;DataBase=StudentTest;Integrated Security=True;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//适配器类需要两个条件：参数1执行的SQL语句  参数2数据连接</span>
    <span class="token class-name">SqlDataAdapter</span> adapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlDataAdapter</span><span class="token punctuation">(</span><span class="token string">&quot;select * from Studentinfo&quot;</span><span class="token punctuation">,</span> conn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//容器：装载数据</span>
    <span class="token class-name">DataSet</span> ds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//把数据适配器中的数据 填充到容器内</span>
    adapter<span class="token punctuation">.</span><span class="token function">Fill</span><span class="token punctuation">(</span>ds<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//DataSet是由若干个DataTable组成的  DataTable是由若干个DataRow组成  数据在DataRow的列中</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">DataRow</span> row <span class="token keyword">in</span> ds<span class="token punctuation">.</span>Tables<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Rows<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">&quot;create_time&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>法二：SQLCommand+DataReader</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">SqlConnection</span> connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlConnection</span><span class="token punctuation">(</span><span class="token string">&quot;Data Source=DESKTOP-EA5IP0C\\SQLEXPRESS;DataBase=StudentTest;Integrated Security=True;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//打开连接</span>
    connection<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//创建ADO.NET的命令类 参数1：SQL语句  参数2：数据连接</span>
    <span class="token class-name">SqlCommand</span> sqlCommand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlCommand</span><span class="token punctuation">(</span><span class="token string">&quot;select * from Studentinfo&quot;</span><span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//从命令类获取到流读取器</span>
    <span class="token class-name">SqlDataReader</span> reader <span class="token operator">=</span> sqlCommand<span class="token punctuation">.</span><span class="token function">ExecuteReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>reader<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>reader<span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></blockquote> <p><strong>增删改</strong></p> <blockquote><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">SqlConnection</span> connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlConnection</span><span class="token punctuation">(</span>ConfigurationManager<span class="token punctuation">.</span>ConnectionStrings<span class="token punctuation">[</span><span class="token string">&quot;StudentinfoConn&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ConnectionString<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">SqlCommand</span> command <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlCommand</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span>connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//打开连接</span>
    conn<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//执行sql语句</span>
    <span class="token class-name"><span class="token keyword">int</span></span> flag <span class="token operator">=</span> command<span class="token punctuation">.</span><span class="token function">ExecuteNonQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></blockquote> <h3 id="ado通过存储过程操作数据库"><a href="#ado通过存储过程操作数据库" class="header-anchor">#</a> ADO通过存储过程操作数据库</h3> <p><strong>查询</strong></p> <blockquote><p>法一：Adapter + DataSet</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">SqlConnection</span> connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlConnection</span><span class="token punctuation">(</span><span class="token string">&quot;Data Source=DESKTOP-EA5IP0C\\SQLEXPRESS;DataBase=StudentTest;Integrated Security=True;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">SqlDataAdapter</span> adapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlDataAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//创建一个空适配器</span>
    <span class="token comment">//存储过程所有处理都是有Command类处理的</span>
    <span class="token class-name">SqlCommand</span> sqlCommand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlCommand</span><span class="token punctuation">(</span><span class="token string">&quot;pr_query_StudentInfo&quot;</span><span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//规定command类的执行的类型为存储过程</span>
    sqlCommand<span class="token punctuation">.</span>CommandType <span class="token operator">=</span> CommandType<span class="token punctuation">.</span>StoredProcedure<span class="token punctuation">;</span>
    <span class="token comment">//适配器装载一个命令类对象(携带了一个查询的存储过程)</span>
    adapter<span class="token punctuation">.</span>SelectCommand <span class="token operator">=</span> sqlCommand<span class="token punctuation">;</span>
    <span class="token class-name">DataSet</span> ds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    adapter<span class="token punctuation">.</span><span class="token function">Fill</span><span class="token punctuation">(</span>ds<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>法二：SQLCommand+DataReader</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">SqlConnection</span> connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlConnection</span><span class="token punctuation">(</span><span class="token string">&quot;Data Source=DESKTOP-EA5IP0C\\SQLEXPRESS;DataBase=StudentTest;Integrated Security=True;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">SqlCommand</span> sqlCommand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlCommand</span><span class="token punctuation">(</span><span class="token string">&quot;pr_query_StudentInfo&quot;</span><span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
    sqlCommand<span class="token punctuation">.</span>CommandType <span class="token operator">=</span> CommandType<span class="token punctuation">.</span>StoredProcedure<span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">SqlDataReader</span> reader <span class="token operator">=</span> sqlCommand<span class="token punctuation">.</span><span class="token function">ExecuteReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>reader<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Response<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>reader<span class="token punctuation">[</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></blockquote> <p><strong>增删改</strong></p> <blockquote><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">int</span></span> id <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span>
<span class="token comment">//存储过程调用还是由ado.net和jdbc操作</span>
<span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">SqlConnection</span> connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlConnection</span><span class="token punctuation">(</span>ConfigHelper<span class="token punctuation">.</span><span class="token function">GetConnectionString</span><span class="token punctuation">(</span><span class="token string">&quot;sqlserver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//删除  写操作</span>
    <span class="token class-name">SqlCommand</span> sqlCommand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlCommand</span><span class="token punctuation">(</span><span class="token string">&quot;pr_delete_StudentInfo_by_id&quot;</span><span class="token punctuation">,</span>connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//为ado指定操作方式为存储过程方式</span>
    sqlCommand<span class="token punctuation">.</span>CommandType <span class="token operator">=</span> CommandType<span class="token punctuation">.</span>StoredProcedure<span class="token punctuation">;</span>
    <span class="token comment">//设置param参数</span>
    sqlCommand<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;@s_id&quot;</span><span class="token punctuation">,</span> SqlDbType<span class="token punctuation">.</span>Int<span class="token punctuation">)</span><span class="token punctuation">.</span>Value<span class="token operator">=</span>id<span class="token punctuation">;</span>
    <span class="token comment">//执行存储过程</span>
    connection<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    sqlCommand<span class="token punctuation">.</span><span class="token function">ExecuteNonQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></blockquote> <h4 id="return返回值的存储过程的操作"><a href="#return返回值的存储过程的操作" class="header-anchor">#</a> return返回值的存储过程的操作</h4> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">SqlConnection</span> connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlConnection</span><span class="token punctuation">(</span>ConfigHelper<span class="token punctuation">.</span><span class="token function">GetConnectionString</span><span class="token punctuation">(</span><span class="token string">&quot;sqlserver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">SqlCommand</span> sqlCommand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlCommand</span><span class="token punctuation">(</span><span class="token string">&quot;pr_insert_studentInfo_return&quot;</span><span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
    sqlCommand<span class="token punctuation">.</span>CommandType <span class="token operator">=</span> CommandType<span class="token punctuation">.</span>StoredProcedure<span class="token punctuation">;</span>
    <span class="token comment">//设置param参数</span>
    sqlCommand<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;@s_name&quot;</span><span class="token punctuation">,</span>SqlDbType<span class="token punctuation">.</span>VarChar<span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value <span class="token operator">=</span> <span class="token string">&quot;张三&quot;</span><span class="token punctuation">;</span>
    sqlCommand<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;@s_birth&quot;</span><span class="token punctuation">,</span> SqlDbType<span class="token punctuation">.</span>VarChar<span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value <span class="token operator">=</span> <span class="token string">&quot;2022-02-02&quot;</span><span class="token punctuation">;</span>
    sqlCommand<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;@s_sex&quot;</span><span class="token punctuation">,</span> SqlDbType<span class="token punctuation">.</span>VarChar<span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value <span class="token operator">=</span> <span class="token string">&quot;男&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">//reutrn类型返回值需要接收，那么需要设置return返回值</span>
    sqlCommand<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;@ReturnValue&quot;</span><span class="token punctuation">,</span> SqlDbType<span class="token punctuation">.</span>Int<span class="token punctuation">)</span><span class="token punctuation">.</span>Direction <span class="token operator">=</span> ParameterDirection<span class="token punctuation">.</span>ReturnValue<span class="token punctuation">;</span>
    <span class="token comment">//执行存储过程</span>
    connection<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    sqlCommand<span class="token punctuation">.</span><span class="token function">ExecuteNonQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Response<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>sqlCommand<span class="token punctuation">.</span>Parameters<span class="token punctuation">[</span><span class="token string">&quot;@ReturnValue&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="output返回值的存储过程操作"><a href="#output返回值的存储过程操作" class="header-anchor">#</a> output返回值的存储过程操作</h4> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">SqlConnection</span> connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlConnection</span><span class="token punctuation">(</span>ConfigHelper<span class="token punctuation">.</span><span class="token function">GetConnectionString</span><span class="token punctuation">(</span><span class="token string">&quot;sqlserver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">SqlCommand</span> sqlCommand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlCommand</span><span class="token punctuation">(</span><span class="token string">&quot;pr_insert_studentInfo_output&quot;</span><span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
    sqlCommand<span class="token punctuation">.</span>CommandType <span class="token operator">=</span> CommandType<span class="token punctuation">.</span>StoredProcedure<span class="token punctuation">;</span>
    <span class="token comment">//设置param参数</span>
    sqlCommand<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;@s_name&quot;</span><span class="token punctuation">,</span> SqlDbType<span class="token punctuation">.</span>VarChar<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value <span class="token operator">=</span> <span class="token string">&quot;张三&quot;</span><span class="token punctuation">;</span>
    sqlCommand<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;@s_birth&quot;</span><span class="token punctuation">,</span> SqlDbType<span class="token punctuation">.</span>VarChar<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value <span class="token operator">=</span> <span class="token string">&quot;2022-02-02&quot;</span><span class="token punctuation">;</span>
    sqlCommand<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;@s_sex&quot;</span><span class="token punctuation">,</span> SqlDbType<span class="token punctuation">.</span>VarChar<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value <span class="token operator">=</span> <span class="token string">&quot;男&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">//output返回参数</span>
    sqlCommand<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;@newid&quot;</span><span class="token punctuation">,</span> SqlDbType<span class="token punctuation">.</span>Int<span class="token punctuation">)</span><span class="token punctuation">.</span>Direction <span class="token operator">=</span> ParameterDirection<span class="token punctuation">.</span>Output<span class="token punctuation">;</span>
    sqlCommand<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;@new_name&quot;</span><span class="token punctuation">,</span> SqlDbType<span class="token punctuation">.</span>NVarChar<span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Direction <span class="token operator">=</span> ParameterDirection<span class="token punctuation">.</span>Output<span class="token punctuation">;</span>
    <span class="token comment">//执行存储过程</span>
    connection<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    sqlCommand<span class="token punctuation">.</span><span class="token function">ExecuteNonQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Response<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>sqlCommand<span class="token punctuation">.</span>Parameters<span class="token punctuation">[</span><span class="token string">&quot;@newid&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Value<span class="token operator">+</span><span class="token string">&quot;-&quot;</span><span class="token operator">+</span>sqlCommand<span class="token punctuation">.</span>Parameters<span class="token punctuation">[</span><span class="token string">&quot;@new_name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="ado通过sql语句-存储过程操作数据库-推荐"><a href="#ado通过sql语句-存储过程操作数据库-推荐" class="header-anchor">#</a> ADO通过SQL语句+存储过程操作数据库（推荐）</h3> <blockquote><p>正常写sql语句，在传参数的时候通过变量传参即可</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">SqlConnection</span> connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlConnection</span><span class="token punctuation">(</span>ConfigHelper<span class="token punctuation">.</span><span class="token function">GetConnectionString</span><span class="token punctuation">(</span><span class="token string">&quot;sqlserver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">SqlCommand</span> sqlCommand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlCommand</span><span class="token punctuation">(</span><span class="token string">&quot;insert into StudentInfo values(@s_name,@s_birth,@s_sex)&quot;</span><span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
    sqlCommand<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;@s_name&quot;</span><span class="token punctuation">,</span> SqlDbType<span class="token punctuation">.</span>VarChar<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value <span class="token operator">=</span> <span class="token string">&quot;王五&quot;</span><span class="token punctuation">;</span>
    sqlCommand<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;@s_birth&quot;</span><span class="token punctuation">,</span> SqlDbType<span class="token punctuation">.</span>VarChar<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value <span class="token operator">=</span> <span class="token string">&quot;2023&quot;</span><span class="token punctuation">;</span>
    sqlCommand<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;@s_sex&quot;</span><span class="token punctuation">,</span> SqlDbType<span class="token punctuation">.</span>VarChar<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value <span class="token operator">=</span> <span class="token string">&quot;女&quot;</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    sqlCommand<span class="token punctuation">.</span><span class="token function">ExecuteNonQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="ado中事务的使用"><a href="#ado中事务的使用" class="header-anchor">#</a> ADO中事务的使用</h3> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">SqlConnection</span> connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlConnection</span><span class="token punctuation">(</span>connstring<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	connection<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//声明一个事务</span>
    <span class="token class-name">SqlTransaction</span> trans <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">BeginTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">//原子性是事务</span>
	<span class="token keyword">try</span>
	<span class="token punctuation">{</span>
		<span class="token class-name">SqlCommand</span> cmd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlCommand</span><span class="token punctuation">(</span><span class="token string">&quot;update abank set money=money-500 where account=@account&quot;</span><span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
        cmd<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;@account&quot;</span><span class="token punctuation">,</span> SqlDbType<span class="token punctuation">.</span>VarChar<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value <span class="token operator">=</span> account<span class="token punctuation">;</span>
        cmd<span class="token punctuation">.</span>Transaction <span class="token operator">=</span> trans<span class="token punctuation">;</span><span class="token comment">//为命令类设置事务</span>
        cmd<span class="token punctuation">.</span><span class="token function">ExecuteNonQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SqlCommand</span> cmd1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlCommand</span><span class="token punctuation">(</span><span class="token string">&quot;update bbank set money=money+500 where account=@account&quot;</span><span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
        cmd1<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;@account&quot;</span><span class="token punctuation">,</span> SqlDbType<span class="token punctuation">.</span>VarChar<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value <span class="token operator">=</span> account<span class="token punctuation">;</span>
        cmd1<span class="token punctuation">.</span>Transaction <span class="token operator">=</span> trans<span class="token punctuation">;</span><span class="token comment">//为命令类设置事务</span>
        cmd1<span class="token punctuation">.</span><span class="token function">ExecuteNonQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        trans<span class="token punctuation">.</span><span class="token function">Commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        trans<span class="token punctuation">.</span><span class="token function">Rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Response<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="webform框架"><a href="#webform框架" class="header-anchor">#</a> Webform框架</h2> <h3 id="三种解析模板"><a href="#三种解析模板" class="header-anchor">#</a> <strong>三种解析模板</strong></h3> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token operator">&lt;</span><span class="token operator">%</span># <span class="token operator">%</span><span class="token operator">&gt;</span>前台解析数据的，常用在Repeater、GridView组件中渲染数据源使用。
<span class="token operator">&lt;</span><span class="token operator">%=</span> <span class="token operator">%</span><span class="token operator">&gt;</span>调用后台方法属性的
<span class="token operator">&lt;</span><span class="token operator">%</span>  <span class="token operator">%</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>在前台编写后台代码的
<span class="token operator">&lt;</span><span class="token operator">%</span>@ <span class="token operator">%</span><span class="token operator">&gt;</span>引用模板语法<span class="token punctuation">,</span>例如在前端页面引入程序集文件。
</code></pre></div><h3 id="repeater组件"><a href="#repeater组件" class="header-anchor">#</a> repeater组件</h3> <blockquote><p>使用</p></blockquote> <p>前台</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>table table-hover<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>thead</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>id<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>name<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>age<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>data_time<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>thead</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tbody</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">asp:</span>Repeater</span> <span class="token attr-name">ID</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>repStudent<span class="token punctuation">&quot;</span></span> <span class="token attr-name">runat</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>server<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ItemTemplate</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>&lt;%#Eval(&quot;id&quot;) %&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>&lt;%#Eval(&quot;name&quot;) %&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>&lt;%#Eval(&quot;age&quot;) %&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>&lt;%#Eval(&quot;data_time&quot;) %&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ItemTemplate</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">asp:</span>Repeater</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tbody</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>后台</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span><span class="token punctuation">(</span><span class="token class-name">SqlConnection</span> conn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlConnection</span><span class="token punctuation">(</span>ConfigurationManager<span class="token punctuation">.</span>ConnectionStrings<span class="token punctuation">[</span><span class="token string">&quot;StudentinfoConn&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ConnectionString<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">SqlDataAdapter</span> adapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlDataAdapter</span><span class="token punctuation">(</span><span class="token string">&quot;select * from studentinfo&quot;</span><span class="token punctuation">,</span> conn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">DataSet</span> ds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    adapter<span class="token punctuation">.</span><span class="token function">Fill</span><span class="token punctuation">(</span>ds<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//将数据给到repeater</span>
    repStudent<span class="token punctuation">.</span>DataSource <span class="token operator">=</span> ds<span class="token punctuation">;</span>
    <span class="token comment">//repeater绑定</span>
    repStudent<span class="token punctuation">.</span><span class="token function">DataBind</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>事件</p></blockquote> <p><strong>ItemCommand</strong></p> <p>前台：LinkButton中CommandArgument中绑定id值方便后台取值用来根据id删除</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">asp:</span>Repeater</span> <span class="token attr-name">ID</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>repStudent<span class="token punctuation">&quot;</span></span> <span class="token attr-name">runat</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>server<span class="token punctuation">&quot;</span></span> <span class="token attr-name">OnItemCommand</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>repStudent_ItemCommand<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ItemTemplate</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>&lt;%#Eval(&quot;id&quot;) %&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>&lt;%#Eval(&quot;name&quot;) %&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>&lt;%#Eval(&quot;age&quot;) %&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>&lt;%#Eval(&quot;data_time&quot;) %&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">asp:</span>LinkButton</span> <span class="token attr-name">ID</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>lbtnDel<span class="token punctuation">&quot;</span></span> <span class="token attr-name">runat</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>server<span class="token punctuation">&quot;</span></span> <span class="token attr-name">CommandArgument</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>&lt;%#Eval(&quot;id&quot;) %&gt;<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>删除<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">asp:</span>LinkButton</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ItemTemplate</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">asp:</span>Repeater</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>后台</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token preprocessor property">#<span class="token directive keyword">region</span> 删除</span>
    <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">repStudent_ItemCommand</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> source<span class="token punctuation">,</span> <span class="token class-name">RepeaterCommandEventArgs</span> e<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//获取点击对象的CommandArgument属性</span>
    <span class="token class-name"><span class="token keyword">int</span></span> id <span class="token operator">=</span>Convert<span class="token punctuation">.</span><span class="token function">ToInt32</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>CommandArgument<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span><span class="token punctuation">(</span><span class="token class-name">SqlConnection</span> conn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlConnection</span><span class="token punctuation">(</span>ConfigurationManager<span class="token punctuation">.</span>ConnectionStrings<span class="token punctuation">[</span><span class="token string">&quot;StudentinfoConn&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ConnectionString<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">SqlCommand</span> comm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlCommand</span><span class="token punctuation">(</span><span class="token string">&quot;delete from studentinfo where id=&quot;</span> <span class="token operator">+</span> id<span class="token punctuation">,</span> conn<span class="token punctuation">)</span><span class="token punctuation">;</span>
        conn<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">int</span></span> flag <span class="token operator">=</span> comm<span class="token punctuation">.</span><span class="token function">ExecuteNonQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>flag <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            Response<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;script&gt;alert('删除成功')&lt;/script&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>
</code></pre></div><p><strong>ItemDataBound</strong></p> <p>前台</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>&lt;%#Convert.ToInt32( Eval(&quot;is_admin&quot;))==0?&quot;NO&quot;:&quot;YES&quot;%&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">asp:</span>HiddenField</span> <span class="token attr-name">ID</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hfAdmin<span class="token punctuation">&quot;</span></span> <span class="token attr-name">runat</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>server<span class="token punctuation">&quot;</span></span> <span class="token attr-name">Value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>&lt;%#Eval(&quot;is_admin&quot;) %&gt;<span class="token punctuation">'</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>后台</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">repStudent_ItemDataBound</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">RepeaterItemEventArgs</span> e<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//得到该行的is_admin的值</span>
    <span class="token class-name"><span class="token keyword">int</span></span> admin <span class="token operator">=</span> Convert<span class="token punctuation">.</span><span class="token function">ToInt32</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>Item<span class="token punctuation">.</span><span class="token function">FindControl</span><span class="token punctuation">(</span><span class="token string">&quot;hfAdmin&quot;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token class-name">HiddenField</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>admin <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//管理员隐藏操作按钮</span>
        <span class="token punctuation">(</span>e<span class="token punctuation">.</span>Item<span class="token punctuation">.</span><span class="token function">FindControl</span><span class="token punctuation">(</span><span class="token string">&quot;lbtnDel&quot;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token class-name">LinkButton</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Visible <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">(</span>e<span class="token punctuation">.</span>Item<span class="token punctuation">.</span><span class="token function">FindControl</span><span class="token punctuation">(</span><span class="token string">&quot;lbtnUpdate&quot;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token class-name">LinkButton</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Visible <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="dropdownlist组件"><a href="#dropdownlist组件" class="header-anchor">#</a> Dropdownlist组件</h3> <blockquote><p>使用</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>ddlC<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ListItem</span><span class="token punctuation">(</span><span class="token string">&quot;请选择&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//指定位置添加一个选项</span>
ddlD<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//清除下拉选项</span>
</code></pre></div></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code> <span class="token keyword">using</span><span class="token punctuation">(</span><span class="token class-name">SqlConnection</span> conn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlConnection</span><span class="token punctuation">(</span>ConfigurationManager<span class="token punctuation">.</span>ConnectionStrings<span class="token punctuation">[</span><span class="token string">&quot;usersConn&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ConnectionString<span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token punctuation">{</span>
     <span class="token class-name">SqlDataAdapter</span> adapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlDataAdapter</span><span class="token punctuation">(</span><span class="token string">&quot;select * from dbo.S_Province&quot;</span><span class="token punctuation">,</span> conn<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token class-name">DataSet</span> ds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     adapter<span class="token punctuation">.</span><span class="token function">Fill</span><span class="token punctuation">(</span>ds<span class="token punctuation">)</span><span class="token punctuation">;</span>
     ddlP<span class="token punctuation">.</span>DataSource <span class="token operator">=</span> ds<span class="token punctuation">;</span>
     ddlP<span class="token punctuation">.</span>DataTextField <span class="token operator">=</span> <span class="token string">&quot;ProvinceName&quot;</span><span class="token punctuation">;</span>
     ddlP<span class="token punctuation">.</span>DataValueField <span class="token operator">=</span> <span class="token string">&quot;ProvinceID&quot;</span><span class="token punctuation">;</span>
     ddlP<span class="token punctuation">.</span><span class="token function">DataBind</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre></div><blockquote><p>事件</p></blockquote> <p><strong>SelectedIndexChanged</strong></p> <p><strong>使用时应先把自动回传功能打开（autopostback=true）</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ddlP_SelectedIndexChanged</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//获取选中项的value</span>
    <span class="token class-name"><span class="token keyword">int</span></span> pid <span class="token operator">=</span> Convert<span class="token punctuation">.</span><span class="token function">ToInt32</span><span class="token punctuation">(</span>ddlP<span class="token punctuation">.</span>SelectedValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//数据库中查询城市</span>
    <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">SqlConnection</span> conn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlConnection</span><span class="token punctuation">(</span>ConfigurationManager<span class="token punctuation">.</span>ConnectionStrings<span class="token punctuation">[</span><span class="token string">&quot;usersConn&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ConnectionString<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">SqlDataAdapter</span> adapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlDataAdapter</span><span class="token punctuation">(</span><span class="token string">&quot;select * from dbo.S_City where ProvinceID=&quot;</span><span class="token operator">+</span>pid<span class="token punctuation">,</span> conn<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DataSet</span> ds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        adapter<span class="token punctuation">.</span><span class="token function">Fill</span><span class="token punctuation">(</span>ds<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ddlC<span class="token punctuation">.</span>DataSource <span class="token operator">=</span> ds<span class="token punctuation">;</span>
        ddlC<span class="token punctuation">.</span>DataTextField <span class="token operator">=</span> <span class="token string">&quot;CityName&quot;</span><span class="token punctuation">;</span>
        ddlC<span class="token punctuation">.</span>DataValueField <span class="token operator">=</span> <span class="token string">&quot;CityID&quot;</span><span class="token punctuation">;</span>
        ddlC<span class="token punctuation">.</span><span class="token function">DataBind</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="fileupload控件"><a href="#fileupload控件" class="header-anchor">#</a> FileUpload控件</h3> <blockquote><p>使用</p> <p>缺点：只能通过点击按钮才能显示图片，不能点击上传后直接在旁边显示上传的图片</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//获取文件名</span>
<span class="token class-name"><span class="token keyword">string</span></span> fileName <span class="token operator">=</span> fuControl<span class="token punctuation">.</span>FileName<span class="token punctuation">;</span>

<span class="token comment">//获取文件大小</span>
<span class="token class-name"><span class="token keyword">long</span></span> fileSize <span class="token operator">=</span> fuControl<span class="token punctuation">.</span>FileContent<span class="token punctuation">.</span>Length<span class="token punctuation">;</span>

<span class="token comment">//保存文件到指定路径</span>
fuControl<span class="token punctuation">.</span><span class="token function">SaveAs</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>点击上传按钮，将文件保存到服务器，并显示在image控件上</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//1）当点击上传按钮时，需要获取上载文件的文件名</span>
<span class="token class-name"><span class="token keyword">string</span></span> fileName <span class="token operator">=</span> FileUpload1<span class="token punctuation">.</span>FileName<span class="token punctuation">;</span>
<span class="token comment">//2）确定文件保存位置</span>
<span class="token class-name"><span class="token keyword">string</span></span> path <span class="token operator">=</span> <span class="token string">@&quot;D:\KeDa\KeDa\img\&quot; + fileName;	//必须为物理路径，因为
//3）调用saveas对文件进行保存到服务器
FileUpload1.SaveAs(path);
//4）为image控件附上图片路径
img.ImageUrl = &quot;</span><span class="token operator">/</span>img<span class="token operator">/</span>&quot;<span class="token operator">+</span>fileName<span class="token punctuation">;</span>
</code></pre></div><blockquote><p>获取当前项目文件方法Server.MapPath(路径)</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//C:\Users\Admin\source\repos\testWebForm\testWebForm\img\</span>
<span class="token class-name"><span class="token keyword">string</span></span> path1 <span class="token operator">=</span> Server<span class="token punctuation">.</span><span class="token function">MapPath</span><span class="token punctuation">(</span><span class="token string">&quot;img\\&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></blockquote> <h3 id="webform框架的生命周期"><a href="#webform框架的生命周期" class="header-anchor">#</a> WebForm框架的生命周期</h3> <p><strong>生命周期过程</strong></p> <p>1、请求页面：页请求发生在页生命周期开始之前。</p> <p>2、开始：在开始阶段，将设置页属性，如Request和Response。在此阶段，页还将确定请求是回发请求还是新请求，并设置IsPostBack属性。</p> <p>3、初始化页面：页面初始化期间，可以使用页中的控件，并将设置每个控件的UniqueID属性。如果当前请求是回发请求，则回发数据尚未加载，并且控件属性值尚未还原为视图状态中的值。</p> <p>4、加载页面：加载期间，如果当前请求是回发请求，则将使用从视图状态和控件状态恢复的信息加载控件属性。</p> <p>5、验证：在验证期间，将调用所有验证程序控件的Validate方法，此方法将设置各个验证程序控件和页的IsValid属性。</p> <p>6、回发事件处理：如果请求是回发请求，则将调用所有事件处理程序。</p> <p>7、呈现页面：在页面呈现期间，视图状态将被保存到页面，然后页面将调用每个控件，以将其呈现的输出提供给页的Response属性的OutputStream。</p> <p>8、卸载页面：完全呈现页、将页发送至客户端并准备丢弃时，将调用卸载。此时，将卸载页属性（如Response和Request）并执行清理。</p> <p><strong>生命周期的事件</strong></p> <p>1、PreInit</p> <p>使用该事件来执行下列操作：</p> <p>检查 IsPostBack 属性来确定是不是第一次处理该页。</p> <p>创建或重新创建动态控件。</p> <p>动态设置主控页。</p> <p>动态设置 Theme 属性。</p> <p>读取或设置配置文件属性值。</p> <p>注意：</p> <p>如果请求是回发请求，则控件的值尚未从视图状态还原。如果在此阶段设置控件属性，则其值可能会在下一事件中被重写。</p> <p>2、Init</p> <p>在所有控件都已初始化且已应用所有外观设置后引发。使用该事件来读取或初始化控件属性。</p> <p>3、InitComplete</p> <p>由 Page 对象引发。使用该事件来处理要求先完成所有初始化工作的任务。</p> <p>4、PreLoad</p> <p>如果需要在 Load 事件之前对页或控件执行处理，请使用该事件。</p> <p>在 Page 引发该事件后，它会为自身和所有控件加载视图状态，然后会处理 Request 实例包括的任何回发数据。</p> <p>5、Load</p> <p>Page 在 Page 上调用 OnLoad 事件方法，然后以递归方式对每个子控件执行相同操作，如此循环往复，直到加载完本页和所有控件为止。</p> <p>使用 OnLoad 事件方法来设置控件中的属性并建立数据库连接</p> <p>6、控件事件</p> <p>使用这些事件来处理特定控件事件，如 Button 控件的 Click 事件或 TextBox 控件的 TextChanged 事件。</p> <p>注意：</p> <p>在回发请求中，如果页包含验证程序控件，请在执行任何处理之前检查 Page 和各个验证控件的 IsValid 属性。</p> <p>7、LoadComplete</p> <p>对需要加载页上的所有其他控件的任务使用该事件。</p> <p>8、PreRender</p> <p>在该事件发生前：</p> <p>Page 对象会针对每个控件和页EnsureChildControls。</p> <p>设置了 DataSourceID 属性的每个数据绑定控件会调用 DataBind 方法。有关更多信息，请参见下面的数据绑定控件的数据绑定事件。</p> <p>页上的每个控件都会发生 PreRender 事件。使用该事件对页或其控件的内容进行最后更改。</p> <p>9、SaveStateComplete</p> <p>在该事件发生前，已针对页和所有控件保存了 ViewState。将忽略此时对页或控件进行的任何更改。</p> <p>使用该事件执行满足以下条件的任务：要求已经保存了视图状态，但未对控件进行任何更改。</p> <p>10、Render</p> <p>这不是事件；在处理的这个阶段，Page 对象会在每个控件上调用此方法。所有 http://ASP.NET Web 服务器控件都有一个用于写出发送给浏览器的控件标记的 Render 方法。</p> <p>如果创建自定义控件，通常要重写此方法以输出控件的标记。不过，如果自定义控件只合并标准的 http://ASP.NET Web 服务器控件，不合并自定义标记，则不需要重写 Render 方法。有关更多信息，请参见开发自定义 http://ASP.NET 服务器控件。</p> <p>用户控件（.ascx 文件）自动合并呈现，因此不需要在代码中显式呈现该控件。</p> <p>11、Unload</p> <p>该事件首先针对每个控件发生，继而针对该页发生。在控件中，使用该事件对特定控件执行最后清理，如关闭控件特定数据库连接。</p> <p>对于页自身，使用该事件来执行最后清理工作，如：关闭打开的文件和数据库连接，或完成日志记录或其他请求特定任务。</p> <p>注意</p> <p>在卸载阶段，页及其控件已被呈现，因此无法对响应流做进一步更改如果尝试调用方法（如 Response.Write 方法），则该页将引发异常。</p> <p><img src="C:%5CUsers%5CAdmin%5CDesktop%5C%E5%9F%B9%E8%AE%AD%5CC#%5CtyporaImg%5Cformat.png" alt="format"></p> <h3 id="一般处理程序"><a href="#一般处理程序" class="header-anchor">#</a> 一般处理程序</h3> <blockquote><p>.ashx一般处理程序，特殊文件，阉割版的web窗体</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code> <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AddressHandler</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IHttpHandler</span></span>
 <span class="token punctuation">{</span>

     <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ProcessRequest</span><span class="token punctuation">(</span><span class="token class-name">HttpContext</span> context<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
         <span class="token comment">//接收传来的值</span>
         <span class="token class-name"><span class="token keyword">int</span></span> pid <span class="token operator">=</span> Convert<span class="token punctuation">.</span><span class="token function">ToInt32</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Request<span class="token punctuation">.</span>QueryString<span class="token punctuation">[</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">//返回响应的数据内容</span>
         context<span class="token punctuation">.</span>Response<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>

     <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsReusable
     <span class="token punctuation">{</span>
         <span class="token keyword">get</span>
         <span class="token punctuation">{</span>
             <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre></div><h3 id="跨域设置"><a href="#跨域设置" class="header-anchor">#</a> 跨域设置</h3> <blockquote><p>Web.config文件中写入下列代码</p></blockquote> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!--跨域配置--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>system.webServer</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directoryBrowse</span> <span class="token attr-name">enabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>httpProtocol</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>customHeaders</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Access-Control-Allow-Origin<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>*<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Access-Control-Allow-Headers<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>*<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>customHeaders</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>httpProtocol</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>system.webServer</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="母版页"><a href="#母版页" class="header-anchor">#</a> 母版页</h3> <blockquote><p>以.master为结尾的一种特殊文件。母版页无法运行，页面继承母版页运行。</p></blockquote> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span> <span class="token attr-name">runat</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>server<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Content-Type<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/html; charset=utf-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">asp:</span>ContentPlaceHolder</span> <span class="token attr-name">ID</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>head<span class="token punctuation">&quot;</span></span> <span class="token attr-name">runat</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>server<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">asp:</span>ContentPlaceHolder</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">runat</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>server<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">asp:</span>ContentPlaceHolder</span> <span class="token attr-name">ID</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ContentPlaceHolder1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">runat</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>server<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">asp:</span>ContentPlaceHolder</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>注意：</strong></p> <p>当页面继承母版页时，服务器控件的ID会被编译带上母版页的前缀</p> <p>所以此时，我们在前端获取ID标识的时候需要使用：</p> <div class="language-html extra-class"><pre class="language-html"><code>$(&quot;#&lt;%=txtName.ClientID%&gt;&quot;)
</code></pre></div><h2 id="富文本编辑器"><a href="#富文本编辑器" class="header-anchor">#</a> 富文本编辑器</h2> <blockquote><ol><li>下载富文本编辑器的源代码（前端插件，例如：KindEditor：http://kindeditor.net/down.php）</li> <li>引用插件中的样式和js源文件</li> <li>在页面上方一个标签，利用插件的初始化代码将标签搞成富文本编辑器</li></ol></blockquote> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/kindeditor/themes/default/default.css<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/kindeditor/plugins/code/prettify.css<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>kindeditor/kindeditor-all-min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/kindeditor/lang/zh-CN.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/kindeditor/plugins/code/prettify.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>


<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>textarea</span> <span class="token attr-name">cols</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>30<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rows</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>30<span class="token punctuation">&quot;</span></span> <span class="token attr-name">runat</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>server<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>content1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>textarea</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    KindEditor<span class="token punctuation">.</span><span class="token function">ready</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token constant">K</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> editor1 <span class="token operator">=</span> <span class="token constant">K</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">'#content1'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">cssPath</span><span class="token operator">:</span> <span class="token string">'/kindeditor/plugins/code/prettify.css'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">uploadJson</span><span class="token operator">:</span> <span class="token string">'/kindeditor/asp.net/upload_json.ashx'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">fileManagerJson</span><span class="token operator">:</span> <span class="token string">'/kindeditor/asp.net/file_manager_json.ashx'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">allowFileManager</span><span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">prettyPrint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="哈希表"><a href="#哈希表" class="header-anchor">#</a> 哈希表</h2> <blockquote><p>数据结构，散列的数据格式</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">Newtonsoft<span class="token punctuation">.</span>Json</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections</span><span class="token punctuation">;</span>

<span class="token class-name">Hashtable</span> hashtable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Hashtable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
hashtable<span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;张三&quot;</span><span class="token punctuation">;</span>
hashtable<span class="token punctuation">[</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
hashtable<span class="token punctuation">[</span><span class="token string">&quot;address&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;河南&quot;</span><span class="token punctuation">;</span>

<span class="token comment">//哈希表结构和json结构完全一样的   哈希表序列化为json串</span>
JsonConvert<span class="token punctuation">.</span><span class="token function">SerializeObject</span><span class="token punctuation">(</span>hashtable<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="session"><a href="#session" class="header-anchor">#</a> session</h2> <blockquote><p>Session用于存储特定的用户会话所需的信息 。 Session对象的引入是为了弥补HTTP协议的不足，HTTP协议是一种无状态的协议。</p> <p>系统为<strong>每个</strong>访问者都设立一个<strong>独立</strong>的Session对象，用以存储Session变量，并且各个访问者的Session对象互不干扰。</p> <p>特点：</p> <p>1.session存储在服务器上的</p> <p>2.session只要浏览器不关闭，则数据一直存在，不同浏览器会话是不共享的</p> <p>3.session在服务器上存储后，整个服务器都可以获取他的值</p> <p>缺点：</p> <p>1.存储在服务器上的，所以对服务器有负载损耗，不适合存大量的数据</p> <p>2.Session容易出现丢失（windows）</p></blockquote> <blockquote><p>存session</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>Session<span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;张三&quot;</span><span class="token punctuation">;</span>
</code></pre></div><p>取Session</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">string</span></span> str <span class="token operator">=</span> Session<span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>删Session</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>Session<span class="token punctuation">.</span><span class="token function">Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//清除当前会话中的所有键值信息</span>
Session<span class="token punctuation">.</span><span class="token function">Abandon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//直接消除会话</span>
</code></pre></div></blockquote> <p><strong>配置节点</strong></p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>system.web</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sessionState</span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Off|InProc|StateServer|SQLServer<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">cookieless</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true|false<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">timeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>number of minutes<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">stateConnectionString</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tcpip=server:port<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">sqlConnectionString</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sql connection string<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">stateNetworkTimeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>number of seconds<span class="token punctuation">&quot;</span></span>
    <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>system.web</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><blockquote><p><strong>mode</strong>:设置将Session信息存储到哪里</p> <p>​    Off：不使用Session功能；</p> <p>​    InProc :将Session存储在IIS进程内，这是默认值,也最常用（优点是简单，性能最高。但是当重启IIS服务器时Session丢失。）；</p> <p>​    StateServer ：将Session存储在ASP.NET状态服务进程中（重新启动Web应用程序时保留会话状态，并使会话状态可以用于网络中的多个Web服务器。）；</p> <p>​    SQLServer ：将Session存储在SQL Server中（存储在内存和磁盘中，服务器挂掉重启后都还在）。</p> <p><strong>cookieless</strong>：设置客户端的Session信息存储到哪里</p> <p>​    true 使用Cookieless模式；这时客户端的Session信息就不再使用Cookie存储了，而是将其通过URL存储。</p> <p>​    false 使用Cookie模式，这是默认值。</p> <p><strong>timeout</strong> 设置经过多少分钟后服务器自动放弃Session信息。默认为20分钟。</p> <p>stateConnectionString 设置将Session信息存储在状态服务中时使用的服务器名称和端口号，例如：&quot;tcpip=127.0.0.1:42424”。当mode的值是StateServer是，这个属性是必需的。（默认端口42424）。</p> <p>sqlConnectionString 设置与SQL Server连接时的连接字符串。例如&quot;data source=localhost;Integrated Security=SSPI;Initial Catalog=joye&quot;。当mode的值是SQLServer时，这个属性是必需的。</p> <p>stateNetworkTimeout 设置当使用StateServer模式存储Session状态时，经过多少秒空闲后，断开Web服务器与存储状态信息的服务器的TCP/IP连接的。默认值是10秒钟。</p></blockquote> <p><strong>配置MSSQL中存储Session</strong></p> <p>步骤1：</p> <p>打开cmd，输入cd C:\Windows\Microsoft.NET\Framework\v4.0.30319</p> <p>步骤2：</p> <p>然后输入aspnet_regsql.exe -ssadd -sstype p -S SQLEXPRESS -U 账号 -P 密码 来创建数据库</p> <p>步骤3:</p> <p>在&lt;system.web&gt;节点下配置状态连接串</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sessionState</span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>SQLServer<span class="token punctuation">&quot;</span></span> <span class="token attr-name">sqlConnectionString</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>server=WIN-A8APBAUAJ7J\SQLEXPRESS;uid=sa;pwd=sa;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>sessionState</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>特点：浏览器关闭后，Session不会丢失。</p> <h2 id="cookie"><a href="#cookie" class="header-anchor">#</a> cookie</h2> <p><strong>cookie作用</strong></p> <p>1可以使用cookie对数据进行保存</p> <p>2浏览器会下载文件到cookie 提高加载速度</p> <p><strong>cookie特点</strong></p> <p>1.cookie存储在客户端 存储在用户电脑上</p> <p>2.cookie只要不过期，则一直存在不管浏览器是否关闭计算机是否关闭</p> <p><strong>Cookie的属性</strong></p> <blockquote><p>name：Cookie的名称，Cookie一旦创建，名称便不可更改
value：Cookie的值，如果值为Unicode字符，需要为字符编码。如果为二进制数据，则需要使用BASE64编码
expires： 有效期
secure：该Cookie是否仅被使用安全协议传输。安全协议。安全协议有HTTPS，SSL等，在网络上传输数据之前先将数据加密。默认为false。
path：Cookie的使用路径。如果设置为“/sessionWeb/”，则只有contextPath为“/sessionWeb”的程序可以访问该Cookie。如果设置为“/”，则本域名下contextPath都可以访问该Cookie。注意最后一个字符必须为“/”。
domain：可以访问该Cookie的域名。如果设置为“.google.com”，则所有以“google.com”结尾的域名都可以访问该Cookie。注意第一个字符必须为“.”。</p></blockquote> <p><strong>.NET操作cookie</strong></p> <blockquote><p>存cookie</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//创建一个名为MyCookie一个cookie对象</span>
<span class="token class-name">HttpCookie</span> cookie <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HttpCookie</span><span class="token punctuation">(</span><span class="token string">&quot;MyCookie&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//设置值</span>
cookie<span class="token punctuation">.</span>Value <span class="token operator">=</span> <span class="token string">&quot;helloworld&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//设置有效期</span>
cookie<span class="token punctuation">.</span>Expires <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">.</span><span class="token function">AddDays</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//服务器要求客户端把对象存上去</span>
Response<span class="token punctuation">.</span>Cookies<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>cookie<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>取cookie</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//从客户端取出存的cookie</span>
<span class="token class-name">HttpCookie</span> cookie <span class="token operator">=</span> Request<span class="token punctuation">.</span>Cookies<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">&quot;MyCookie&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>cookie <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Response<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>cookie<span class="token punctuation">.</span>Value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>删cookie</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//服务器不能直接删除cookie    准备一个新cookie名称和之前的相同，有效期过期  覆盖原来的cookie</span>
<span class="token class-name">HttpCookie</span> cookie <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HttpCookie</span><span class="token punctuation">(</span><span class="token string">&quot;MyCookie&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cookie<span class="token punctuation">.</span>Expires <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">.</span><span class="token function">AddDays</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Response<span class="token punctuation">.</span>Cookies<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>cookie<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></blockquote> <p>注意：如果cookie值存汉字需要先编码HttpUtility.UrlEncode()，获取的时候在进行解码HttpUtility.UrlDecode()</p> <p><strong>JavaScript操作cookie</strong></p> <blockquote><p>存cookie</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">&quot;jscookie&quot;</span><span class="token punctuation">;</span> <span class="token comment">//cookie名</span>
<span class="token keyword">var</span> value <span class="token operator">=</span> <span class="token string">&quot;你好&quot;</span><span class="token punctuation">;</span>	<span class="token comment">//cookie值</span>
<span class="token keyword">var</span> exp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//创建一个时间对象</span>
exp<span class="token punctuation">.</span><span class="token function">setTime</span><span class="token punctuation">(</span>exp<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置过期时间为1天</span>
document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> name <span class="token operator">+</span> <span class="token string">&quot;=&quot;</span> <span class="token operator">+</span> <span class="token function">escape</span><span class="token punctuation">(</span> value<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;;expires=&quot;</span> <span class="token operator">+</span> exp<span class="token punctuation">.</span><span class="token function">toGMTString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//转化为东八区时间</span>
</code></pre></div><p>取cookie</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">&quot;_cls_v&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//取值方法：1使用字符串截取  2正则表达式</span>
<span class="token keyword">var</span> arr<span class="token punctuation">,</span> reg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token string">&quot;(^| )jscookie=([^;]*)(;|$)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>arr <span class="token operator">=</span> document<span class="token punctuation">.</span>cookie<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>reg<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token function">unescape</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">else</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</code></pre></div><p>删cookie</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">&quot;jscookie&quot;</span><span class="token punctuation">;</span> <span class="token comment">//cookie名</span>
<span class="token keyword">var</span> value <span class="token operator">=</span> <span class="token string">&quot;你好&quot;</span><span class="token punctuation">;</span>	<span class="token comment">//cookie值</span>
<span class="token keyword">var</span> exp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//创建一个时间对象</span>
exp<span class="token punctuation">.</span><span class="token function">setTime</span><span class="token punctuation">(</span>exp<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置过期时间为当前时间的前一毫秒</span>
document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> name <span class="token operator">+</span> <span class="token string">&quot;=&quot;</span> <span class="token operator">+</span> <span class="token function">escape</span><span class="token punctuation">(</span> value<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;;expires=&quot;</span> <span class="token operator">+</span> exp<span class="token punctuation">.</span><span class="token function">toGMTString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//转化为东八区时间</span>
</code></pre></div></blockquote> <h2 id="cookie与session的联系"><a href="#cookie与session的联系" class="header-anchor">#</a> cookie与session的联系</h2> <p>有时我们会忽略Cookies与Session的关系。但是两者是密不可分的。
Session的唯一标示：SessionID是通常保存在Cookies中的（也可以保存在URL中）。对于Asp.Net而言，SessionID保存在键值为“ASP.NET_SessionId”的Cookies中。</p> <h2 id="cache"><a href="#cache" class="header-anchor">#</a> Cache</h2> <blockquote><p>Cache存储器，<a href="https://baike.baidu.com/item/%E7%94%B5%E8%84%91/124859" target="_blank" rel="noopener noreferrer">电脑<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>中为<a href="https://baike.baidu.com/item/%E9%AB%98%E9%80%9F%E7%BC%93%E5%86%B2%E5%AD%98%E5%82%A8%E5%99%A8/9027270" target="_blank" rel="noopener noreferrer">高速缓冲存储器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，是位于<a href="https://baike.baidu.com/item/CPU/120556" target="_blank" rel="noopener noreferrer">CPU<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>和<a href="https://baike.baidu.com/item/%E4%B8%BB%E5%AD%98%E5%82%A8%E5%99%A8/10635399" target="_blank" rel="noopener noreferrer">主存储器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>DRAM（Dynamic Random Access Memory）之间，规模较小，但速度很高的存储器，通常由<a href="https://baike.baidu.com/item/SRAM/7705927" target="_blank" rel="noopener noreferrer">SRAM<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>（Static Random Access Memory <a href="https://baike.baidu.com/item/%E9%9D%99%E6%80%81%E5%AD%98%E5%82%A8%E5%99%A8/6797116" target="_blank" rel="noopener noreferrer">静态存储器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>）组成。</p></blockquote> <p>ASP.NET、Servlet构建的都是动态页面技术，所谓动态页面技术就是我们的网页内容是经由数据源获取数据，经过一系列逻辑处理后，最终变成一些HTML代码展示给客户端，而计算过程中是有成本的。</p> <p>当数据量变大或者访问量变大时，这些无谓的成本就会越来越高。而有些数据并不是无时无刻不在变化的，如果我们可以将结果缓存起来，那么将极大的提高我们程序的性能。</p> <p><strong>ASP.NET Cache</strong></p> <p>framework平台为了方便我们访问Cache，在httpRuntime类中加入了一个静态属性Cache。另外在ASP.NET中还提供了另一种方便的访问缓存方式：Page.Cache.HttpContext.Cache。通过上述二者，我们可以非常方便的使用Cache。</p> <blockquote><p>特点：</p> <ol><li>存储速度快  读写</li> <li>存储在内存中，无论会话是否关闭，值都会存在framework默认最长时间为20分钟。可以在webconfig中进行配置</li></ol> <p>用途：</p> <ol><li>使用数据读写效率提高。</li> <li>数据更新使用缓存依赖。</li> <li>单账号</li> <li>redis高并发 消峰</li></ol></blockquote> <blockquote><p>使用</p></blockquote> <blockquote><p>存Cache</p> <p>参数1：key（键）</p> <p>参数2：value（值）</p> <p>参数3：dependencies（缓存依赖）---缓存依赖的文件，当文件更改时，该缓存会被移除</p> <p>参数4：absoluteExpiration（绝对过期时间）---从创建开始经过设置时间后删除缓存</p> <p>参数5：slidingExpiration（滑动过期时间）---规定时间内不操作则删除缓存</p> <p><strong>####以下不常用####</strong></p> <p>参数6：priority（对象的相对成本）---具有较低成本的对象最先移出</p> <p>参数7：onRemoveCallback（移出对象时调用的委托）---当缓存对象被移出时执行的函数</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//法一 只是存key-value，默认20分钟过期</span>
Cache<span class="token punctuation">[</span><span class="token string">&quot;User&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//法二 有五个重载方法[(1,2),(1,2,3),(1,2,3,4,5),(1,2,3,4,5,7),(1,2,3,4,5,6,7)]</span>
<span class="token comment">//							没有依赖	绝对过期时间失效		滑动过期时间为10s</span>
Cache<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span><span class="token string">&quot;User&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> DateTime<span class="token punctuation">.</span>MaxValue<span class="token punctuation">,</span> TimeSpan<span class="token punctuation">.</span><span class="token function">FromSeconds</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//法三 所有参数都得写</span>
<span class="token comment">//						没有依赖	绝对过期时间为60s				滑动过期时间失效</span>
Cache<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;User&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">.</span><span class="token function">AddSeconds</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">,</span> TimeSpan<span class="token punctuation">.</span>Zero<span class="token punctuation">,</span>参数<span class="token number">6</span><span class="token punctuation">,</span>参数<span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>取Cache</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//法一</span>
Cache<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">&quot;User&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//法二</span>
Cache<span class="token punctuation">[</span><span class="token string">&quot;User&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>缓存依赖Dependency</strong></p> <blockquote><p>一、文件依赖</p></blockquote> <p>当我们创建CacheDependency依赖类关联一个文件时，当文件内容发生改变，则缓存消失。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">CacheDependency</span> cacheDependency<span class="token operator">=</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">CacheDependency</span><span class="token punctuation">(</span><span class="token string">@&quot;C:\a.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
HttpRuntime<span class="token punctuation">.</span>Cache<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">,</span> cacheDependency<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>二、数据库依赖SqlCacheDependency</p></blockquote> <p>我们的服务器性能损耗主要是发生在查询数据库的时候，所以对数据库的缓存还是显得特别重要，数据如果不变化，用户就一直从缓存中取数据，一旦数据变化，系统能自动更新缓存中的数据，从而让用户得到更好的用户体验。</p> <p><strong>步骤一：修改web.config，让项目启用SqlCacheDependency</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token operator">&lt;</span><span class="token punctuation">?</span><span class="token class-name">xml</span> version<span class="token operator">=</span><span class="token string">&quot;1.0&quot;</span><span class="token punctuation">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>
  有关如何配置 ASP<span class="token punctuation">.</span>NET 应用程序的详细信息，请访问
  http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>go<span class="token punctuation">.</span>microsoft<span class="token punctuation">.</span>com<span class="token operator">/</span>fwlink<span class="token operator">/</span><span class="token punctuation">?</span>LinkId<span class="token operator">=</span><span class="token number">169433</span>
  <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>configuration<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>system<span class="token punctuation">.</span>web<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>caching<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token class-name">sqlCacheDependency</span> enabled<span class="token operator">=</span><span class="token string">&quot;true&quot;</span> pollTime<span class="token operator">=</span><span class="token string">&quot;6000&quot;</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>databases<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token keyword">add</span> name<span class="token operator">=</span><span class="token string">&quot;codematic&quot;</span> connectionStringName<span class="token operator">=</span><span class="token string">&quot;KeDa2023&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>databases<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>sqlCacheDependency<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>caching<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>system<span class="token punctuation">.</span>web<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>connectionStrings<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token keyword">add</span>  name<span class="token operator">=</span><span class="token string">&quot;KeDa2023&quot;</span> connectionString<span class="token operator">=</span><span class="token string">&quot;server=.;database=KeDa2023;uid=sa;pwd=123&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>connectionStrings<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>configuration<span class="token operator">&gt;</span>
</code></pre></div><p><strong>第二步：执行下述命令，为数据库启用缓存依赖。</strong></p> <p>aspnet_regsql.exe工具位于Windows\Microsoft.NET\Framework\[版本]文件夹中。---》进入cmd执行以下命令</p> <p><code>aspnet_regsql -C &quot;data source=.;initial catalog=KeDa2023;user id=sa;password=sa&quot; -ed -et -t &quot;dbo.Users&quot;</code></p> <p>参数-C后面的字符串是连接字符串（请替换成自己所需要的值），</p> <p>参数-t后面的字符串是数据表的名字。</p> <p><img src="C:%5CUsers%5CAdmin%5CDesktop%5C%E5%9F%B9%E8%AE%AD%5CC#%5CtyporaImg%5C%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BE%9D%E8%B5%96.png" alt="数据库依赖"></p> <p>生产成功后，在对应的数据库，会多一个表dbo.AspNet_SqlCacheTablesForChangeNotification</p> <blockquote><p><strong>注意：</strong></p> <p>要使得7.0或者2000版本以上的SQLServer支持SqlCacheDependency特性，需要对数据库服务器执行相关的配置。</p> <p>有两种方法配置SQLServer：</p> <p>一、使用aspnet_regsql命令行工具，</p> <p>二、使用SqlCacheDependencyAdmin类。</p> <p>例如：</p> <p>aspnet_regsql -S &quot;server&quot;-E -d &quot;database&quot;–ed  或者</p> <p>aspnet_regsql -S &quot;server&quot;-E -d &quot;database&quot;-et -t &quot;table&quot;
如果是Sql验证的话要把-E换成，-U (用户名),-P (密码)</p></blockquote> <p><strong>第三步：在代码中使用缓存，并为其设置SqlCacheDependency依赖</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">SqlCacheDependency</span> sqlCacheDependency <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlCacheDependency</span><span class="token punctuation">(</span><span class="token string">&quot;codematic&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;dbo.Users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Cache<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">,</span>sqlCacheDependency<span class="token punctuation">,</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">.</span><span class="token function">AddSeconds</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">,</span>TimeSpan<span class="token punctuation">.</span>Zero<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="i-o读写"><a href="#i-o读写" class="header-anchor">#</a> I/O读写</h2> <blockquote><p>I/O指输入输出，通俗的讲就是使用.Net Framework类库对计算机本地的文件进行读写操作。</p> <p>using System.IO;</p></blockquote> <p>C#读取文件需要五个步骤：</p> <ul><li><p>创建文件流</p></li> <li><p>创建阅读器或写入器</p></li> <li><p>执行读写操作</p></li> <li><p>关闭阅读器或写入器</p></li> <li><p>关闭文件流</p></li></ul> <p><strong>创建文件流</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code> <span class="token class-name">FileStream</span> fileStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span><span class="token string">&quot;c:\\a.txt&quot;</span><span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Create<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//打开方式</span>
<span class="token comment">//1:Create  用指定的名称创建一个新文件,如果文件已经存在则改写旧文件</span>
<span class="token comment">//2:CreateNew 创建一个文件,如果文件存在会发生异常,提示文件已经存在</span>
<span class="token comment">//3:Open 打开一个文件 指定的文件必须存在,否则会发生异常</span>
<span class="token comment">//4:OpenOrCreate 打开一个文件,如果文件不存在则用指定的名称新建一个文件并打开它.</span>
<span class="token comment">//5:Append 打开现有文件,并在文件尾部追加内容.</span>
</code></pre></div><p><strong>创建写入器/读取器</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">StreamWriter</span> mySw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StreamWriter</span><span class="token punctuation">(</span>fileStream<span class="token punctuation">)</span>
<span class="token class-name">StreamReader</span> streamReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StreamReader</span><span class="token punctuation">(</span>fileStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>读示例：</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">FileStream</span> fileStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span><span class="token string">&quot;c:\\a.txt&quot;</span><span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">StreamReader</span> streamReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StreamReader</span><span class="token punctuation">(</span>fileStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> str <span class="token operator">=</span> streamReader<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>str <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    Response<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
streamReader<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fileStream<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>写示例:</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">FileStream</span> fileStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span><span class="token string">&quot;c:\\&quot;</span><span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Create<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">StreamWriter</span> writer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StreamWriter</span><span class="token punctuation">(</span>fileStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
writer<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">&quot;helloworld!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
writer<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fileStream<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>File和Directory</strong></p> <p>.NET框架库中提供了一个File类和Directory类这两个类是<strong>静态的</strong>，使用时直接使用类名调用。</p> <p><strong>File类常用方法</strong></p> <table><thead><tr><th>返回类型</th> <th>方法名称</th> <th>说明</th></tr></thead> <tbody><tr><td>bool</td> <td>Exists(&quot;路径&quot;)</td> <td>用于检查指定文件是否存在</td></tr> <tr><td>void</td> <td>copy(&quot;原路径&quot;,&quot;新路径&quot;)</td> <td>将指定的文件复制到目标地址,如果原文件不存在 则创建一个新的后再复制</td></tr> <tr><td>void</td> <td>Move(&quot;原路径&quot;,&quot;新路径&quot;)</td> <td>将原文件移到新路径</td></tr> <tr><td>void</td> <td>Delete(&quot;路径&quot;)</td> <td>删除指定的文件如果源文件不存在,则发生异常</td></tr></tbody></table> <p><strong>Directory类</strong></p> <table><thead><tr><th>返回值类型</th> <th>方法名称</th> <th>说明</th></tr></thead> <tbody><tr><td>bool</td> <td>Exists(&quot;路径&quot;)</td> <td>检查指定文件夹是否存在</td></tr> <tr><td>void</td> <td>Move(&quot;原路径&quot;,&quot;新路径&quot;)</td> <td>将文件或者目录移动到新的位置</td></tr> <tr><td>void</td> <td>Delete(&quot;路径&quot;,true/false)</td> <td>删除指定的目录,如果第二个参数为true则目录里面的所有目录内容</td></tr></tbody></table> <p>CreateDirectory    创建文件夹</p> <h2 id="字符串处理方法"><a href="#字符串处理方法" class="header-anchor">#</a> 字符串处理方法</h2> <blockquote><p>Substring：字符串截取</p> <p>参数1：起始位置	参数2：长度（如果不指定，默认截取到尾部）</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">string</span></span> name <span class="token operator">=</span> <span class="token string">&quot;20230227001&quot;</span><span class="token punctuation">;</span>
Response<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>name<span class="token punctuation">.</span><span class="token function">Substring</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;&lt;br/&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//2302</span>
</code></pre></div></blockquote> <blockquote><p>IndexOf：获得字符出现的第一个索引位置；LastIndexOf获得字符出现的最后一个索引位置</p> <p>参数：字符</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">tring</span> fileName <span class="token operator">=</span> <span class="token string">@&quot;D:\KeDa\KeDa\img\test.png&quot;</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">string</span></span> ename <span class="token operator">=</span> fileName<span class="token punctuation">.</span><span class="token function">Substring</span><span class="token punctuation">(</span>fileName<span class="token punctuation">.</span><span class="token function">LastIndexOf</span><span class="token punctuation">(</span><span class="token char">'.'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></blockquote> <blockquote><p>Remove：删除指定长度的字符串</p> <p>参数1：产出的起始位置	参数2：删除的长度</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">string</span></span> idList <span class="token operator">=</span> <span class="token string">&quot;1,2,3,4,5,&quot;</span><span class="token punctuation">;</span>
idList <span class="token operator">=</span> idList<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>idList<span class="token punctuation">.</span>Length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1,2,3,4,5</span>
</code></pre></div></blockquote> <blockquote><p>Split：字符串拆分</p> <p>参数：以什么字符进行拆分（字符）</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">string</span></span> idList <span class="token operator">=</span> <span class="token string">&quot;1,2,3,4,5&quot;</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> arr<span class="token operator">=</span>  idList<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span><span class="token char">','</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[1,2,3,4,5]</span>
</code></pre></div></blockquote> <blockquote><p>Contains：字符串包含</p> <p>参数：需要判断的字符串</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">string</span></span> x <span class="token operator">=</span> <span class="token string">&quot;128&quot;</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">string</span></span> y <span class="token operator">=</span> <span class="token string">&quot;8&quot;</span><span class="token punctuation">;</span>
x<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//True</span>
</code></pre></div></blockquote> <blockquote><p>StringBuilder：可变长字符串类，效率远远高于字符串相加，因为只需要进行依次开创空间，回收空间</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Text</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">string</span></span> a <span class="token operator">=</span> <span class="token string">&quot;张三&quot;</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">string</span></span> b <span class="token operator">=</span> <span class="token string">&quot;李四&quot;</span>；
<span class="token class-name">StringBuilder</span> stringBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stringBuilder<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
stringBuilder<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
Response<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>stringBuilder<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//张三李四</span>
</code></pre></div></blockquote> <h2 id="nuget"><a href="#nuget" class="header-anchor">#</a> Nuget</h2> <blockquote><p>Nuget是一个.NET平台下的开源的项目，它是Visual Studio的扩展。在使用[Visual Studio](https://baike.baidu.com/item/Visual Studio/539453) 或.NET CLI开发基于.NET 或.NET Framework的应用时，Nuget能把在项目中添加、移除和更新引用的工作变得更加快捷方便。</p> <p>作用：可以通过nuget命令直接在联网的状态下安装程序包,这样就不需要自己下载导入。</p></blockquote> <p>使用时注意：</p> <p>vs中需要配置nuget.org的仓库地址</p> <div class="language-shell extra-class"><pre class="language-shell"><code>https://api.nuget.org/v3/index.json
</code></pre></div><p>安装命令</p> <div class="language-shell extra-class"><pre class="language-shell"><code>install-package 包名 <span class="token parameter variable">-version</span> 版本号（可选参数）
</code></pre></div><h2 id="序列化与反序列化"><a href="#序列化与反序列化" class="header-anchor">#</a> 序列化与反序列化</h2> <blockquote><p>序列化：指将对象转化为可供传输的数据格式。</p> <p>反序列化：指将传输的数据格式转化为对象。</p> <p>数据传输格式一般指的是可跨平台的数据格式，例如：JSON、XML</p></blockquote> <p><strong>.NET序列化组件</strong></p> <blockquote><p>方式一：使用FW内置类库<strong>JavaScriptSerializer</strong></p> <p>使用JavaScriptSerializer方式需要引入的命名空间，这个在程序集System.Web.Extensions.dll.中。</p> <p>using System.Web.Script.Serialization;</p> <p>注意：可用[ScriptIgnore] 标记不序列化的属性</p></blockquote> <blockquote><p>方式二：使用<strong>Newtonsoft.Json</strong>类库进行</p> <p>Newtonsoft.JSON是一个第三方的序列化反序列化库</p> <p>序列化方法：</p> <p>JsonConvert.SerializeObject(对象)</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">Newtonsoft<span class="token punctuation">.</span>Json</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">string</span></span> jsonDs <span class="token operator">=</span> JsonConvert<span class="token punctuation">.</span><span class="token function">SerializeObject</span><span class="token punctuation">(</span>ds<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//放入一个对象</span>
</code></pre></div><p>反序列化方法：</p> <p>JsonConvert.DeserializeObject&lt;Student&gt;(json串)、JsonConvert.DeserializeObject(json串)</p> <p><strong>注意：如果值为对象则用<code>Json.Linq</code>提供的JObject类型接收，如果为数组用JArray类型接收</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">Newtonsoft<span class="token punctuation">.</span>Json</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Newtonsoft<span class="token punctuation">.</span>Json<span class="token punctuation">.</span>Linq</span><span class="token punctuation">;</span>

<span class="token comment">//场景一：得到的json串和实体结构是相同的</span>
<span class="token class-name">Student</span> s2<span class="token operator">=</span>   JsonConvert<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">DeserializeObject</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Student<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>jsonStr<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//场景二：得到的json串非常的长，我们需要取得其中某一个字段内容</span>
<span class="token class-name">JObject</span> obj<span class="token operator">=</span>  <span class="token punctuation">(</span>JObject<span class="token punctuation">)</span>JsonConvert<span class="token punctuation">.</span><span class="token function">DeserializeObject</span><span class="token punctuation">(</span>str3<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//返回JObject类型，要用JObject接收</span>
</code></pre></div></blockquote> <h2 id="xml"><a href="#xml" class="header-anchor">#</a> XML</h2> <p>格式</p> <p>1需要有标注</p> <p>2有且只有一个根标记</p> <div class="language-XML extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>student</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>student</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>DTD</strong></p> <p>文档类型定义:对xml元素进行约束。</p> <p><strong>XML Schema</strong></p> <p>下面这个例子是一个名为 &quot;note.xsd&quot; 的 XML Schema 文件，它定义了上面那个 XML 文档的元素：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xs:</span>schema</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xs</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema<span class="token punctuation">&quot;</span></span>
<span class="token attr-name">targetNamespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3school.com.cn<span class="token punctuation">&quot;</span></span>
<span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3school.com.cn<span class="token punctuation">&quot;</span></span>
<span class="token attr-name">elementFormDefault</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>qualified<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xs:</span>element</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>note<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xs:</span>complexType</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xs:</span>sequence</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xs:</span>element</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>to<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>xs:string<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xs:</span>element</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>from<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>xs:string<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xs:</span>element</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>heading<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>xs:string<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xs:</span>element</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>body<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>xs:string<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xs:</span>sequence</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xs:</span>complexType</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xs:</span>element</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xs:</span>schema</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>使用.NET读XML文件</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>XML</span><span class="token punctuation">;</span>

<span class="token comment">//创建一个xml文档对象</span>
<span class="token class-name">XmlDocument</span> xmlDoc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">XmlDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">string</span></span> fileUrl <span class="token operator">=</span> Server<span class="token punctuation">.</span><span class="token function">MapPath</span><span class="token punctuation">(</span><span class="token string">&quot;S_Province.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//通过文件路径加载一个xml文件	/					通过字符串加载xml</span>
xmlDoc<span class="token punctuation">.</span><span class="token function">Load</span><span class="token punctuation">(</span>fileUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token operator">/</span>				xmlDoc<span class="token punctuation">.</span><span class="token function">LoadXml</span><span class="token punctuation">(</span>fileUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//分析文档结构	xmlDoc.SelectSingleNode('XPath语法');查询一个节点，</span>
<span class="token comment">//				xmlDoc.SelectNodes(&quot;XPath语法&quot;);查询一堆节点，</span>
<span class="token class-name">XmlNode</span> root <span class="token operator">=</span> xmlDoc<span class="token punctuation">.</span><span class="token function">SelectSingleNode</span><span class="token punctuation">(</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//所有省份节点</span>
<span class="token class-name">XmlNodeList</span> provinceList <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token function">SelectNodes</span><span class="token punctuation">(</span><span class="token string">&quot;Province&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">XmlNode</span> province <span class="token keyword">in</span> provinceList<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Response<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>province<span class="token punctuation">.</span><span class="token function">SelectSingleNode</span><span class="token punctuation">(</span><span class="token string">&quot;ProvinceName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>InnerText<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Response<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>province<span class="token punctuation">.</span><span class="token function">SelectSingleNode</span><span class="token punctuation">(</span><span class="token string">&quot;ProvinceID&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>InnerText<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>使用.NET写XML文件</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//读取表中的数据</span>
<span class="token class-name">DataSet</span> ds <span class="token operator">=</span> KangHui<span class="token punctuation">.</span>BaseClass<span class="token punctuation">.</span>DbHelperSQL<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span>KangHui<span class="token punctuation">.</span>Common<span class="token punctuation">.</span>ConfigHelper<span class="token punctuation">.</span><span class="token function">GetConnectionString</span><span class="token punctuation">(</span><span class="token string">&quot;sqlserver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//创建一个xml对象</span>
<span class="token class-name">XmlDocument</span> xmlDoc<span class="token operator">=</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">XmlDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//创建一个描述头</span>
<span class="token class-name">XmlDeclaration</span> xmlDeclaration <span class="token operator">=</span> xmlDoc<span class="token punctuation">.</span><span class="token function">CreateXmlDeclaration</span><span class="token punctuation">(</span><span class="token string">&quot;1.0&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;no&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//把我们声明的描述头添加到xml对象中</span>
xmlDoc<span class="token punctuation">.</span><span class="token function">AppendChild</span><span class="token punctuation">(</span>xmlDeclaration<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//创建一个根元素</span>
<span class="token class-name">XmlNode</span> root <span class="token operator">=</span> xmlDoc<span class="token punctuation">.</span><span class="token function">CreateElement</span><span class="token punctuation">(</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//根元素加到xml对象中</span>
xmlDoc<span class="token punctuation">.</span><span class="token function">AppendChild</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//写内容</span>
<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">DataRow</span> dr <span class="token keyword">in</span> ds<span class="token punctuation">.</span>Tables<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Rows<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//创建一个省份元素节点</span>
    <span class="token class-name">XmlNode</span> provinceNode <span class="token operator">=</span> xmlDoc<span class="token punctuation">.</span><span class="token function">CreateElement</span><span class="token punctuation">(</span><span class="token string">&quot;Province&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//创建两个子节点</span>
    <span class="token class-name">XmlNode</span> idNode<span class="token operator">=</span> xmlDoc<span class="token punctuation">.</span><span class="token function">CreateElement</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//创建了一个id节点</span>
    idNode<span class="token punctuation">.</span>InnerText <span class="token operator">=</span> dr<span class="token punctuation">[</span><span class="token string">&quot;ProvinceID&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">XmlNode</span> nameNode <span class="token operator">=</span> xmlDoc<span class="token punctuation">.</span><span class="token function">CreateElement</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    nameNode<span class="token punctuation">.</span>InnerText <span class="token operator">=</span> dr<span class="token punctuation">[</span><span class="token string">&quot;ProvinceName&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//将两个子元素节点加到省份元素节点中</span>
    provinceNode<span class="token punctuation">.</span><span class="token function">AppendChild</span><span class="token punctuation">(</span>idNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    provinceNode<span class="token punctuation">.</span><span class="token function">AppendChild</span><span class="token punctuation">(</span>nameNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//将省份元素节点加到根元素节点中</span>
    root<span class="token punctuation">.</span><span class="token function">AppendChild</span><span class="token punctuation">(</span>provinceNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name"><span class="token keyword">string</span></span> path <span class="token operator">=</span> Server<span class="token punctuation">.</span><span class="token function">MapPath</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\\&quot;</span><span class="token operator">+</span><span class="token string">&quot;test.xml&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//保存xml文件</span>
xmlDoc<span class="token punctuation">.</span><span class="token function">Save</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>总结：JSON和XML的优缺点是什么？</p> <p>xml优点：xml可以对数据内容进行DTD校验，约束内容；json不可以。严格性上，xml更规范。</p> <p>xml缺点：繁琐，虽然有xpath表达式，但是还是不如json方便。</p> <p>主流：JSON</p> <h2 id="xpath表达式"><a href="#xpath表达式" class="header-anchor">#</a> XPath表达式</h2> <p>常用路径表达式参考：</p> <table><thead><tr><th style="text-align:left;">表达式</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;">nodename</td> <td style="text-align:left;">选取此节点的所有子节点。</td></tr> <tr><td style="text-align:left;">/</td> <td style="text-align:left;">从根节点选取。</td></tr> <tr><td style="text-align:left;">//</td> <td style="text-align:left;">从匹配选择的当前节点选择文档中的节点，而不考虑它们的位置。</td></tr> <tr><td style="text-align:left;">.</td> <td style="text-align:left;">选取当前节点。</td></tr> <tr><td style="text-align:left;">..</td> <td style="text-align:left;">选取当前节点的父节点。</td></tr> <tr><td style="text-align:left;">@</td> <td style="text-align:left;">选取属性。</td></tr></tbody></table> <table><thead><tr><th style="text-align:left;">路径表达式</th> <th style="text-align:left;">结果</th></tr></thead> <tbody><tr><td style="text-align:left;">bookstore</td> <td style="text-align:left;">选取 bookstore 元素的所有子节点。</td></tr> <tr><td style="text-align:left;">/bookstore</td> <td style="text-align:left;">选取根元素 bookstore。注释：假如路径起始于正斜杠( / )，则此路径始终代表到某元素的绝对路径！</td></tr> <tr><td style="text-align:left;">bookstore/book</td> <td style="text-align:left;">选取属于 bookstore 的子元素的所有 book 元素。</td></tr> <tr><td style="text-align:left;">//book</td> <td style="text-align:left;">选取所有 book 子元素，而不管它们在文档中的位置。</td></tr> <tr><td style="text-align:left;">bookstore//book</td> <td style="text-align:left;">选择属于 bookstore 元素的后代的所有 book 元素，而不管它们位于 bookstore 之下的什么位置。</td></tr> <tr><td style="text-align:left;">//@lang</td> <td style="text-align:left;">选取名为 lang 的所有属性。</td></tr></tbody></table> <table><thead><tr><th style="text-align:left;">路径表达式</th> <th style="text-align:left;">结果</th></tr></thead> <tbody><tr><td style="text-align:left;">/bookstore/book[1]</td> <td style="text-align:left;">选取属于 bookstore 子元素的第一个 book 元素。</td></tr> <tr><td style="text-align:left;">/bookstore/book[last()]</td> <td style="text-align:left;">选取属于 bookstore 子元素的最后一个 book 元素。</td></tr> <tr><td style="text-align:left;">/bookstore/book[last()-1]</td> <td style="text-align:left;">选取属于 bookstore 子元素的倒数第二个 book 元素。</td></tr> <tr><td style="text-align:left;">/bookstore/book[position()❤️]</td> <td style="text-align:left;">选取最前面的两个属于 bookstore 元素的子元素的 book 元素。</td></tr> <tr><td style="text-align:left;">//title[@lang]</td> <td style="text-align:left;">选取所有拥有名为 lang 的属性的 title 元素。</td></tr> <tr><td style="text-align:left;">//title[@lang='eng']</td> <td style="text-align:left;">选取所有 title 元素，且这些元素拥有值为 eng 的 lang 属性。</td></tr> <tr><td style="text-align:left;">/bookstore/book[price&gt;35.00]</td> <td style="text-align:left;">选取 bookstore 元素的所有 book 元素，且其中的 price 元素的值须大于 35.00。</td></tr> <tr><td style="text-align:left;">/bookstore/book[price&gt;35.00]/title</td> <td style="text-align:left;">选取 bookstore 元素中的 book 元素的所有 title 元素，且其中的 price 元素的值须大于 35.00。</td></tr></tbody></table> <table><thead><tr><th style="text-align:left;">通配符</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;">*</td> <td style="text-align:left;">匹配任何元素节点。</td></tr> <tr><td style="text-align:left;">@*</td> <td style="text-align:left;">匹配任何属性节点。</td></tr> <tr><td style="text-align:left;">node()</td> <td style="text-align:left;">匹配任何类型的节点。</td></tr></tbody></table> <table><thead><tr><th style="text-align:left;">路径表达式</th> <th style="text-align:left;">结果</th></tr></thead> <tbody><tr><td style="text-align:left;">/bookstore/*</td> <td style="text-align:left;">选取 bookstore 元素的所有子元素。</td></tr> <tr><td style="text-align:left;">//*</td> <td style="text-align:left;">选取文档中的所有元素。</td></tr> <tr><td style="text-align:left;">//title[@*]</td> <td style="text-align:left;">选取所有带有属性的 title 元素。</td></tr></tbody></table> <table><thead><tr><th style="text-align:left;">路径表达式</th> <th style="text-align:left;">结果</th></tr></thead> <tbody><tr><td style="text-align:left;">//book/title | //book/price</td> <td style="text-align:left;">选取 book 元素的所有 title 和 price 元素。</td></tr> <tr><td style="text-align:left;">//title | //price</td> <td style="text-align:left;">选取文档中的所有 title 和 price 元素。</td></tr> <tr><td style="text-align:left;">/bookstore/book/title  //price</td> <td style="text-align:left;">选取属于 bookstore 元素的 book 元素的所有 title 元素，以及文档中所有的 price 元素。</td></tr></tbody></table> <h2 id="远程访问类-webclient"><a href="#远程访问类-webclient" class="header-anchor">#</a> 远程访问类（WebClient）</h2> <blockquote><p>使用</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Net</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Text</span><span class="token punctuation">;</span>

<span class="token comment">//利用远程请求类去访问淘宝</span>
<span class="token class-name">WebClient</span> wc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">WebClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> byteArray <span class="token operator">=</span> wc<span class="token punctuation">.</span><span class="token function">DownloadData</span><span class="token punctuation">(</span><span class="token string">&quot;https://www.taobao.com/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//把比特数组转化成字符串</span>
<span class="token class-name"><span class="token keyword">string</span></span> html <span class="token operator">=</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span>byteArray<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//在进行反序列化等后续操作</span>
</code></pre></div></blockquote> <h2 id="html解析库htmlagilitypack"><a href="#html解析库htmlagilitypack" class="header-anchor">#</a> HTML解析库HtmlAgilityPack</h2> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Net</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">HtmlAgilityPack</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Text</span><span class="token punctuation">;</span>


<span class="token class-name">WebClient</span> webClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">WebClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">string</span></span> cityName <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> byteStr <span class="token operator">=</span> webClient<span class="token punctuation">.</span><span class="token function">DownloadData</span><span class="token punctuation">(</span><span class="token string">&quot;https://soso.nipic.com/?q=&quot;</span><span class="token operator">+</span> cityName <span class="token operator">+</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">string</span></span> html <span class="token operator">=</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span>byteStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">HtmlDocument</span> htmlDoc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HtmlDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//实例化一个html文档对象</span>
htmlDoc<span class="token punctuation">.</span><span class="token function">LoadHtml</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//把网络请求得到的站点string赋给html文档对象</span>
<span class="token class-name">HtmlNodeCollection</span> liList <span class="token operator">=</span> htmlDoc<span class="token punctuation">.</span>DocumentNode<span class="token punctuation">.</span><span class="token function">SelectNodes</span><span class="token punctuation">(</span><span class="token string">&quot;xpath语法&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">HtmlNode</span> item <span class="token keyword">in</span> liList<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">WebClient</span> imgClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">WebClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">HtmlNode</span> imgNode <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">SelectSingleNode</span><span class="token punctuation">(</span><span class="token string">&quot;a/img&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">string</span></span> imgPath <span class="token operator">=</span> imgNode<span class="token punctuation">.</span>Attributes<span class="token punctuation">[</span><span class="token string">&quot;data-original&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Value<span class="token punctuation">;</span>
  imgClient<span class="token punctuation">.</span><span class="token function">DownloadFile</span><span class="token punctuation">(</span><span class="token string">&quot;https:&quot;</span><span class="token operator">+</span>imgPath<span class="token punctuation">,</span>Server<span class="token punctuation">.</span><span class="token function">MapPath</span><span class="token punctuation">(</span><span class="token string">&quot;img&quot;</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\&quot;</span><span class="token operator">+</span>imgPath<span class="token punctuation">.</span><span class="token function">Substring</span><span class="token punctuation">(</span>imgPath<span class="token punctuation">.</span><span class="token function">LastIndexOf</span><span class="token punctuation">(</span><span class="token char">'/'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    i<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="类库"><a href="#类库" class="header-anchor">#</a> 类库</h2> <p>随着开发时间越来越长，我们自己写的帮助类就越来越多，帮助类在其他项目中使用麻烦（复制）,源代码会暴露。</p> <p>需求：即希望不同的项目都能用，还希望他源代码不要暴露。</p> <p>就是一个.NET项目文件，在这类库中存放的都是类。</p> <p>类库可以编译生成为.dll程序集文件,程序集文件相当于一个程序包，可以让任何项目调用类库中的方法。</p> <h3 id="康辉类库的使用"><a href="#康辉类库的使用" class="header-anchor">#</a> 康辉类库的使用</h3> <p><strong>common</strong></p> <p><code>ConfigHelper.cs</code>配置帮助类</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appSettings</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sql<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appSettings</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>connectionStrings</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>usersConn<span class="token punctuation">&quot;</span></span> <span class="token attr-name">connectionString</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Data Source=.;DataBase=users;Integrated Security=True;<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>connectionStrings</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token function">GetAppSetting</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//得到webconfig中appSettings节点key对应的value值</span>
<span class="token function">GetConnectionString</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token comment">//得到webconfig中connectionStrings节点name对应的connectionString值</span>
</code></pre></div><p><code>ConvertHelper.cs</code>类型转换帮助类</p> <p><code>DateTimeHelper.cs</code>时间帮助类</p> <p><code>EncryptionHelper.cs</code>加密帮助类</p> <blockquote><p>tips：康辉类库里MD5加密存在问题，有时候会出现31位加密后的字符串</p></blockquote> <p><code>FileHelper.cs</code>文件处理帮助类</p> <p><code>ImageHelper.cs</code>图片处理帮助类</p> <p><code>ScriptHelper.cs</code>页面脚本帮助类</p> <p><code>Rand.cs</code>验证码帮助类</p> <h3 id="webcontrols使用"><a href="#webcontrols使用" class="header-anchor">#</a> WebControls使用</h3> <p><strong>AspNetPager分页控件</strong></p> <p>1）在页面上注册分页组件</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!--Assembly数据集			Namespace命名空间		TagPrefix控件前缀 --&gt;</span>
&lt;%@ Register Assembly=&quot;KangHui.WebControls&quot; Namespace=&quot;KangHui.WebControls&quot; TagPrefix=&quot;uc&quot; %&gt;
</code></pre></div><p>2）在页面上创建组件</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!--PageSize一页的数据个数 runat转为服务器控件--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">uc:</span>AspNetPager</span> <span class="token attr-name">ID</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pagerCut<span class="token punctuation">&quot;</span></span> <span class="token attr-name">PageSize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span> <span class="token attr-name">runat</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>server<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">uc:</span>AspNetPager</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>3）将显示组件和分页进行捆绑，调用PagerBase类中的BindData方法</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>PagerBase<span class="token punctuation">.</span><span class="token function">BindData</span><span class="token punctuation">(</span>rptProvince<span class="token punctuation">,</span> pager<span class="token punctuation">,</span> <span class="token string">&quot;SELECT * FROM S_Province&quot;</span><span class="token punctuation">,</span> connString<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>4）设置分页的跳页事件（PageChanged）</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    PagerBase<span class="token punctuation">.</span><span class="token function">BindData</span><span class="token punctuation">(</span>repProvince<span class="token punctuation">,</span> pagerCut<span class="token punctuation">,</span> <span class="token string">&quot;SELECT * FROM S_Province&quot;</span><span class="token punctuation">,</span> connString<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">pagerCut_PageChanged</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="三层架构"><a href="#三层架构" class="header-anchor">#</a> 三层架构</h2> <p>多层架构是只将一个项目分割成若干个层，在每个层中负责不同的任务，将项目的业务、表现、数据读取拆分，形成多个不同的层。</p> <p>常见的有<strong>三层架构</strong>：</p> <p><img src="https://bkimg.cdn.bcebos.com/pic/7c1ed21b0ef41bd50470c3645fda81cb39db3d7a?x-bce-process=image/resize,m_lfit,w_440,limit_1/format,f_auto" alt="三层架构"></p> <p><strong>表现层UI</strong> userinterface                              Web</p> <p>表现层指的是网站，即用户所看到的。</p> <p><strong>业务逻辑层BLL</strong> bussniess logic layer       Service</p> <p>业务逻辑层指的是处理业务行为的部分。</p> <p><strong>数据访问层DAL</strong> Data Access Layer            DAO</p> <p>数据读写的，对数据库进行CURD操作。</p> <p><strong>分层的优点</strong></p> <p>1.高内聚、低耦合，可以降低层与层之间的依赖。</p> <p>2.各层互相独立，完成自己该完成的任务，项目可以多人同时开发，开发人员可以只关注整个结构中的其中某一层。</p> <p>3.容易移植、维护，如 B / S 转 C / S、SQLServer 转 Oracle、添加、修改、删除等。</p> <p>4.安全性高。用户端只能通过业务逻辑层来调用数据访问层，减少了入口点，把很多危险的系统功能都屏蔽了。</p> <p><strong>缺点</strong></p> <p>1.开发难度大。</p> <p>2.工作量大。</p> <h3 id="实体"><a href="#实体" class="header-anchor">#</a> 实体</h3> <p>在架构设计中，有一个实体的概念，我们通常称之为：model、entity、POJO...</p> <p>所谓的实体，指的是对数据库中表的一种映射，在面向对象语言中，我们使用类来对数据库的表结构进行映射。</p> <p>映射的这个类，就叫做<strong>实体对象</strong>。</p> <p>作用：</p> <p>使用实体对表结构进行映射，在我们处理表的时候，实际上就是对实体的处理。使各层级之间传递数据更加的方便、高效。</p> <h3 id="dal层需掌握的方法"><a href="#dal层需掌握的方法" class="header-anchor">#</a> DAL层需掌握的方法：</h3> <p>GetList:查询   返回DataSet
Delete:删除   参数：主键    返回bool
Add：添加     参数：实体    返回新主键
Update:更新   参数：实体（不是空实体）   返回bool
GetModel:通过id获取一个数据库实体   参数：主键   返回数据库实体</p> <h2 id="orm对象关系映射"><a href="#orm对象关系映射" class="header-anchor">#</a> ORM对象关系映射</h2> <p>什么是ORM
ORM(Object-relational mapping)，中文翻译为对象关系映射，是一种为了解决面向对象与关系数据库存在的互不匹配的现象的技术。简单的说，ORM是通过使用描述对象和数据库之间映射的元数据，将程序中的<strong>对象</strong>自动持久化到关系数据库中。</p> <p>为什么用ORM
在程序开发中，数据库保存的表，字段与程序中的实体类之间是没有关联的，在实现持久化时就比较不方便。那么，到底如何实现持久化呢？一种简单的方案是采用硬编码方式，为每一种可能的数据库访问操作提供单独的方法。这种方案存在以下不足：</p> <p>1.持久化层缺乏弹性。一旦出现业务需求的变更，就必须修改持久化层的接口
2.持久化层同时与域模型与关系数据库模型绑定，不管域模型还是关系数据库模型发生变化，都要修改持久化曾的相关程序代码，增加了软件的维护难度
ORM提供了实现持久化层的另一种模式，它采用<strong>映射元数据</strong>来描述<strong>对象关系的映射</strong>，使得ORM中间件能在任何一个应用的业务逻辑层和数据库层之间充当桥梁</p> <p>ORM的方法论基于三个核心原则：</p> <p>简单：以最基本的形式建模数据
传达性：数据库结构被任何人都能理解的语言文档化
精确性：基于数据模型创建正确标准化了的结构</p> <p>ORM作用：<strong>实现了数据库的映射</strong>  通俗讲就是2件事：1创建数据模型（EntityFramework）     2实现底层的增删改查等数据库常规操作</p> <p>常用的ORM</p> <div class="language-shell extra-class"><pre class="language-shell"><code>.NET<span class="token punctuation">(</span>C<span class="token comment">#)主流ORM总揽</span>

*SqlSugar <span class="token punctuation">(</span>国内<span class="token punctuation">)</span> 轻量化，执行速度快	//SqlSugar支持lambda和SQL

Dos.ORM <span class="token punctuation">(</span>国内<span class="token punctuation">)</span>

Chloe <span class="token punctuation">(</span>国内<span class="token punctuation">)</span>

*StackExchange/Dapper <span class="token punctuation">(</span>国外<span class="token punctuation">)</span> 轻量化，执行速度   //Dapper只支持SQL

*Entity Framework <span class="token punctuation">(</span>EF<span class="token punctuation">)</span> <span class="token punctuation">(</span>国外<span class="token punctuation">)</span> 全能型  懒加载 

*NHibernate <span class="token punctuation">(</span>国外<span class="token punctuation">)</span>

ServiceStack/ServiceStack.OrmLite <span class="token punctuation">(</span>国外<span class="token punctuation">)</span>

linq2db <span class="token punctuation">(</span>国外<span class="token punctuation">)</span>

Massive <span class="token punctuation">(</span>国外<span class="token punctuation">)</span>

PetaPoco <span class="token punctuation">(</span>国外<span class="token punctuation">)</span>
Dapper（国内） 执行速度最快

Java

*Mybatis

*Hibernate
</code></pre></div><h3 id="ef的创建方式"><a href="#ef的创建方式" class="header-anchor">#</a> EF的创建方式</h3> <p>CodeFirst:代码优先，先有代码后又数据库。</p> <p>CodeBehind：代码后置，先设计数据库再编写代码。</p> <p>注意：没有绝对好的，各自都有自己的优点和缺点。</p> <p>EF中的两个类</p> <p>DbContext:若干表的一个集合。</p> <p>DbSet：对表映射，提供对表的常规操作方法。</p> <p>方式一：</p> <p>通过VS中的向导工具创建</p> <blockquote><p>在项目里创建一个类库---》右键添加---》ADO.NET实体数据模型</p></blockquote> <p>方式二：</p> <p>半自动创建</p> <blockquote><p>步骤一：创建一个类库Model</p> <p>步骤二：右键添加---》ADO.NET实体数据模型---》来自数据库的code first</p></blockquote> <p>方式三：</p> <p>纯手动创建</p> <blockquote><p>步骤一：在类库里新建一个集合类（KeDa2023DBContext）</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Data<span class="token punctuation">.</span>Entity</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">FacTest<span class="token punctuation">.</span>Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">KeDa2023DBContext</span><span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">DbContext</span></span>
    <span class="token punctuation">{</span>
        <span class="token comment">//构造函数</span>
        <span class="token keyword">public</span> <span class="token function">KeDa2023DBContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span><span class="token string">&quot;KeDaEntities&quot;</span><span class="token punctuation">)</span> <span class="token comment">//Webcofig中的key值(对应的连接字符串)</span>
        <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//		在虚拟数据库中加载一个表</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">DbSet<span class="token punctuation">&lt;</span>Student<span class="token punctuation">&gt;</span></span> Users <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>步骤二：根据数据库表编写表类</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>ComponentModel<span class="token punctuation">.</span>DataAnnotations</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">FacTest<span class="token punctuation">.</span>Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Student</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 标明为主键</span>
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Key</span></span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token comment">//    可空整形</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">Nullable<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span> IsDelete <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> UserName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> ImageUrl <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Pwd <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>步骤三：将类注册在数据库上下文对象中（步骤一中加载表）</p> <p>步骤四：配置连接字符串</p> <p><code>Web.config</code></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>
</code></pre></div></blockquote> <h3 id="通过ef对数据进行增删改查"><a href="#通过ef对数据进行增删改查" class="header-anchor">#</a> 通过EF对数据进行增删改查</h3> <blockquote><p>法一：</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">EntityDbContext</span><span class="token punctuation">;</span>

<span class="token comment">// 实例化我们的ORM对象关系映射(虚拟数据库)</span>
<span class="token class-name">KeDa2023Entities</span> db <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">KeDa2023Entities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//查询</span>
<span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>Article<span class="token punctuation">&gt;</span></span> sList <span class="token operator">=</span> db<span class="token punctuation">.</span>Article<span class="token punctuation">;</span>
<span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token class-name">Article</span> s <span class="token keyword">in</span> sList<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Response<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//删除</span>
<span class="token comment">//获得一个实体</span>
<span class="token class-name">Article</span> model <span class="token operator">=</span> db<span class="token punctuation">.</span>Article<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span>Article<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//插入</span>
<span class="token class-name">Article</span> newModel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Article</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
newModel<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">&quot;测试&quot;</span><span class="token punctuation">;</span>
newModel<span class="token punctuation">.</span>detail <span class="token operator">=</span> <span class="token string">&quot;这是一个测试内容&quot;</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span>Article<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>newModel<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//保存数据</span>
db<span class="token punctuation">.</span><span class="token function">SaveChanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>法二：</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">EntityDbContext</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Data<span class="token punctuation">.</span>Entity</span><span class="token punctuation">;</span>

<span class="token comment">// 实例化我们的ORM对象关系映射(虚拟数据库)</span>
<span class="token class-name">KeDa2023Entities</span> db <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">KeDa2023Entities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Article</span> model <span class="token operator">=</span> db<span class="token punctuation">.</span>Article<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//删除</span>
db<span class="token punctuation">.</span><span class="token function">Entry</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">.</span>State <span class="token operator">=</span> EntityState<span class="token punctuation">.</span>Deleted<span class="token punctuation">;</span>

<span class="token comment">//更新</span>
model<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">&quot;测试更改&quot;</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span><span class="token function">Entry</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">.</span>State <span class="token operator">=</span> EntityState<span class="token punctuation">.</span>Modified<span class="token punctuation">;</span>

<span class="token comment">//插入</span>
<span class="token class-name">Article</span> newModel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Article</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
newModel<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">&quot;插入测试&quot;</span><span class="token punctuation">;</span>
newModel<span class="token punctuation">.</span>detail <span class="token operator">=</span> <span class="token string">&quot;测试内容&quot;</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span><span class="token function">Entry</span><span class="token punctuation">(</span>newModel<span class="token punctuation">)</span><span class="token punctuation">.</span>State <span class="token operator">=</span> EntityState<span class="token punctuation">.</span>Added<span class="token punctuation">;</span>
db<span class="token punctuation">.</span><span class="token function">SaveChanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>延时加载（懒加载）</strong></p> <blockquote><p>目的：提高效率</p> <p>EF是一个虚拟的数据库，</p> <p>1.在查询时，EF给的数据在渲染页面的时候才能看见；</p> <p>2.EF在操作数据时，如果不进行db.SaveChanges()那么将一直保存惰性加载机制</p> <p>注意：调试过程中可以使用.ToList()结束懒加载</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//程序运行完这一步时orm并不会去数据库中查询数据直到你使用到slist中的值的时候才会去数据库中查询</span>
<span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>Article<span class="token punctuation">&gt;</span></span> slist <span class="token operator">=</span> db<span class="token punctuation">.</span>Article<span class="token punctuation">;</span>
<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">Article</span> item <span class="token keyword">in</span> slist<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//关闭懒加载模式 用list链表的ToList方法可以关闭延时加载</span>
<span class="token class-name">List<span class="token punctuation">&lt;</span>Article<span class="token punctuation">&gt;</span></span> slist <span class="token operator">=</span> db<span class="token punctuation">.</span>Article<span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">Article</span> item <span class="token keyword">in</span> slist<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="ef常用的方法"><a href="#ef常用的方法" class="header-anchor">#</a> EF常用的方法</h3> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token number">1</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>结束懒加<span class="token comment">//懒加载</span>
<span class="token number">2</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token punctuation">)</span>通过主键获取一个对象
<span class="token number">3</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">4</span><span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">5</span><span class="token punctuation">.</span><span class="token function">OrderBy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">6</span><span class="token punctuation">.</span><span class="token function">Take</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>   top  <span class="token number">5</span>
<span class="token number">7</span><span class="token punctuation">.</span><span class="token function">Skip</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>   跳过前<span class="token number">5</span>条
<span class="token number">8</span><span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>查询</strong></p> <h4 id="lambda表达式写法"><a href="#lambda表达式写法" class="header-anchor">#</a> lambda表达式写法</h4> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">// 条件查询	Where</span>
<span class="token class-name">List<span class="token punctuation">&lt;</span>StudentInfo<span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> db<span class="token punctuation">.</span>StudentInfo<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>s_sex <span class="token operator">==</span> <span class="token string">&quot;男&quot;</span><span class="token operator">&amp;&amp;</span>x<span class="token punctuation">.</span>s_name<span class="token operator">==</span><span class="token string">&quot;孙风&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 模糊查询	Contains</span>
<span class="token class-name">List<span class="token punctuation">&lt;</span>StudentInfo<span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> db<span class="token punctuation">.</span>StudentInfo<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span>x<span class="token punctuation">.</span>s_name<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span><span class="token string">&quot;王&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//查询指定字段	Select</span>
<span class="token class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> db<span class="token punctuation">.</span>StudentInfo<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>x<span class="token operator">=&gt;</span>x<span class="token punctuation">.</span>s_name<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span><span class="token string">&quot;王&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>x<span class="token operator">=&gt;</span>x<span class="token punctuation">.</span>s_id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//根据指定字段升序排序	OrderBy</span>
<span class="token class-name">List<span class="token punctuation">&lt;</span>StudentInfo<span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> db<span class="token punctuation">.</span>StudentInfo<span class="token punctuation">.</span><span class="token function">OrderBy</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>s_id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>

<span class="token comment">//根据指定字段降序排序	OrderByDescending</span>
<span class="token class-name">List<span class="token punctuation">&lt;</span>StudentInfo<span class="token punctuation">&gt;</span></span> list1 <span class="token operator">=</span> db<span class="token punctuation">.</span>StudentInfo<span class="token punctuation">.</span><span class="token function">OrderByDescending</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>s_id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>

<span class="token comment">//根据指定字段升序排序，然后取前五条</span>
<span class="token class-name">List<span class="token punctuation">&lt;</span>StudentInfo<span class="token punctuation">&gt;</span></span> list1 <span class="token operator">=</span> db<span class="token punctuation">.</span>StudentInfo<span class="token punctuation">.</span><span class="token function">OrderBy</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>s_id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Take</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>

<span class="token comment">//根据指定字段升序排序，然后跳过前五条	Skip 	注意：skip查询方法 必须先排序   </span>
<span class="token class-name">List<span class="token punctuation">&lt;</span>StudentInfo<span class="token punctuation">&gt;</span></span> list1 <span class="token operator">=</span> db<span class="token punctuation">.</span>StudentInfo<span class="token punctuation">.</span><span class="token function">OrderBy</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>s_id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Skip</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//分页  每页10条   第一页</span>
<span class="token class-name"><span class="token keyword">int</span></span> pagesize <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">int</span></span> pageindex <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token class-name">List<span class="token punctuation">&lt;</span>StudentInfo<span class="token punctuation">&gt;</span></span> list1 <span class="token operator">=</span> db<span class="token punctuation">.</span>StudentInfo<span class="token punctuation">.</span><span class="token function">OrderBy</span><span class="token punctuation">(</span>x<span class="token operator">=&gt;</span>x<span class="token punctuation">.</span>s_id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Skip</span><span class="token punctuation">(</span><span class="token punctuation">(</span>pageindex<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>pagesize<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Take</span><span class="token punctuation">(</span>pagesize<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//取链表中的第一个值，没有则返回默认值null	FirstOrDefault</span>
<span class="token class-name">StudentInfo</span> studentInfo <span class="token operator">=</span> db<span class="token punctuation">.</span>StudentInfo<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//得到一个实体</span>
<span class="token class-name">StudentInfo</span> model <span class="token operator">=</span> db<span class="token punctuation">.</span>StudentInfo<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>s_id <span class="token operator">==</span> <span class="token number">1222</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p><strong>两表联合</strong></p> <blockquote><p>步骤一：先创建一个视图模型实体，继承主表，写副表需要的字段</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">S_ProvinceViewModel</span><span class="token punctuation">:</span><span class="token type-list"><span class="token class-name">MVC<span class="token punctuation">.</span>Entity<span class="token punctuation">.</span>S_City</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> ProvinceName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>步骤二：通过join方法进行联合</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//参数1：连接的副表中的表数据，参数2：主表的关联字段，参数3：副表的关联字段，参数4：查询后数据给到的实体对象</span>
<span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>S_CityViewModel<span class="token punctuation">&gt;</span></span> list1 <span class="token operator">=</span> db<span class="token punctuation">.</span>S_City<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span>S_Province<span class="token punctuation">,</span> x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>ProvinceID<span class="token punctuation">,</span> y <span class="token operator">=&gt;</span> y<span class="token punctuation">.</span>ProvinceID<span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">S_CityViewModel</span>
            <span class="token punctuation">{</span>
                CityID <span class="token operator">=</span> x<span class="token punctuation">.</span>CityID<span class="token punctuation">,</span>
                CityName <span class="token operator">=</span> x<span class="token punctuation">.</span>CityName<span class="token punctuation">,</span>
                ProvinceID <span class="token operator">=</span> x<span class="token punctuation">.</span>ProvinceID<span class="token punctuation">,</span>
                ProvinceName <span class="token operator">=</span> y<span class="token punctuation">.</span>ProvinceName
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></blockquote> <h4 id="原生sql写法"><a href="#原生sql写法" class="header-anchor">#</a> 原生SQL写法</h4> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">List<span class="token punctuation">&lt;</span>S_City<span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> db<span class="token punctuation">.</span>S_City<span class="token punctuation">.</span><span class="token function">SqlQuery</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT * FROM S_City&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>多表联合</strong></p> <blockquote><p>步骤一：先创建一个视图模型实体，继承主表，写副表需要的字段</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">S_ProvinceViewModel</span><span class="token punctuation">:</span><span class="token type-list"><span class="token class-name">MVC<span class="token punctuation">.</span>Entity<span class="token punctuation">.</span>S_City</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> ProvinceName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>步骤二：通过SqlQuery方法进行写联合的sql语句</p> <p>注意：联合语句是在指定数据库中进行查询，并不是在某一个表下</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//				指定链表类型				在数据库下查询			指定返回的实体类型</span>
<span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>S_CityViewModel<span class="token punctuation">&gt;</span></span> list2 <span class="token operator">=</span> db<span class="token punctuation">.</span>Database<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">SqlQuery</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>S_CityViewModel<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;select c.*,p.ProvinceName from S_City c inner join S_Province p on c.ProvinceID=p.ProvinceID&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></blockquote> <h4 id="linq表达式写法"><a href="#linq表达式写法" class="header-anchor">#</a> LINQ表达式写法：</h4> <blockquote><p>从数据库获取数据       ADO.NET ORM	==》linq to sql</p> <p>从XML文件获取的       XDocment  XPath ==》linq to object</p> <p>从数组/集合中（Object）  foreach		==》linq to xml</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//linq to sql</span>
<span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>S_Province<span class="token punctuation">&gt;</span></span> listp <span class="token operator">=</span> <span class="token keyword">from</span> s <span class="token keyword">in</span> db<span class="token punctuation">.</span>S_Province <span class="token keyword">select</span> s<span class="token punctuation">;</span>
<span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>S_Province<span class="token punctuation">&gt;</span></span> listp <span class="token operator">=</span> <span class="token keyword">from</span> s <span class="token keyword">in</span> db<span class="token punctuation">.</span>S_Province <span class="token keyword">where</span> <span class="token class-name">s</span><span class="token punctuation">.</span>ProvinceName<span class="token operator">=</span><span class="token string">&quot;北京&quot;</span> <span class="token keyword">select</span> s<span class="token punctuation">;</span>

<span class="token comment">//linq to object</span>
<span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> alist <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">int</span></span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span> blist <span class="token operator">=</span> <span class="token keyword">from</span> a <span class="token keyword">in</span> alist <span class="token keyword">where</span> <span class="token class-name">a</span><span class="token operator">&gt;</span><span class="token number">2</span> <span class="token keyword">select</span> a<span class="token punctuation">;</span>

<span class="token comment">//linq to xml</span>
<span class="token class-name">XMLDocment</span>  doc <span class="token operator">=</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">XMLDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
doc<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">&quot;c:\Test.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Student</span>
<span class="token class-name"><span class="token keyword">var</span></span> list <span class="token operator">=</span><span class="token keyword">from</span> p <span class="token keyword">in</span> doc <span class="token keyword">select</span> p<span class="token punctuation">.</span><span class="token function">Element</span><span class="token punctuation">(</span><span class="token string">&quot;Student&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//linq的多表联合</span>
db<span class="token punctuation">.</span>
</code></pre></div><p><strong>多表联合</strong></p> <blockquote><p>步骤一：先创建一个视图模型实体，继承主表，写副表需要的字段</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">S_ProvinceViewModel</span><span class="token punctuation">:</span><span class="token type-list"><span class="token class-name">MVC<span class="token punctuation">.</span>Entity<span class="token punctuation">.</span>S_City</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> ProvinceName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>步骤二：通过LINQ表达式进行联合查询</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>S_CityViewModel<span class="token punctuation">&gt;</span></span> list3 <span class="token operator">=</span> 
    <span class="token keyword">from</span> c <span class="token keyword">in</span> db<span class="token punctuation">.</span>S_City
    <span class="token keyword">join</span> p <span class="token keyword">in</span> db<span class="token punctuation">.</span>S_Province 
    <span class="token keyword">on</span> c<span class="token punctuation">.</span>ProvinceID equals p<span class="token punctuation">.</span>ProvinceID
    <span class="token keyword">select</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">S_CityViewModel</span>
<span class="token punctuation">{</span>
    CityID <span class="token operator">=</span> c<span class="token punctuation">.</span>CityID<span class="token punctuation">,</span>
    CityName <span class="token operator">=</span> c<span class="token punctuation">.</span>CityName<span class="token punctuation">,</span>
    ProvinceID <span class="token operator">=</span> c<span class="token punctuation">.</span>ProvinceID<span class="token punctuation">,</span>
    ProvinceName <span class="token operator">=</span> p<span class="token punctuation">.</span>ProvinceName
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></blockquote> <h4 id="视图写法"><a href="#视图写法" class="header-anchor">#</a> 视图写法</h4> <p>多表联合：仅限于EF+SQLServer</p> <blockquote><p>步骤一：在SQLserver中创建一个视图，将俩表关联起来，选择需要的字段，然后保存视图，将视图更新到EF中</p> <p><img src="C:%5CUsers%5CAdmin%5CDesktop%5C%E5%9F%B9%E8%AE%AD%5CC#%5CtyporaImg%5CQQ%E5%9B%BE%E7%89%8720230419152843.png" alt="QQ图片20230419152843"></p> <p><img src="C:%5CUsers%5CAdmin%5CDesktop%5C%E5%9F%B9%E8%AE%AD%5CC#%5CtyporaImg%5CQQ%E5%9B%BE%E7%89%8720230419153007.png" alt="QQ图片20230419153007"></p> <p>步骤二：写查询</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>S_CityView<span class="token punctuation">&gt;</span></span> list4 <span class="token operator">=</span> db<span class="token punctuation">.</span>S_CityView<span class="token punctuation">;</span>
</code></pre></div></blockquote> <h2 id="ienumerable、iqueryable、list"><a href="#ienumerable、iqueryable、list" class="header-anchor">#</a> IEnumerable、IQueryable、List</h2> <p>IEnumerable：C#基础的迭代类型基类。如果一个对象可以迭代，那么他必须继承IEnumerable</p> <p>IQueryable:迭代类型，他继承自IEnumerable，他的功能会更加丰富。</p> <p>List：迭代类型，他继承自IQueryable,他的功能更加丰富。</p> <p>注意：在开发中我们一般可以使用IQueryable和List，但是区别在于</p> <p><strong>List会结束EF惰性加载，而IQueryable不会结束惰性加载</strong></p> <h2 id="mvc框架"><a href="#mvc框架" class="header-anchor">#</a> MVC框架</h2> <p>将软件拆分为了3个部分</p> <p>Controller控制器：协调视图和数据源，业务处理。</p> <p>View视图：页面，前端部分</p> <p>Model数据源：做数据的读写</p> <h2 id="asp-net-mvc"><a href="#asp-net-mvc" class="header-anchor">#</a> ASP.NET MVC</h2> <h3 id="路由"><a href="#路由" class="header-anchor">#</a> 路由</h3> <p>ASP.NET MVC 使用的路由进行URI资源定向的。</p> <p>框架中允许我们对路径进行配置</p> <blockquote><div class="language-csharp extra-class"><pre class="language-csharp"><code>routes<span class="token punctuation">.</span><span class="token function">MapRoute</span><span class="token punctuation">(</span>
    <span class="token named-parameter punctuation">name</span><span class="token punctuation">:</span> <span class="token string">&quot;Default&quot;</span><span class="token punctuation">,</span>
    <span class="token named-parameter punctuation">url</span><span class="token punctuation">:</span> <span class="token string">&quot;{controller}/{action}/{id}/{*name}&quot;</span><span class="token punctuation">,</span>
    <span class="token named-parameter punctuation">defaults</span><span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> controller <span class="token operator">=</span> <span class="token string">&quot;Home&quot;</span><span class="token punctuation">,</span> action <span class="token operator">=</span> <span class="token string">&quot;Index&quot;</span><span class="token punctuation">,</span> id <span class="token operator">=</span> UrlParameter<span class="token punctuation">.</span>Optional <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token named-parameter punctuation">namespaces</span><span class="token punctuation">:</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">{</span> <span class="token string">&quot;MVCDemo.Controllers&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>	<span class="token comment">// 跨命名空间路由</span>
    constraints<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> name <span class="token operator">=</span> <span class="token string">&quot;^M.*&quot;</span> <span class="token punctuation">}</span>					<span class="token comment">// 正则表达式匹配路由</span>
</code></pre></div><p>routes.MapRoute（）：</p> <ol><li>name:路由名称</li> <li>url:路由规则</li> <li>defaults:默认值</li> <li>namespace:路由命名空间</li> <li>constraints:正则限制</li></ol></blockquote> <blockquote><p>规则一：静态路由配置</p> <p>说明：静态路由配置实际上就是写死</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code> routes<span class="token punctuation">.</span><span class="token function">MapRoute</span><span class="token punctuation">(</span>
     <span class="token named-parameter punctuation">name</span><span class="token punctuation">:</span> <span class="token string">&quot;Default&quot;</span><span class="token punctuation">,</span> 
     <span class="token named-parameter punctuation">url</span><span class="token punctuation">:</span> <span class="token string">&quot;Home/Index&quot;</span><span class="token punctuation">,</span>
     <span class="token named-parameter punctuation">defaults</span><span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> controller <span class="token operator">=</span> <span class="token string">&quot;Home&quot;</span><span class="token punctuation">,</span> action <span class="token operator">=</span> <span class="token string">&quot;Index&quot;</span><span class="token punctuation">,</span> id <span class="token operator">=</span> UrlParameter<span class="token punctuation">.</span>Optional <span class="token punctuation">}</span>
 <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>规则二：动态路由配置</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code> routes<span class="token punctuation">.</span><span class="token function">MapRoute</span><span class="token punctuation">(</span>
     <span class="token named-parameter punctuation">name</span><span class="token punctuation">:</span> <span class="token string">&quot;Default&quot;</span><span class="token punctuation">,</span>
     <span class="token named-parameter punctuation">url</span><span class="token punctuation">:</span> <span class="token string">&quot;{controller}/{action}/{id}&quot;</span><span class="token punctuation">,</span>
      <span class="token comment">//路由默认参数													可选参数（可有可无）</span>
     defaults<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> controller <span class="token operator">=</span> <span class="token string">&quot;Home&quot;</span><span class="token punctuation">,</span> action <span class="token operator">=</span> <span class="token string">&quot;AAA&quot;</span><span class="token punctuation">,</span> id <span class="token operator">=</span> UrlParameter<span class="token punctuation">.</span>Optional <span class="token punctuation">}</span>
 <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>规则三：比较常用配置(动态路由)</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code> routes<span class="token punctuation">.</span><span class="token function">MapRoute</span><span class="token punctuation">(</span>
     <span class="token named-parameter punctuation">name</span><span class="token punctuation">:</span> <span class="token string">&quot;Default&quot;</span><span class="token punctuation">,</span>
     <span class="token named-parameter punctuation">url</span><span class="token punctuation">:</span> <span class="token string">&quot;{controller}/{action}/{brand}-{cate}-{color}&quot;</span><span class="token punctuation">,</span>
     <span class="token named-parameter punctuation">defaults</span><span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> controller <span class="token operator">=</span> <span class="token string">&quot;Home&quot;</span><span class="token punctuation">,</span> action <span class="token operator">=</span> <span class="token string">&quot;Index&quot;</span><span class="token punctuation">,</span> id <span class="token operator">=</span> UrlParameter<span class="token punctuation">.</span>Optional <span class="token punctuation">}</span>
 <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>规则四：可变长路由（只能有一个可变长值，且只能在最后的位置）</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code>routes<span class="token punctuation">.</span><span class="token function">MapRoute</span><span class="token punctuation">(</span><span class="token string">&quot;MyRoute&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;{controller}/{action}/{id}/{*catchall}&quot;</span><span class="token punctuation">,</span><span class="token keyword">new</span><span class="token punctuation">{</span> controller <span class="token operator">=</span> <span class="token string">&quot;Home&quot;</span><span class="token punctuation">,</span> action <span class="token operator">=</span> <span class="token string">&quot;Index&quot;</span><span class="token punctuation">,</span> id <span class="token operator">=</span> UrlParameter<span class="token punctuation">.</span>Optional <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>规则七：制定请求方法</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code>routes<span class="token punctuation">.</span><span class="token function">MapRoute</span><span class="token punctuation">(</span><span class="token string">&quot;MyRoute&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;{controller}/{action}/{id}/{*catchall}&quot;</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span><span class="token punctuation">{</span> controller <span class="token operator">=</span> <span class="token string">&quot;Home&quot;</span><span class="token punctuation">,</span> action <span class="token operator">=</span> <span class="token string">&quot;Index&quot;</span><span class="token punctuation">,</span> id <span class="token operator">=</span> UrlParameter<span class="token punctuation">.</span>Optional <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span><span class="token punctuation">{</span> controller <span class="token operator">=</span> <span class="token string">&quot;^H.*&quot;</span><span class="token punctuation">,</span> action <span class="token operator">=</span> <span class="token string">&quot;Index|About&quot;</span><span class="token punctuation">,</span> httpMethod <span class="token operator">=</span> <span class="token function">newHttpMethodConstraint</span><span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token string">&quot;URLsAndRoutes.Controllers&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>特性路由</strong></p> <p>注解AOP</p> <p>使用时需要先在路由注册方法中标识</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>routes<span class="token punctuation">.</span><span class="token function">MapMvcAttributeRoutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>常用配置</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;Login&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>		 	<span class="token comment">//在视图函数前注解路由地址</span>
<span class="token punctuation">[</span><span class="token function">Route</span><span class="token punctuation">(</span><span class="token string">&quot;users/{id:int}&quot;</span><span class="token punctuation">]</span>	<span class="token comment">//传参</span>
<span class="token punctuation">[</span><span class="token function">Route</span><span class="token punctuation">(</span><span class="token string">&quot;users/{name}&quot;</span><span class="token punctuation">]</span>
       

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">RoutePrefix</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;M&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>			<span class="token comment">//路由前缀，加在控制器上</span>
</code></pre></div><h3 id="actionresult的常用返回类型"><a href="#actionresult的常用返回类型" class="header-anchor">#</a> ActionResult的常用返回类型</h3> <blockquote><p>View：返回一个强类型页面，返回对象，需要设置参数JsonRequestBehavior.AllowGet，允许GET请求。</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//1.返回相应路径下强类型页面</span>
<span class="token keyword">return</span> <span class="token function">View</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//2.返回相应路径下强类型页面并传递数据</span>
<span class="token keyword">return</span> <span class="token function">View</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
<span class="token comment">//3.返回到特定页面</span>
<span class="token keyword">return</span> <span class="token function">View</span><span class="token punctuation">(</span><span class="token string">&quot;Index&quot;</span><span class="token punctuation">)</span>
<span class="token comment">//4.返回特定页面并传递数据</span>
<span class="token keyword">return</span> <span class="token function">View</span><span class="token punctuation">(</span><span class="token string">&quot;Index&quot;</span><span class="token punctuation">,</span>obj<span class="token punctuation">)</span>
</code></pre></div><blockquote><p>Content：返回字符串</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">return</span> <span class="token function">Content</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;script&gt;javascript&lt;/script&gt;&quot;</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>Json：返回序列化后的json串</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">return</span> <span class="token function">Json</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
</code></pre></div><blockquote><p>RedirctToAction：返回重定向</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">return</span> <span class="token function">RedirctToAction</span><span class="token punctuation">(</span><span class="token string">&quot;/home/Index&quot;</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="viewdata和viewbag"><a href="#viewdata和viewbag" class="header-anchor">#</a> ViewData和ViewBag</h3> <p>Action向视图传递数据可以使用return View()，但是用该方法只能传递一个对象过去。使用ViewData和ViewBag可以传递多个参数到视图</p> <blockquote><p>ViewData：不会保存数据类型，效率略高</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name">ActionResult</span> <span class="token function">Index</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>S_Province<span class="token punctuation">&gt;</span></span> pList <span class="token operator">=</span> db<span class="token punctuation">.</span>S_Province<span class="token punctuation">;</span>
    ViewData<span class="token punctuation">[</span><span class="token string">&quot;list&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> pList<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">View</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code>@foreach (var item in ViewData[&quot;list&quot;] as IEnumerable<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>MVC.Entity.S_Province</span><span class="token punctuation">&gt;</span></span>)
{
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>@item.ProvinceID<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>@item.ProvinceName<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
}
</code></pre></div><blockquote><p>ViewBag：会保存数据类型，效率略低</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name">ActionResult</span> <span class="token function">Index</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>S_Province<span class="token punctuation">&gt;</span></span> pList <span class="token operator">=</span> db<span class="token punctuation">.</span>S_Province<span class="token punctuation">;</span>
    ViewBag<span class="token punctuation">.</span>list <span class="token operator">=</span> pList<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">View</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code>@foreach (var item in ViewBag.list)
{
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>@item.ProvinceID<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>@item.ProvinceName<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
}
</code></pre></div><h3 id="viewstart"><a href="#viewstart" class="header-anchor">#</a> ViewStart</h3> <p>_Viewstart.cshtml是一个在呈现View文件的时候的启动文件，会在所有View（.cshtml）被执行之前执行，主要用于一些不方便或不能在母版（_Layout.cshtml）中进行的统一操作，譬如你有很多个没有继承关系的母版或不使用母版的单页。</p> <h3 id="母版页-2"><a href="#母版页-2" class="header-anchor">#</a> 母版页</h3> <p>在添加视图的时候选择使用布局页后，会在Views文件夹下创建一个Shared文件夹，里面用来放置模板页（_Layout.cshtml）。在Views文件夹下还会创建一个_ViewStart.cshtml文件，这是进入视图时首先访问的地方，里面规定了所有视图继承的母版页。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!--如果视图中不想继承该模板页--&gt;</span>
@{
	Layout = null;
}
<span class="token comment">&lt;!--如果视图中想继承其他模板页--&gt;</span>
@{
	Layout = &quot;~/Views/Shared/_Layout2.cshtml&quot;;
}
</code></pre></div><h3 id="区域"><a href="#区域" class="header-anchor">#</a> 区域</h3> <p>一个ASP.NET MVC Web项目的一个子站。</p> <p>区域拥有独立的路由组件。</p> <p>独立的M、V、C部分。</p> <p>通常用来写网站的后台</p> <h3 id="静态资源导入"><a href="#静态资源导入" class="header-anchor">#</a> 静态资源导入</h3> <p>右键项目---》添加---》客户端库---》搜索自己需要的资源添加</p> <p>直接将静态资源复制进来</p> <h3 id="bundler打包"><a href="#bundler打包" class="header-anchor">#</a> Bundler打包</h3> <p><strong>bundler就是将资源文件进行打包</strong></p> <blockquote><p>Bundle相对于原始资源的引用，主要好处体现在了资源的获取效率上，其加载的文件以304进行修改，节约了带宽，浏览器加载速度更快。</p></blockquote> <blockquote><p>使用</p> <p>步骤一：在App_Start文件夹中创建一个打包配置类</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Web<span class="token punctuation">.</span>Optimization</span><span class="token punctuation">;</span> <span class="token comment">//第三方库</span>


<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BundlerConfig</span>
<span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">RegisterBundles</span><span class="token punctuation">(</span><span class="token class-name">BundleCollection</span> bundles<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">//js（ScriptBundle）</span>
            <span class="token comment">//可以匹配版本					包名</span>
            bundles<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">ScriptBundle</span><span class="token punctuation">(</span><span class="token string">&quot;~/bundles/jquery&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Include</span><span class="token punctuation">(</span>
                        <span class="token comment">//动态参数</span>
                        <span class="token string">&quot;~/Scripts/jquery-{version}.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            bundles<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">ScriptBundle</span><span class="token punctuation">(</span><span class="token string">&quot;~/bundles/jqueryval&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Include</span><span class="token punctuation">(</span>
                       <span class="token string">&quot;~/Scripts/jquery.validate*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//css（StyleBundle）</span>
            <span class="token comment">//一个包中添加多个资源文件用逗号隔开</span>
            bundles<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">StyleBundle</span><span class="token punctuation">(</span><span class="token string">&quot;~/Content/css&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Include</span><span class="token punctuation">(</span>
                        <span class="token string">&quot;~/Content/bootstrap.css&quot;</span><span class="token punctuation">,</span>
                        <span class="token string">&quot;~/Content/site.css&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//一个包中添加多个资源文件也可以再.include</span>
            bundles<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">ScriptBundle</span><span class="token punctuation">(</span><span class="token string">&quot;~/bundler/customer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Include</span><span class="token punctuation">(</span>
                       <span class="token string">&quot;~/Scripts/a.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Include</span><span class="token punctuation">(</span><span class="token string">&quot;~/Scripts/b.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>步骤二：在Global.asax全局配置文件中添加打包器的设置</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">MVCTest<span class="token punctuation">.</span>App_Start</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Web<span class="token punctuation">.</span>Optimization</span><span class="token punctuation">;</span>

<span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Application_Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    AreaRegistration<span class="token punctuation">.</span><span class="token function">RegisterAllAreas</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    RouteConfig<span class="token punctuation">.</span><span class="token function">RegisterRoutes</span><span class="token punctuation">(</span>RouteTable<span class="token punctuation">.</span>Routes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//添加打包配置</span>
    BundlerConfig<span class="token punctuation">.</span><span class="token function">RegisterBundles</span><span class="token punctuation">(</span>BundleTable<span class="token punctuation">.</span>Bundles<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>步骤三：页面上引入</p> <div class="language-html extra-class"><pre class="language-html"><code>//_Layout.cshtml							包名
@System.Web.Optimization.Styles.Render(&quot;~/Content/css&quot;)//样式引入
@System.Web.Optimization.Scripts.Render(&quot;~/bundles/jquery&quot;)
</code></pre></div></blockquote> <h3 id="分组视图-用户控件"><a href="#分组视图-用户控件" class="header-anchor">#</a> 分组视图（用户控件）</h3> <blockquote><p>@HTML.Partial(&quot;视图位置全路径&quot;)：在视图中引入其他HTML代码（只是视图文件，不会进控制器）</p> <div class="language-html extra-class"><pre class="language-html"><code>@Html.Partial(&quot;~/Views/Student/Menu.cshtml&quot;)
</code></pre></div></blockquote> <blockquote><p>@HTML.RenderPartial(&quot;视图位置全路径&quot;)：和Partial一样，但是性能略好，只能放在代码块（@{}）中</p> <div class="language-html extra-class"><pre class="language-html"><code>@{Html.RenderPartial(&quot;~/Views/Student/Menu.cshtml&quot;);}
</code></pre></div></blockquote> <blockquote><p><strong>@HTML.RenderAction(&quot;视图名&quot;,&quot;控制器名&quot;)</strong>：在视图中引入其他视图，其为一次独立请求，所以会经过控制器，包含后台代码。也必须写在代码块（@{}）中，常用。</p> <div class="language-html extra-class"><pre class="language-html"><code>@{Html.RenderAction(&quot;Menu&quot;, &quot;Student&quot;);}
</code></pre></div></blockquote> <blockquote><p>@RenderBody：私有区域占位，类似于母版页的ContentPlaceHolder</p></blockquote> <blockquote><p>@RenderSection(&quot;区域名&quot;,required:true/false):用于修饰页面差异化效果，当required设置为true时，继承的页面必须实现@section  xx{}独立区域。</p> <p><code>母版页</code></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>_Layout2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    @RenderBody()
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>我是模板2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--规定了一个子页面必填的区域--&gt;</span>
    @RenderSection(&quot;jquery&quot;,required:true)
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><code>子页面</code></p> <div class="language-html extra-class"><pre class="language-html"><code>@section jquery{
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jquery.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
}
</code></pre></div></blockquote> <h3 id="控制器接收视图form表单传递的数据"><a href="#控制器接收视图form表单传递的数据" class="header-anchor">#</a> 控制器接收视图form表单传递的数据</h3> <blockquote><p>要想接收到一个实体对象，需要在html页面写<code>@model MVC.Entity.StudentInfo</code>，提交的时候程序会自动将name对应的字段赋给实体对象，然后传到控制器，控制器可通过形参接收。</p></blockquote> <p><code>studentinfo</code></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name">ActionResult</span> <span class="token function">Add</span><span class="token punctuation">(</span><span class="token class-name">S_Province</span> model<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    db<span class="token punctuation">.</span>S_Province<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">Content</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;script&gt;alert('添加成功')&lt;/script&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>StudentAdd.cshtml</code></p> <div class="language-html extra-class"><pre class="language-html"><code>@model MVC.Entity.StudentInfo 
@{
    Layout = null;
}

<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>StudentAdd<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>学生添加<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/studentinfo/add<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>姓名：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>s_name<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>生日：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>date<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>s_birth<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>性别：
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>radio<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>s_sex<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>男
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>radio<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>s_sex<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>女
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>提交<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>提交<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="razor"><a href="#razor" class="header-anchor">#</a> Razor</h3> <p>官方文档：https://docs.microsoft.com/zh-cn/aspnet/core/mvc/views/razor?view=aspnetcore-6.0</p> <p>Razor 支持 C#，并使用 <code>@</code> 符号从 HTML 转换为 C#。 Razor 计算 C# 表达式，并将它们呈现在 HTML 输出中。</p> <p>当符号 <code>@</code> 后跟保留 <a href="https://docs.microsoft.com/zh-cn/aspnet/core/mvc/views/razor?view=aspnetcore-6.0#razor-reserved-keywords" target="_blank" rel="noopener noreferrer">Razor 关键字<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>时，它将转换为 Razor特定于 的标记。 否则会转换为纯 HTML。</p> <p>若要对 Razor 标记中的 <code>@</code> 符号进行转义，请使用另一个 <code>@</code> 符号：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>P</span><span class="token punctuation">&gt;</span></span>@@Username<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>  <span class="token comment">&lt;!--@Username--&gt;</span>
</code></pre></div><blockquote><p>隐式Razor表达式 @</p></blockquote> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>@DateTime.Now<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><blockquote><p>显式Razor表达式 @（）：这样就知道到哪里结束</p></blockquote> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>@(DateTime.Now - TimeSpan.FromDays(7))<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><blockquote><p>Razor代码块 @{}</p></blockquote> <div class="language-html extra-class"><pre class="language-html"><code>@{
	后台代码
}
</code></pre></div><blockquote><p>@HTML.Raw(&quot;&quot;)：将字符串内容当作html标签解析</p></blockquote> <div class="language-html extra-class"><pre class="language-html"><code>@Html.Raw(&quot;&lt;input type=\&quot;radio\&quot; name=\&quot;sex\&quot; value=\&quot;0\&quot; checked /&gt;女&quot;)
</code></pre></div><blockquote><p><code>@model</code>：指定传递到视图或页面的模型类型</p> <p>在html页面中用Model表示传递的数据</p></blockquote> <div class="language-html extra-class"><pre class="language-html"><code>@model 传过来的obj对象的类型

<span class="token comment">&lt;!--例:
@model IEnumerable&lt;MVC.Entity.S_Province&gt;

@foreach (var item in Model)
{
    &lt;tr&gt;
        &lt;td&gt;@item.ProvinceID&lt;/td&gt;
        &lt;td&gt;@item.ProvinceName&lt;/td&gt;
    &lt;/tr&gt;
}
--&gt;</span>
</code></pre></div><blockquote><p><code>@using</code>：可以像后端一样进行引用</p></blockquote> <h3 id="filter拦截器-过滤器"><a href="#filter拦截器-过滤器" class="header-anchor">#</a> Filter拦截器（过滤器）</h3> <p><strong>AOP：面向切面编程</strong></p> <p>OOP：面向对象编程</p> <p>拦截比较适合做：登录状态验证、权限、场景限制</p> <p><strong>概念</strong></p> <p>特性（Attribute）是用于在运行时传递程序中各种元素（比如类、方法、结构、枚举、组件等）的行为信息的声明性标签。您可以通过使用特性向程序添加声明性信息。一个声明性标签是通过放置在它所应用的元素前面的方括号（[ ]）来描述的。</p> <p>特性（Attribute）用于添加元数据，如编译器指令和注释、描述、方法、类等其他信息。.Net 框架提供了两种类型的特性：预定义特性和自定义特性</p> <p>[HttpPost]</p> <p>[LoginFilter]</p> <p><strong>过滤器的类型与作用</strong></p> <p>MVC给我们提供了四种过滤器，基本满足了我们实际业务中常用的需求，包括以下：</p> <table><thead><tr><th>过滤器类型名称</th> <th>实现的接口</th> <th>默认的实现类</th> <th>作用</th> <th>执行的顺序与节点</th></tr></thead> <tbody><tr><td>授权过滤器</td> <td>IAuthorizationFilter</td> <td>AuthorizeAttribute</td> <td>用于限制进入控制器或控制器的某个行为方法</td> <td>在控制器方法调用前执行，所有过滤器中最先执行的</td></tr> <tr><td>动作过滤器</td> <td>IActionFilter</td> <td>ActionFilterAttribute</td> <td>用于进入动作方法之前或之后的处理</td> <td>在控制器方法调用前/后执行</td></tr> <tr><td>结果过滤器</td> <td>IResultFilter</td> <td>ActionFilterAttribute</td> <td>用于动作方法返回结果之前或之后的处理</td> <td>在控制器方法调用完，跳转至view页面前/后执行</td></tr> <tr><td>异常处理过滤器</td> <td>IExceptionFilter</td> <td>HandleErrorAttribute</td> <td>用于处理某个动作方法或某个控制器里面抛出的异常</td> <td>在控制器方法抛出异常时执行</td></tr></tbody></table> <blockquote><p><strong>从拦截上下文对象下获取请求信息，从请求信息中获取控制器（Controller）的名字、动作（Action）的名字</strong></p> <p>string controllerName = filterContext.ActionDescriptor.ControllerDescriptor.ControllerName;</p> <p>string actionName = filterContext.ActionDescriptor.ActionName;</p></blockquote> <h4 id="actionfilterattribute"><a href="#actionfilterattribute" class="header-anchor">#</a> <strong>ActionFilterAttribute</strong></h4> <blockquote><p>OnActionExecuting：该方法会在action方法执行之前调用（进入action前一步）</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Web<span class="token punctuation">.</span>Mvc</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ActionFilterTest</span><span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ActionFilterAttribute</span></span>
<span class="token punctuation">{</span>
    <span class="token comment">//该方法会在action方法执行之前调用  </span>
    <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnActionExecuting</span><span class="token punctuation">(</span><span class="token class-name">ActionExecutingContext</span> filterContext<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        filterContext<span class="token punctuation">.</span>HttpContext<span class="token punctuation">.</span>Response<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">&quot;我是OnActionExecuting，我在action方法调用前执行&lt;br/&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">OnActionExecuting</span><span class="token punctuation">(</span>filterContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>OnActionExecuted：该方法会在action方法执行之后调用（刚进入action后）</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Web<span class="token punctuation">.</span>Mvc</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ActionFilterTest</span><span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ActionFilterAttribute</span></span>
<span class="token punctuation">{</span>
    <span class="token comment">//该方法会在action方法执行之后调用  </span>
    <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnActionExecuted</span><span class="token punctuation">(</span><span class="token class-name">ActionExecutedContext</span> filterContext<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        filterContext<span class="token punctuation">.</span>HttpContext<span class="token punctuation">.</span>Response<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">&quot;我是OnActionExecuted，我在action方法调用后执行&lt;br/&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">OnActionExecuted</span><span class="token punctuation">(</span>filterContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="resultfilter"><a href="#resultfilter" class="header-anchor">#</a> <strong>ResultFilter</strong></h4> <blockquote><p>OnResultExecuting：在action方法返回结果之前执行（return前一步执行）</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Web<span class="token punctuation">.</span>Mvc</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ActionFilterTest</span><span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ActionFilterAttribute</span></span>
<span class="token punctuation">{</span>
    <span class="token comment">//在action方法返回结果之前执行  </span>
    <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnResultExecuting</span><span class="token punctuation">(</span><span class="token class-name">ResultExecutingContext</span> filterContext<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        filterContext<span class="token punctuation">.</span>HttpContext<span class="token punctuation">.</span>Response<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">&quot;我是OnActionExecuting，我action方法返回结果之前执行&lt;br/&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">OnResultExecuting</span><span class="token punctuation">(</span>filterContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>OnResultExecuted：在action方法返回结果之后执行（return后一步执行）</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Web<span class="token punctuation">.</span>Mvc</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ActionFilterTest</span><span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ActionFilterAttribute</span></span>
<span class="token punctuation">{</span>
    <span class="token comment">//在action方法返回结果之后执行</span>
    <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnResultExecuted</span><span class="token punctuation">(</span><span class="token class-name">ResultExecutedContext</span> filterContext<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        filterContext<span class="token punctuation">.</span>HttpContext<span class="token punctuation">.</span>Response<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">&quot;我是OnActionExecuting，我action方法返回结果之前执行&lt;br/&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">OnResultExecuted</span><span class="token punctuation">(</span>filterContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="authorizeattribute"><a href="#authorizeattribute" class="header-anchor">#</a> <strong>AuthorizeAttribute</strong></h4> <blockquote><p>OnAuthorization：在所有action方法过滤器之前执行，也就是说，提供了一个可以超前验证的方法。优先级最高</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AuthorizeFilter</span><span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">AuthorizeAttribute</span></span>
<span class="token punctuation">{</span>
    <span class="token comment">//在所有action方法过滤器之前执行  </span>
    <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnAuthorization</span><span class="token punctuation">(</span><span class="token class-name">AuthorizationContext</span> filterContext<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        filterContext<span class="token punctuation">.</span>HttpContext<span class="token punctuation">.</span>Response<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">&quot;我是OnAuthorization，在所有action方法过滤器之前执行&lt;br/&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//base.OnAuthorization(filterContext);  </span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> 
</code></pre></div><p><strong>HandleErrorAttribute</strong></p> <blockquote><p>OnException：异常拦截器接口，当程序出现异常后执行</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnException</span><span class="token punctuation">(</span><span class="token class-name">ExceptionContext</span> filterContext<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">string</span></span> controller <span class="token operator">=</span> filterContext<span class="token punctuation">.</span>RouteData<span class="token punctuation">.</span>Values<span class="token punctuation">[</span><span class="token string">&quot;controller&quot;</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token class-name"><span class="token keyword">string</span></span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">string</span></span> action <span class="token operator">=</span> filterContext<span class="token punctuation">.</span>RouteData<span class="token punctuation">.</span>Values<span class="token punctuation">[</span><span class="token string">&quot;action&quot;</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token class-name"><span class="token keyword">string</span></span><span class="token punctuation">;</span>
    filterContext<span class="token punctuation">.</span>RequestContext<span class="token punctuation">.</span>HttpContext<span class="token punctuation">.</span>Response<span class="token punctuation">.</span>Write
        <span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">&quot;{0}:{1}发生异常!{2}&quot;</span><span class="token punctuation">,</span> controller<span class="token punctuation">,</span> action<span class="token punctuation">,</span> filterContext<span class="token punctuation">.</span>Exception<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//表示是否已处理异常</span>
    filterContext<span class="token punctuation">.</span>ExceptionHandled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token comment">//写日志log</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token comment">//结束当次请求返回到异常页</span>
    filterContext<span class="token punctuation">.</span>Result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">RedirectResult</span><span class="token punctuation">(</span><span class="token string">&quot;/404.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//base.OnException(filterContext);</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="拦截器的使用"><a href="#拦截器的使用" class="header-anchor">#</a> 拦截器的使用</h4> <ol><li><p>直接在Action上进行拦截</p> <blockquote><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ActionFilterTest</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name">ActionResult</span> <span class="token function">Index</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">View</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></blockquote></li> <li><p>将特性加在控制器上进行整个控制器的拦截</p> <blockquote><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ActionFilterTest</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HomeController</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Controller</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">ActionResult</span> <span class="token function">Index</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">View</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></blockquote></li> <li><p>对整个站点进行拦截</p> <blockquote><p>步骤一：在App_Start下面创建一个类（FilterConfig.cs），进行添加拦截器</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Web<span class="token punctuation">.</span>Mvc</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FilterConfig</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">RegisterGlobalFilters</span><span class="token punctuation">(</span><span class="token class-name">GlobalFilterCollection</span> filters<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//加一个拦截器		拦截器类名</span>
        filters<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AutorFilterAttribute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        filters<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">HandleErrorAttribute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>步骤二：在Global.asax中写入我们拦截器配置文件（FilterConfig）</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//将我们的拦截器配置文件中的所有拦截器 挂载到项目运行时中</span>
FilterConfig<span class="token punctuation">.</span><span class="token function">RegisterGlobalFilters</span><span class="token punctuation">(</span>GlobalFilters<span class="token punctuation">.</span>Filters<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>tips：如果有的页面不需要拦截则可以在拦截器中进行判断控制器名和动作名进行放行</strong></p></blockquote></li></ol> <h3 id="模型注解"><a href="#模型注解" class="header-anchor">#</a> 模型注解</h3> <p>前端：提示用户输入有效的信息</p> <p>后端：验证数据的有效性</p> <p><strong>模型注解的几个方式</strong></p> <blockquote><p>Required：强调属性是必须的，不可为空。当属性中有一个是null或空时，会引发一个验证错误。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Required</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Age <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre></div></blockquote> <blockquote><p>StringLength：要求必须输入名字的长度。参数可以限制最小的。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">StringLength</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token number">160</span><span class="token punctuation">,</span>MinimumLength <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>		<span class="token comment">//最大长度160，最小长度3</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre></div></blockquote> <blockquote><p>RegularExpression：正则表达式验证，比如邮箱等需要验证正则的地方。这样就减少了服务端的验证。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">RegularExpression</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">@&quot;^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+&quot;</span><span class="token punctuation">,</span>ErrorMessage <span class="token operator">=</span> <span class="token string">&quot;邮箱输入有误，重新输入。&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>        
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Email <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre></div></blockquote> <blockquote><p>Range：用来指定数值类型值得最小值和最大值。主要为int类型服务。其余的也可以，需要使用构造函数的重载版本。Type参数来做。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Range</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Age <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre></div><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Range</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name"><span class="token keyword">decimal</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;0.00&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;59.99&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">decimal</span></span> Price <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre></div></blockquote> <blockquote><p>Compare：确定两个模型属性拥有一样的值。密码的验证(输入两次，看二者是否一样)，参数为前面模型的值。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Required</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Password <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Compare</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;Password&quot;</span><span class="token punctuation">,</span>ErrorMessage<span class="token operator">=</span><span class="token string">&quot;两次密码输入不正确&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> PasswordPalt <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre></div></blockquote> <blockquote><p>Remote：此特性利用服务器端的回调函数执行客户端的验证逻辑。通俗的说就是这个特性可以直接找到某个控制器的action并且执行其中的方法。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">/// &lt;summary&gt;</span>
<span class="token comment">/// 验证模型中输入的姓名是否和数据库中重复</span>
<span class="token comment">/// &lt;/summary&gt;</span>
<span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
<span class="token keyword">public</span> <span class="token return-type class-name">JsonResult</span> <span class="token function">CheckUserName</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> username<span class="token punctuation">)</span>
<span class="token punctuation">{</span>            <span class="token comment">//数据库中的相关验证</span>
    <span class="token keyword">return</span> <span class="token function">Json</span><span class="token punctuation">(</span>DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>JsonRequestBehavior<span class="token punctuation">.</span>AllowGet<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Remote</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;CheckUserName&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Admin&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> UserName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre></div></blockquote> <p><strong>注解的验证</strong></p> <p>后端验证</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//ModelState.IsValid进行验证，当验证成功时次属性为true,否则为false</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>ModelState<span class="token punctuation">.</span>IsValid<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
     <span class="token comment">//调用EF进行添加</span>
     <span class="token comment">//db.Students.Add(model);</span>
     db<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Entry</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Students<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">.</span>State <span class="token operator">=</span> EntityState<span class="token punctuation">.</span>Added<span class="token punctuation">;</span>
     db<span class="token punctuation">.</span><span class="token function">SaveChanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="实现下拉框的绑定和选中"><a href="#实现下拉框的绑定和选中" class="header-anchor">#</a> 实现下拉框的绑定和选中</h3> <blockquote><p>方法一：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name">ActionResult</span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
 <span class="token class-name">Student</span> model <span class="token operator">=</span> db<span class="token punctuation">.</span>Student<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>S_Province<span class="token punctuation">&gt;</span></span> provinces <span class="token operator">=</span> db<span class="token punctuation">.</span>S_Province<span class="token punctuation">;</span>
 ViewBag<span class="token punctuation">.</span>ProvinceName <span class="token operator">=</span> provinces<span class="token punctuation">;</span>
 <span class="token keyword">return</span> <span class="token function">View</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code>@foreach (MVC.Entity.S_Province item in ViewBag.ProvinceName)
{
	if (Model.ProvinceID == item.ProvinceID)
	{
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@item.ProvinceID<span class="token punctuation">&quot;</span></span> <span class="token attr-name">selected</span><span class="token punctuation">&gt;</span></span>@item.ProvinceName<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">&gt;</span></span>
	}
	else
	{
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@item.ProvinceID<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>@item.ProvinceName<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">&gt;</span></span>
	}

}
</code></pre></div><p>方法二：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name">ActionResult</span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">Student</span> model <span class="token operator">=</span> db<span class="token punctuation">.</span>Student<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//创建一个selectListItem链表</span>
    <span class="token class-name">List<span class="token punctuation">&lt;</span>SelectListItem<span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>SelectListItem<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//将要绑定的内容每一个元素加到链表中</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> item <span class="token keyword">in</span> db<span class="token punctuation">.</span>S_Province<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">SelectListItem</span> s1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SelectListItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        s1<span class="token punctuation">.</span>Value <span class="token operator">=</span> item<span class="token punctuation">.</span>ProvinceID<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        s1<span class="token punctuation">.</span>Text <span class="token operator">=</span> item<span class="token punctuation">.</span>ProvinceName<span class="token punctuation">;</span>
        list<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//传到前台页面</span>
    ViewBag<span class="token punctuation">.</span>ClassList <span class="token operator">=</span> list<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">View</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code>@model MVC.Entity.Student

<span class="token comment">&lt;!--			value对应Student表的哪个字段	 	SelectListItem的链表--&gt;</span>
@Html.DropDownListFor(x=&gt;x.cid,ViewBag.ClassList as IEnumerable<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SelectListItem</span><span class="token punctuation">&gt;</span></span>)
</code></pre></div></blockquote> <h3 id="验证码实现"><a href="#验证码实现" class="header-anchor">#</a> 验证码实现</h3> <p><code>validate</code></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ValidateController</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Controller</span></span>
<span class="token punctuation">{</span>
    <span class="token comment">// GET: Admin/Validate</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">ActionResult</span> <span class="token function">GetCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">///获取随机码</span>
        <span class="token class-name"><span class="token keyword">var</span></span> code <span class="token operator">=</span> <span class="token function">getRandomStr</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//将验证码值存到session中</span>
        Session<span class="token punctuation">[</span><span class="token string">&quot;Code&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> code<span class="token punctuation">;</span>
        <span class="token comment">///生成图片对象</span>
        <span class="token class-name"><span class="token keyword">var</span></span> bitmap <span class="token operator">=</span> <span class="token function">getImage</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> <span class="token string">&quot;ch&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">///图片对象转为字节数组</span>
        <span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> data <span class="token operator">=</span> <span class="token function">bitmapToByte</span><span class="token punctuation">(</span>bitmap<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">///输出文件</span>
        <span class="token keyword">return</span> <span class="token function">File</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token string">&quot;image/gif&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// 获取随机码</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token comment">/// &lt;param name=&quot;count&quot;&gt;随机码个数&lt;/param&gt;</span>
    <span class="token comment">/// &lt;returns&gt;随机码&lt;/returns&gt;</span>
    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">getRandomStr</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> count<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;错误的字符长度！&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;strCount&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">StringBuilder</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">var</span></span> strs <span class="token operator">=</span> <span class="token string">&quot;0 1 2 3 4 5 6 7 8 9 a b c d e f g h i j k l m n o p q r s t u v w s y z &quot;</span> <span class="token operator">+</span><span class="token string">&quot;A B C D E F G H I J K L M N O P Q R S T U V W S Y Z&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">var</span></span> strArray <span class="token operator">=</span> strs<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">{</span> <span class="token char">' '</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> StringSplitOptions<span class="token punctuation">.</span>RemoveEmptyEntries<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Random</span> random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            sb<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span>strArray<span class="token punctuation">[</span>random<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span>strArray<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> sb<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// 根据随机码生成bitmap对象</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token comment">/// &lt;param name=&quot;code&quot;&gt;随机码&lt;/param&gt;</span>
    <span class="token comment">/// &lt;param name=&quot;type&quot;&gt;en，ch&lt;/param&gt;</span>
    <span class="token comment">/// &lt;returns&gt;bitmap对象&lt;/returns&gt;</span>
    <span class="token keyword">private</span> <span class="token return-type class-name">Bitmap</span> <span class="token function">getImage</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> code<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> type <span class="token operator">=</span> <span class="token string">&quot;en&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrWhiteSpace</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;随机码为空！&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;type&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">int</span></span> step <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">==</span> <span class="token string">&quot;ch&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            step <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">///英文字符个数</span>
        <span class="token class-name"><span class="token keyword">int</span></span> charLength <span class="token operator">=</span> code<span class="token punctuation">.</span>Length<span class="token punctuation">;</span>
        <span class="token comment">///bitmap的宽度（像素）</span>
        <span class="token class-name"><span class="token keyword">int</span></span> iWidth <span class="token operator">=</span> charLength <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">13</span> <span class="token operator">+</span> step<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">///bitmap的高度（像素）</span>
        <span class="token class-name"><span class="token keyword">int</span></span> iHeight <span class="token operator">=</span> <span class="token number">22</span><span class="token punctuation">;</span>
        <span class="token comment">///创建图片</span>
        <span class="token class-name">Bitmap</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Bitmap</span><span class="token punctuation">(</span>iWidth<span class="token punctuation">,</span> iHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">///绘画图片对象 </span>
        <span class="token class-name">Graphics</span> g <span class="token operator">=</span> Graphics<span class="token punctuation">.</span><span class="token function">FromImage</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">///清除背景并填充白色</span>
        g<span class="token punctuation">.</span><span class="token function">Clear</span><span class="token punctuation">(</span>Color<span class="token punctuation">.</span>White<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">///画干扰点</span>
        <span class="token class-name">Random</span> random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">int</span></span> x1 <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span>iWidth<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">int</span></span> x2 <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span>iWidth<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">int</span></span> y1 <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span>iHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">int</span></span> y2 <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span>iHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
            g<span class="token punctuation">.</span><span class="token function">DrawLine</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Pen</span><span class="token punctuation">(</span>Color<span class="token punctuation">.</span>LightGray<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">///字体颜色</span>
        <span class="token class-name">Color<span class="token punctuation">[</span><span class="token punctuation">]</span></span> colors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Color<span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">{</span> Color<span class="token punctuation">.</span>Black<span class="token punctuation">,</span> Color<span class="token punctuation">.</span>Red<span class="token punctuation">,</span> Color<span class="token punctuation">.</span>Blue<span class="token punctuation">,</span> Color<span class="token punctuation">.</span>Green<span class="token punctuation">,</span> Color<span class="token punctuation">.</span>Orange <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">///字体设置</span>
        <span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> fontFamilies <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">{</span> <span class="token string">&quot;黑体&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Bahnschrift SemiLight&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Comic Sans MS&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;MV Boli&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Segoe Print&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> charLength<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">int</span></span> colorIndex <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span>colors<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">int</span></span> fontIndex <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span>fontFamilies<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">///随机字体</span>
            <span class="token class-name">Font</span> font <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Font</span><span class="token punctuation">(</span>fontFamilies<span class="token punctuation">[</span>fontIndex<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> FontStyle<span class="token punctuation">.</span>Bold<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">///用来填充多边形的内部对象（填充字体）</span>
            <span class="token class-name">Brush</span> brush <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SolidBrush</span><span class="token punctuation">(</span>colors<span class="token punctuation">[</span>colorIndex<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">///开始绘画字符</span>
            g<span class="token punctuation">.</span><span class="token function">DrawString</span><span class="token punctuation">(</span>code<span class="token punctuation">.</span><span class="token function">Substring</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> font<span class="token punctuation">,</span> brush<span class="token punctuation">,</span> i <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">12</span> <span class="token operator">+</span> step<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">///绘画矩形边框</span>
        <span class="token comment">//g.DrawRectangle(new Pen(Color.Red, 1), 0, 0, image.Width - 1, image.Height - 1);</span>
        <span class="token keyword">return</span> image<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// bitmap对象转换为字节数组</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token comment">/// &lt;param name=&quot;bitmap&quot;&gt;&lt;/param&gt;</span>
    <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token function">bitmapToByte</span><span class="token punctuation">(</span><span class="token class-name">Bitmap</span> bitmap<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">MemoryStream</span> ms <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MemoryStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">///bitmap保存到流对象</span>
            bitmap<span class="token punctuation">.</span><span class="token function">Save</span><span class="token punctuation">(</span>ms<span class="token punctuation">,</span> ImageFormat<span class="token punctuation">.</span>Jpeg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">///流对象设置开始位置</span>
            ms<span class="token punctuation">.</span><span class="token function">Seek</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> SeekOrigin<span class="token punctuation">.</span>Begin<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">byte</span></span><span class="token punctuation">[</span>ms<span class="token punctuation">.</span>Length<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token comment">///从流对象中读取字节块，将数据写入到字节数组</span>
            ms<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> data<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>html</code></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>~/Scripts/jquery.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#imgCode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//防止赋值同一个属性浏览器不认</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;src&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/admin/validate/getcode?&quot;</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>


<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>验证码 : <span class="token punctuation">&quot;</span></span> <span class="token attr-name">hover</span> <span class="token attr-name">lay-verify</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>required<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>code<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>code layui-input layui-input-inline<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>imgCode<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/admin/validate/getcode<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>codeImage<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><h3 id="通过路由实现多项搜索"><a href="#通过路由实现多项搜索" class="header-anchor">#</a> 通过路由实现多项搜索</h3> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name">ActionResult</span> <span class="token function">Index</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> year<span class="token operator">=</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">,</span><span class="token class-name"><span class="token keyword">int</span></span> type<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token class-name"><span class="token keyword">int</span></span> countryid<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token class-name"><span class="token keyword">int</span></span> pageIndex<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token class-name"><span class="token keyword">int</span></span> pageSize<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>MovieEntityContext<span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> db<span class="token punctuation">.</span>Database<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">SqlQuery</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>MovieEntityContext<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;select m.*,c.country_name,t.type_name from Movie m inner join Country c on m.country_id=c.id inner join Movie_Type t on m.type_id=t.id where m.is_delete=0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//得到要绑定的列表</span>
    <span class="token comment">//得到类型表数据</span>
    <span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>Movie_Type<span class="token punctuation">&gt;</span></span> tList <span class="token operator">=</span> db<span class="token punctuation">.</span>Movie_Type<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>is_delete <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ViewBag<span class="token punctuation">.</span>tList <span class="token operator">=</span> tList<span class="token punctuation">;</span>
 	<span class="token comment">//得到国家表数据</span>
    <span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>Country<span class="token punctuation">&gt;</span></span> cList <span class="token operator">=</span> db<span class="token punctuation">.</span>Country<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>is_delete <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ViewBag<span class="token punctuation">.</span>cList <span class="token operator">=</span> cList<span class="token punctuation">;</span>
	<span class="token comment">//得到最小年份和最大年份</span>
    <span class="token class-name"><span class="token keyword">string</span></span> lowYear <span class="token operator">=</span> db<span class="token punctuation">.</span>Movie<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>x<span class="token operator">=&gt;</span>x<span class="token punctuation">.</span>is_delete<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">OrderBy</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>start_time<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>start_time<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Take</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">string</span></span> HeightYear <span class="token operator">=</span> db<span class="token punctuation">.</span>Movie<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>is_delete <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">OrderByDescending</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>start_time<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>start_time<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Take</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ViewBag<span class="token punctuation">.</span>lowYear <span class="token operator">=</span> lowYear<span class="token punctuation">;</span>
    ViewBag<span class="token punctuation">.</span>HeightYear <span class="token operator">=</span> HeightYear<span class="token punctuation">;</span>
	<span class="token comment">//将传进来的类型id保存到viewbag中，让前台知道上次检索的类型id</span>
    ViewBag<span class="token punctuation">.</span>searchType <span class="token operator">=</span> type<span class="token punctuation">;</span>
    ViewBag<span class="token punctuation">.</span>searchYear <span class="token operator">=</span> year<span class="token punctuation">;</span>
    ViewBag<span class="token punctuation">.</span>searchCountry <span class="token operator">=</span> countryid<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>type<span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        list <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>type_id <span class="token operator">==</span> type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span>year<span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span>year<span class="token operator">!=</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        list <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>start_time <span class="token operator">==</span> year<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>countryid <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        list <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>country_id <span class="token operator">==</span> countryid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//分页</span>
    <span class="token class-name">PagedList<span class="token punctuation">&lt;</span>MovieEntityContext<span class="token punctuation">&gt;</span></span> Plist <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">ToPagedList</span><span class="token punctuation">(</span>pageIndex<span class="token punctuation">,</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">View</span><span class="token punctuation">(</span>Plist<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code>类型：
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">display</span><span class="token punctuation">:</span>flex</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
    @foreach (Movie.Entity.Movie_Type item in ViewBag.tList)
    {
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">margin-right</span><span class="token punctuation">:</span>5px</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/home/index/@item.id-@ViewBag.searchYear-@ViewBag.searchCountry<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>@item.type_name<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    }
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>

年份：
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">display</span><span class="token punctuation">:</span>flex</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
    @for(int i = Convert.ToInt32(ViewBag.lowYear);i&lt;=Convert.ToInt32(ViewBag.HeightYear); i++)                                                                                     {                                                                                         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">margin-right</span><span class="token punctuation">:</span>5px</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/home/index/@ViewBag.searchType-@i-@ViewBag.searchCountry<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>@i<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>

国家：
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">display</span><span class="token punctuation">:</span>flex</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
    @foreach (Movie.Entity.Country item in ViewBag.cList)
    {
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">margin-right</span><span class="token punctuation">:</span>5px</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/home/index/@ViewBag.searchType-@ViewBag.searchYear-@item.id<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>@item.country_name<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    }
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="mvc插件"><a href="#mvc插件" class="header-anchor">#</a> MVC插件</h3> <h4 id="分页插件"><a href="#分页插件" class="header-anchor">#</a> 分页插件</h4> <p><strong>http://www.webdiyer.com/mvcpager/demos/basic/</strong></p> <blockquote><p>步骤一：下载包文件</p> <p><code>NuGet\Install-Package Webdiyer.MvcPager -Version 3.0.1.1</code></p> <p>步骤二：控制器代码</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">Webdiyer<span class="token punctuation">.</span>WebControls<span class="token punctuation">.</span>Mvc</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token return-type class-name">ActionResult</span> <span class="token function">Pager</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> pageIndex<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> pageSize <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
 <span class="token comment">// 查表</span>
 <span class="token class-name">PagedList<span class="token punctuation">&lt;</span>S_City<span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> db<span class="token punctuation">.</span>S_City<span class="token punctuation">.</span><span class="token function">OrderBy</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>CityID<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToPagedList</span><span class="token punctuation">(</span>pageIndex<span class="token punctuation">,</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">return</span> <span class="token function">View</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>步骤三：视图代码</p> <div class="language-html extra-class"><pre class="language-html"><code>@using Webdiyer.WebControls.Mvc

@model PagedList<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>MVC.Entity.S_City</span><span class="token punctuation">&gt;</span></span>
@{
 Layout = null;
}

<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Pager<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>~/lib/css/bootstrap.min.css<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>thead</span><span class="token punctuation">&gt;</span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
                 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>城市id<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>城市名称<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>thead</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tbody</span><span class="token punctuation">&gt;</span></span>
             @foreach (MVC.Entity.S_City item in Model)
             {
                 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
                     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>@item.CityID<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>@item.CityName<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
             }
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tbody</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
     @Html.Pager(Model).Options(o=&gt; o.SetPageIndexParameterName(&quot;pageIndex&quot;).SetHorizontalAlign(&quot;left&quot;).SetPagerItemTemplate(&quot;<span class="token entity named-entity" title="&amp;nbsp;">&amp;nbsp;</span>{0}&quot;))
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>bootstrap样式</p> <div class="language- extra-class"><pre class="language-text"><code>@Html.Pager(Model).Options(o =&gt; o.SetPageIndexParameterName(&quot;pageIndex&quot;).SetHorizontalAlign(&quot;left&quot;).SetPagerItemTemplate(&quot;&amp;nbsp;{0}&quot;).SetContainerTagName(&quot;ul&quot;).SetCssClass(&quot;pagination&quot;).SetPagerItemTemplate(&quot;&lt;li&gt;{0}&lt;/li&gt;&quot;).SetCurrentPagerItemTemplate(&quot;&lt;li class=\&quot;active\&quot;&gt;&lt;a href=\&quot;#\&quot;&gt;{0}&lt;/a&gt;&lt;/li&gt;&quot;).SetDisabledPagerItemTemplate(&quot;&lt;li class=\&quot;disabled\&quot;&gt;&lt;a&gt;{0}&lt;/a&gt;&lt;/li&gt;&quot;));

</code></pre></div></blockquote> <h4 id="文件上传插件"><a href="#文件上传插件" class="header-anchor">#</a> 文件上传插件</h4> <p><strong>http://fex.baidu.com/webuploader/getting-started.html</strong></p> <blockquote><p>步骤一：下载包文件</p> <p>步骤二：引入资源（应先引入jQuery再引入他的js，因为他的依赖于jQuery）</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!--引入CSS--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/css<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>webuploader文件夹/webuploader.css<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!--引入JS--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jquery.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>webuploader文件夹/webuploader.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>步骤三：HTML部分，初始化</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>uploader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wu-example<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--用来存放文件信息--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>thelist<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>uploader-list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btns<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>picker<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>选择文件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ctlBtn<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn btn-default<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>开始上传<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>


@System.Web.Optimization.Scripts.Render(&quot;/bundles/jquery&quot;)
@System.Web.Optimization.Scripts.Render(&quot;/Scripts/webuploader&quot;)
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token comment">//初始化Web Uploader</span>
    <span class="token keyword">var</span> uploader <span class="token operator">=</span> WebUploader<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token comment">//设置为实时上传</span>
        <span class="token literal-property property">auto</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

        <span class="token comment">// swf文件路径</span>
        <span class="token literal-property property">swf</span><span class="token operator">:</span> <span class="token string">'Scripts/webuploader/Uploader.swf'</span><span class="token punctuation">,</span>

        <span class="token comment">// 文件接收服务端。</span>
        <span class="token literal-property property">server</span><span class="token operator">:</span> <span class="token string">'/StudentAdd/Upload'</span><span class="token punctuation">,</span>

        <span class="token comment">// 选择文件的按钮。可选。</span>
        <span class="token comment">// 内部根据当前运行是创建，可能是input元素，也可能是flash.</span>
        <span class="token literal-property property">pick</span><span class="token operator">:</span> <span class="token string">'#picker'</span><span class="token punctuation">,</span>

        <span class="token comment">// 不压缩image, 默认如果是jpeg，文件上传前会压缩一把再上传！</span>
        <span class="token literal-property property">resize</span><span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">//设置上传成功后的事件			参数1：File对象，参数2：接口返回的数据</span>
    uploader<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'uploadSuccess'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">file<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 给img赋src属性，让图片显示</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#imgUrl'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;src&quot;</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//将图片的url存到隐藏控件中，方便向数据库中存储</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#hfUrl'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>步骤四：控制器写接口（当选择文件后执行的操作）</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name">ActionResult</span> <span class="token function">Upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//接收form表单传递的值，二进制文件需要用Files接收</span>
    <span class="token class-name"><span class="token keyword">string</span></span> name <span class="token operator">=</span> Request<span class="token punctuation">.</span>Form<span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> file <span class="token operator">=</span> Request<span class="token punctuation">.</span>Files<span class="token punctuation">[</span><span class="token string">&quot;file&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">//将文件保存</span>
    file<span class="token punctuation">.</span><span class="token function">SaveAs</span><span class="token punctuation">(</span>Server<span class="token punctuation">.</span><span class="token function">MapPath</span><span class="token punctuation">(</span><span class="token string">&quot;/img/&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Hashtable</span> hash <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Hashtable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    hash<span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> name<span class="token punctuation">;</span>
    hash<span class="token punctuation">[</span><span class="token string">&quot;url&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;/img/&quot;</span><span class="token operator">+</span>name<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">Json</span><span class="token punctuation">(</span>hash<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></blockquote> <h3 id="支付宝沙箱使用"><a href="#支付宝沙箱使用" class="header-anchor">#</a> 支付宝沙箱使用</h3> <h2 id="依赖注入di"><a href="#依赖注入di" class="header-anchor">#</a> 依赖注入DI</h2> <p>客户类只依赖于服务类的一个接口，而不依赖于具体服务类。一个客户类调用一个服务类的时候，不直接实例化具体的服务类，而是客户类的运行上下文环境或专门组件负责实例化服务类，然后将其注入到客户类中。</p> <blockquote><p>三种注入方式：</p> <ol><li><p><strong>构造函数方式注入（常用的注入手段）</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">internal</span> <span class="token keyword">class</span> <span class="token class-name">Driver</span><span class="token punctuation">:</span><span class="token type-list"><span class="token class-name">IDriver</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">ICar</span> _icar<span class="token punctuation">;</span>
    <span class="token comment">//实例化Driver类的时候，必须提供一个接口参数</span>
    <span class="token keyword">public</span> <span class="token function">Driver</span><span class="token punctuation">(</span><span class="token class-name">ICar</span> icar<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _icar <span class="token operator">=</span> icar<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">driver</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _icar<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">IDriver</span> wang <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Driver</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Benz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>属性方式注入</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">internal</span> <span class="token keyword">class</span> <span class="token class-name">Driver</span><span class="token punctuation">:</span><span class="token type-list"><span class="token class-name">IDriver</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">ICar</span> _icar<span class="token punctuation">;</span>
    <span class="token comment">//实例化Driver类的时候，必须提供一个接口参数</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">ICar</span> car
    <span class="token punctuation">{</span>
        <span class="token keyword">set</span> <span class="token punctuation">{</span> _icar <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">driver</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _icar<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">Driver</span> wang <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Driver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
wang<span class="token punctuation">.</span>Car <span class="token operator">=</span> a6<span class="token punctuation">;</span>
wang<span class="token punctuation">.</span><span class="token function">driver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>接口方式注入</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">internal</span> <span class="token keyword">class</span> <span class="token class-name">Driver</span><span class="token punctuation">:</span><span class="token type-list"><span class="token class-name">IDriver</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">driver</span><span class="token punctuation">(</span><span class="token class-name">ICar</span> car<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        car<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol></blockquote> <p>例：</p> <p><code>ICar.cs</code></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">internal</span> <span class="token keyword">interface</span> <span class="token class-name">ICar</span>
<span class="token punctuation">{</span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>IDriver.cs</code></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">internal</span> <span class="token keyword">interface</span> <span class="token class-name">IDriver</span>
<span class="token punctuation">{</span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">driver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>Driver.cs</code></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">internal</span> <span class="token keyword">class</span> <span class="token class-name">Driver</span><span class="token punctuation">:</span><span class="token type-list"><span class="token class-name">IDriver</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">ICar</span> _icar<span class="token punctuation">;</span>
    <span class="token comment">//实例化Driver类的时候，必须提供一个接口参数</span>
    <span class="token keyword">public</span> <span class="token function">Driver</span><span class="token punctuation">(</span><span class="token class-name">ICar</span> icar<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _icar <span class="token operator">=</span> icar<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">driver</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _icar<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>Benz.cs</code></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">internal</span> <span class="token keyword">class</span> <span class="token class-name">Benz</span><span class="token punctuation">:</span><span class="token type-list"><span class="token class-name">ICar</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;奔驰车开动&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>BMW.cs</code></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//细节依赖于抽象</span>
<span class="token keyword">internal</span> <span class="token keyword">class</span> <span class="token class-name">BMW</span><span class="token punctuation">:</span><span class="token type-list"><span class="token class-name">ICar</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;宝马车开动&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>main</code></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//准备一个奔驰车</span>
<span class="token class-name">Benz</span> a100 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Benz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">BMW</span> x1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">BMW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//通过接口创建一个类对象</span>
<span class="token class-name">IDriver</span> xiaowang <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Driver</span><span class="token punctuation">(</span>x1<span class="token punctuation">)</span><span class="token punctuation">;</span>
xiaowang<span class="token punctuation">.</span><span class="token function">driver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="控制反转ioc"><a href="#控制反转ioc" class="header-anchor">#</a> 控制反转IOC</h2> <blockquote><p><strong>IOC全称为inversion  of control（控制反转），依赖注入是一种IOC的表现形式，主要表现为让第三方来管理自己的依赖。IOC容器的价值在于让依赖管理和使用更为便捷。简单地说，容器是一个申请依赖、保存依赖的对象。</strong></p></blockquote> <p>容器的声明性正式它强大的地方，这个特性可以让开发者无需去特别指定什么时间创建依赖的实例，申明后直接通过容器来获取相应的实例，容器内部来处理相关的逻辑。</p> <p>IOC是把对象的控制权较给框架或容器，容器中存储了众多我们需要的对象，然后我们就无需再手动的在代码中创建对象。需要什么对象就直接告诉容器我们需要什么对象，容器会把对象根据一定的方式注入到我们的代码中。</p> <p><strong>IOC底层原理：xml解析、工厂模式、反射</strong></p> <p>常见的IOC容器框架：</p> <p>Spring+SpringMVC+Mybatis=SSM                 IOC容器+后端MVC框架+ORM</p> <p>Autofac+ASP.NET MVC+EntityFramewok     IOC容器+后端MVC框架+ORM</p> <h2 id="autofac"><a href="#autofac" class="header-anchor">#</a> AutoFac</h2> <blockquote><p>AutoFac是一个IOC容器，AutoFac能够帮助你在应用程序运行起来后，在容器中创建出各种服务对象，当我们需要时可以直接将容器中的类注入到相应的构造函数中。</p></blockquote> <blockquote><p>ASP.NET MVC使用：</p> <p>步骤一：安装AutoFac包</p> <p>步骤二：在<code>Global.asax</code>中创建ContainerBuilder容器</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">Autofac</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MvcApplication</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">System<span class="token punctuation">.</span>Web<span class="token punctuation">.</span>HttpApplication</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Application_Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        AreaRegistration<span class="token punctuation">.</span><span class="token function">RegisterAllAreas</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        RouteConfig<span class="token punctuation">.</span><span class="token function">RegisterRoutes</span><span class="token punctuation">(</span>RouteTable<span class="token punctuation">.</span>Routes<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//配置autofac容器</span>
        <span class="token function">AutofacRegister</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">AutofacRegister</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ContainerBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//1.单个依赖注入  当使用到ICar接口的时候就将BMW注入到里面</span>
        builder<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">RegisterType</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>BMW<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">As</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ICar<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//2.将项目中的所有控制器下的类 全部都实例化到容器中    指定注入方式为属性注入</span>
builder<span class="token punctuation">.</span><span class="token function">RegisterControllers</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">MvcApplication</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Assembly<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">PropertiesAutowired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//3.service服务层注入  依赖注入按程序集注入	类库名</span>
        <span class="token class-name">Assembly</span> service <span class="token operator">=</span> Assembly<span class="token punctuation">.</span><span class="token function">Load</span><span class="token punctuation">(</span><span class="token string">&quot;AutofacDemo.Service&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//注入所有非抽象成员</span>
        builder<span class="token punctuation">.</span><span class="token function">RegisterAssemblyTypes</span><span class="token punctuation">(</span>service<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>t <span class="token operator">=&gt;</span> <span class="token operator">!</span>t<span class="token punctuation">.</span>IsAbstract<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">AsImplementedInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">PropertiesAutowired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">//repository仓储层注入</span>
        <span class="token class-name">Assembly</span> repository <span class="token operator">=</span> Assembly<span class="token punctuation">.</span><span class="token function">Load</span><span class="token punctuation">(</span><span class="token string">&quot;AutofacDemo.Repository&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        builder<span class="token punctuation">.</span><span class="token function">RegisterAssemblyTypes</span><span class="token punctuation">(</span>repository<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>t <span class="token operator">=&gt;</span> <span class="token operator">!</span>t<span class="token punctuation">.</span>IsAbstract<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">AsImplementedInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">PropertiesAutowired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">//容器构建</span>
        <span class="token class-name"><span class="token keyword">var</span></span> container <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//解析器替换  MVC自带的容器解析器(需要安装Autofac.MVC5包)</span>
        DependencyResolver<span class="token punctuation">.</span><span class="token function">SetResolver</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AutofacDependencyResolver</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></blockquote> <h2 id="automapper"><a href="#automapper" class="header-anchor">#</a> AutoMapper</h2> <p>AutoMapper是一个对象到对象的转换映射工具(object-object mapper).它能把一个输入对象转换成一个不同类型的对象输出.AutoMapper更有趣的地方是它提供了一些有趣的惯例规则来帮助我们转换对象.可以这样理解:只要按照AutoMapper 建立的规则来(构造实体),就不需要进行任何多余的设置.</p> <p><strong>作用</strong></p> <p>AutoMapper库可以帮助我们在Model和VO对象之间进行转化，从而省去繁琐的字段匹配问题。</p> <p><strong>使用步骤</strong></p> <p>一、安装</p> <blockquote><p>注意：最新版本是针对与ASP.NET Core的，所以要安装早期版本（6.1.0）。</p></blockquote> <p>二、创建Profile类（在Profile文件夹中）</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Linq</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Web</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">AutoMapper</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">MuYingWanSystem</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AutoMapperProfile</span><span class="token punctuation">:</span><span class="token type-list"><span class="token class-name">Profile</span></span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token function">AutoMapperProfile</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token generic-method"><span class="token function">CreateMap</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Staff<span class="token punctuation">,</span> StaffViewModel<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ForMember</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>create_time<span class="token punctuation">,</span> opt <span class="token operator">=&gt;</span>
            <span class="token punctuation">{</span>
                opt<span class="token punctuation">.</span><span class="token function">Ignore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>三、编写配置类（在APP_Start下创建一个AutoMapperConfig.cs）</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">AutoMapper</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Linq</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Web</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">MuYingWanSystem<span class="token punctuation">.</span>App_Start</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AutoMapperConfig</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Config</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            Mapper<span class="token punctuation">.</span><span class="token function">Initialize</span><span class="token punctuation">(</span>config <span class="token operator">=&gt;</span>
            <span class="token punctuation">{</span>
                config<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddProfile</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>AutoMapperProfile<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>四、在全局配置Global.asax中引用配置方法</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MvcApplication</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">System<span class="token punctuation">.</span>Web<span class="token punctuation">.</span>HttpApplication</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Application_Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token range operator">..</span><span class="token punctuation">.</span>
        <span class="token comment">//配置automapper</span>
        AutoMapperConfig<span class="token punctuation">.</span><span class="token function">Config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>具体使用</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name">ActionResult</span> <span class="token function">Index</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">StudentVM</span> studentVM <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StudentVM</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    studentVM<span class="token punctuation">.</span>Name <span class="token operator">=</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">;</span>
    studentVM<span class="token punctuation">.</span>Age <span class="token operator">=</span> <span class="token number">19</span><span class="token punctuation">;</span>
    studentVM<span class="token punctuation">.</span>ClassName <span class="token operator">=</span> <span class="token string">&quot;1班&quot;</span><span class="token punctuation">;</span>
    studentVM<span class="token punctuation">.</span>Date<span class="token operator">=</span>DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">;</span>
    studentVM<span class="token punctuation">.</span>ClassId <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token comment">//方式一：</span>
    <span class="token class-name">Student</span> student <span class="token operator">=</span> AutoMapper<span class="token punctuation">.</span>Mapper<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Map</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Student<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>studentVM<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//方式二：</span>
    
    <span class="token keyword">return</span> <span class="token function">View</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="autocomplete"><a href="#autocomplete" class="header-anchor">#</a> AutoComplete</h2> <p>一个前端输入框自动补全技术。</p> <p>功能：当用户在输入框中输入关键词时，则自动进行提示补全。</p> <p>该功能是由jQuery中的autocommplete.js提供的，常规的组件类型框架中有些自动集成了相关功能，具体如何使用需要查看组件库文档。</p> <p><strong>LayUI中使用AutoComplete</strong></p> <p>1.下载layui扩展插件</p> <p>2.在前端视图页面创建AutoComplete</p> <p>注：由于autocomplete是基于jquery的，所以我们需要在layui中使用jquery组件</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>~/wwwroot/js/jquery.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--高版本的layui在template_txt中没法识别html代码--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>~/wwwroot/module/layui/layui.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>~/wwwroot/js/autocomplete.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code>layui<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'form'</span><span class="token punctuation">,</span> <span class="token string">'layedit'</span><span class="token punctuation">,</span> <span class="token string">'laydate'</span><span class="token punctuation">,</span> <span class="token string">'autocomplete'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> autocomplete <span class="token operator">=</span> layui<span class="token punctuation">.</span>autocomplete<span class="token punctuation">;</span>
    
    <span class="token comment">//自动补齐</span>
    autocomplete<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">elem</span><span class="token operator">:</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#cusName'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">//进行缓存，每一次键入都发起新请求  true只发起一次请求</span>
        <span class="token literal-property property">cache</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'/desk/QueryMongoDB?keyword='</span> <span class="token operator">+</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#cusName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">//绑定的val值字段，通常情况下绑定id</span>
        <span class="token literal-property property">template_val</span><span class="token operator">:</span> <span class="token string">'{{d._id}}'</span><span class="token punctuation">,</span>
        <span class="token comment">//绑定的内容</span>
        <span class="token literal-property property">template_txt</span><span class="token operator">:</span> <span class="token string">'&lt;span class=\'autostyle layui-input\'&gt;{{d.name}}-{{d.phone}}&lt;/span&gt;'</span><span class="token punctuation">,</span>
        <span class="token comment">//事件：选中</span>
        <span class="token function-variable function">onselect</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//文本框赋值</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#cusName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#phone&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>phone<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#per_hospital&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>per_hospital<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;.layui-form-autocomplete dd&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p><strong>tips：</strong></p> <ol><li>autocomplete请求后端地址时，是通过keywords进行传值的，所以在后端应该用keywords接收。</li> <li>后端返回的数据格式应为：</li></ol> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
	code<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
	data<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span>id<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>name<span class="token operator">:</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span>phone<span class="token operator">:</span><span class="token string">&quot;1234567&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>id<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>name<span class="token operator">:</span><span class="token string">&quot;李四&quot;</span><span class="token punctuation">,</span>phone<span class="token operator">:</span><span class="token string">&quot;1234567&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	msg<span class="token operator">:</span><span class="token string">&quot;&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div></blockquote> <h2 id="asp-net-webapi框架"><a href="#asp-net-webapi框架" class="header-anchor">#</a> ASP.NET WebAPI框架</h2> <p>基于接口框架，开发人员只需要进行接口的编写。</p> <p>适用：前后端分离的项目</p> <h3 id="restful协议规范"><a href="#restful协议规范" class="header-anchor">#</a> Restful协议规范</h3> <p>Restful风格是一种软件架构风格，而不是标准，只是提供了一种设计原则和约束条件。主要适用于客户端和服务器端交互的软件。是基于http协议实现。目的是为了提高系统的可伸缩性，降低应用之间的耦合度，方便框架分布式处理程序。基于这个风格的软件可更加的简单、更有层次，更易于实现缓存的机制。
在resultful风格中，用户请求的url使用同一个URL而用请求方式：get/post/delete/put等方式对请求的处理方法进行区分。这样可以在前后台分离的开发中让前端开发人员不会对请求的资源地址产生混淆，形成一个统一的接口。</p> <p>（1）每种url代表了一种资源。
（2）客户端和服务器之间，传递这个资源的某种表现层。
（3）客户端通过四个http动词，对服务器资源进行操作。实现表现层状态的转化。</p> <p>示例：以默认的Http四种请求方式进行的访问</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token string">&quot;get&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">Post</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token string">&quot;post&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">Put</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token string">&quot;put&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">Delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token string">&quot;delete&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>注意：webapi中，返回可以是任何数据类型，不再局限于return Content,JSON,View这些了，因为无论我们返回什么，他都是json/xml。</p> <h3 id="特性标签"><a href="#特性标签" class="header-anchor">#</a> 特性标签</h3> <h3 id="特性路由"><a href="#特性路由" class="header-anchor">#</a> 特性路由</h3> <p>webapi中默认使用的是Restful风格的URI,但是当业务变的复杂后，可能会导致映射无法满足需求，此时我们可以使用特性路由。</p> <p><strong>开启特性路由</strong></p> <p>1.启用特性路由需要在配置过程中调用System.Web.HttpConfigurationExtensions类的MapHttpAttributeRoutes方法</p> <p><code>WebApiConfig.cs</code></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">namespace</span> <span class="token namespace">WebApplication2</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">WebApiConfig</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Register</span><span class="token punctuation">(</span><span class="token class-name">HttpConfiguration</span> config<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// Web API 配置和服务</span>
            
            <span class="token comment">// Web API 路由</span>
            config<span class="token punctuation">.</span><span class="token function">MapHttpAttributeRoutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            config<span class="token punctuation">.</span>Routes<span class="token punctuation">.</span><span class="token function">MapHttpRoute</span><span class="token punctuation">(</span>
                <span class="token named-parameter punctuation">name</span><span class="token punctuation">:</span> <span class="token string">&quot;DefaultApi&quot;</span><span class="token punctuation">,</span>
                <span class="token named-parameter punctuation">routeTemplate</span><span class="token punctuation">:</span> <span class="token string">&quot;api/{controller}/{id}&quot;</span><span class="token punctuation">,</span>
                <span class="token named-parameter punctuation">defaults</span><span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> id <span class="token operator">=</span> RouteParameter<span class="token punctuation">.</span>Optional <span class="token punctuation">}</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>2.global中配置</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Application_Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    GlobalConfiguration<span class="token punctuation">.</span><span class="token function">Configure</span><span class="token punctuation">(</span>WebApiConfig<span class="token punctuation">.</span>Register<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>默认情况，WebApi会根据action的方法名前缀查找action(不区分大小写)，比如GetUsers，会匹配Get。通过在action上添加HttpMethod特性，可以覆盖action需要映射的Http Method。</p> <p>可使用的特性包括：[HttpDelete],[HttpPost],[HttpHead],[HttpOptions],[HttpPatch],[HttpGet],[HttpPut]</p> <p>通过AcceptVerbs特性，我们还可以指定非标准方法以及多个方法，如 [AcceptVerbs(&quot;MKCOL&quot;,&quot;GET&quot;,&quot;POST&quot;)]</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpGet</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>Student<span class="token punctuation">&gt;</span></span> <span class="token function">GetList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>Student<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Student</span> <span class="token punctuation">{</span> id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span> create_time <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Student</span> <span class="token punctuation">{</span> id <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">&quot;李四&quot;</span><span class="token punctuation">,</span> create_time <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>路由前缀</strong></p> <p>通常情况下，一个Controller下的action会使用相似的路由模板，如</p> <ul><li>[Route(&quot;api/books&quot;)]</li> <li>[Route(&quot;api/books/{id:int}&quot;)]</li> <li>[Route(&quot;api/books/{bookid}/authors&quot;)]</li></ul> <p>这时候可以为整个controller指定[RoutePrefix]特性，以使用共同的前缀，把[RoutePrefix(&quot;/api/books&quot;)]加到controller上，action的路由特性就变成这样：</p> <ul><li>[Route(&quot;&quot;)]</li> <li>[Route(&quot;{id:int}&quot;)]</li> <li>[Route(&quot;{bookid}/authors&quot;)]</li></ul> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">RoutePrefix</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;api/student&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StudentController</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ApiController</span></span>
<span class="token punctuation">{</span>
    <span class="token comment">//	url：/api/student/list</span>
    <span class="token punctuation">[</span>HttpGet<span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;list&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>Student<span class="token punctuation">&gt;</span></span> <span class="token function">GetList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>Student<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Student</span> <span class="token punctuation">{</span> id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span> create_time <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Student</span> <span class="token punctuation">{</span> id <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">&quot;李四&quot;</span><span class="token punctuation">,</span> create_time <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//	url：/api/student</span>
    <span class="token punctuation">[</span>HttpGet<span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">Getmethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;get&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>路由约束</strong></p> <p>路由约束让我们可以限制模板参数的匹配方式。一般的语法是 &quot;{参数：约束类型}&quot;：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token function">Route</span><span class="token punctuation">(</span><span class="token string">&quot;users/{id:int}&quot;</span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name">User</span> <span class="token function">GetUserById</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token function">Route</span><span class="token punctuation">(</span><span class="token string">&quot;users/{name}&quot;</span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name">User</span> <span class="token function">GetUserByName</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
</code></pre></div><p>如果参数为int，则选中第一个GetUserById，否则是GetUserByName。(跟方法定义的顺序无关)</p> <p>下面的表格列出了支持的约束：</p> <table><thead><tr><th style="text-align:left;">约束</th> <th style="text-align:left;">介绍</th> <th style="text-align:left;">示例</th></tr></thead> <tbody><tr><td style="text-align:left;">alpha</td> <td style="text-align:left;">匹配大写或小写字母 (a-z, A-Z)</td> <td style="text-align:left;">{x:alpha}</td></tr> <tr><td style="text-align:left;">bool</td> <td style="text-align:left;"></td> <td style="text-align:left;">{x:bool}</td></tr> <tr><td style="text-align:left;">datetime</td> <td style="text-align:left;"></td> <td style="text-align:left;">{x:datetime}</td></tr> <tr><td style="text-align:left;">decimal</td> <td style="text-align:left;"></td> <td style="text-align:left;">{x:decimal}</td></tr> <tr><td style="text-align:left;">double</td> <td style="text-align:left;"></td> <td style="text-align:left;">{x:double}</td></tr> <tr><td style="text-align:left;">float</td> <td style="text-align:left;">匹配一个 32位浮点数</td> <td style="text-align:left;">{x:float}</td></tr> <tr><td style="text-align:left;">guid</td> <td style="text-align:left;"></td> <td style="text-align:left;">{x:guid}</td></tr> <tr><td style="text-align:left;">int</td> <td style="text-align:left;"></td> <td style="text-align:left;">{x:int}</td></tr> <tr><td style="text-align:left;">length</td> <td style="text-align:left;">匹配一个长度在指定范围内的字符串</td> <td style="text-align:left;"><em>{x:length(6)} *{x:length(1,20)}</em>*</td></tr> <tr><td style="text-align:left;">long</td> <td style="text-align:left;"></td> <td style="text-align:left;">{x:long}</td></tr> <tr><td style="text-align:left;">max</td> <td style="text-align:left;">匹配指定了最大值的整数</td> <td style="text-align:left;">{x:max(10)}</td></tr> <tr><td style="text-align:left;">maxlength</td> <td style="text-align:left;">匹配指定了最大长度字符串</td> <td style="text-align:left;">{x:maxlength(10)}</td></tr> <tr><td style="text-align:left;">min</td> <td style="text-align:left;">匹配指定了最小值的整数</td> <td style="text-align:left;">{x:min(10)}</td></tr> <tr><td style="text-align:left;">minlength</td> <td style="text-align:left;">匹配指定了最小长度字符串</td> <td style="text-align:left;">{x:minlength(10)}</td></tr> <tr><td style="text-align:left;">range</td> <td style="text-align:left;">匹配指定了大小区间的整数</td> <td style="text-align:left;">{x:range(10,50)}</td></tr> <tr><td style="text-align:left;">regex</td> <td style="text-align:left;">匹配一个正则表达式</td> <td style="text-align:left;">{x:regex(^\d{3}-\d{3}-\d{4}$)}</td></tr></tbody></table> <p><strong>可选URI参数，默认值</strong></p> <p>通过在参数约束后面添加一个问号，可以设定URI参数是可选的；也可以像普通方法那样指定默认值：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;api/books/locale/{cid:int?}&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>	<span class="token comment">//cid可选参数</span>
<span class="token keyword">public</span> <span class="token return-type class-name">IEnumerable<span class="token punctuation">&lt;</span>Book<span class="token punctuation">&gt;</span></span> <span class="token function">GetBooksByLocale</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> cid <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;api/books/locale/{cid:int=1033}&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>	<span class="token comment">//cid默认为1033</span>
<span class="token keyword">public</span> <span class="token return-type class-name">IEnumerable<span class="token punctuation">&lt;</span>Book<span class="token punctuation">&gt;</span></span> <span class="token function">GetBooksByLocale</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> cid<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="配置默认返回类型"><a href="#配置默认返回类型" class="header-anchor">#</a> 配置默认返回类型</h3> <p>响应内容默认为一个xml格式，我们可以通过配置使得返回格式为json</p> <p><code>Global.asax.cs</code></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Application_Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
   <span class="token comment">//清除xml格式化设置</span>
   GlobalConfiguration<span class="token punctuation">.</span>Configuration<span class="token punctuation">.</span>Formatters<span class="token punctuation">.</span>XmlFormatter<span class="token punctuation">.</span>SupportedMediaTypes<span class="token punctuation">.</span><span class="token function">Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="跨域访问"><a href="#跨域访问" class="header-anchor">#</a> 跨域访问</h3> <blockquote><p>配置</p></blockquote> <p><strong>步骤一：安装跨域程序包</strong></p> <p><img src="C:%5CUsers%5CAdmin%5CDesktop%5C%E5%9F%B9%E8%AE%AD%5CC#%5CtyporaImg%5C%E8%B7%A8%E5%9F%9F%E5%8C%85.png" alt="跨域包"></p> <p><strong>步骤二：启用配置</strong></p> <p><code>WebApiConfig.cs</code></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Web<span class="token punctuation">.</span>Http<span class="token punctuation">.</span>Cors</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">WebApplication2</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">WebApiConfig</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Register</span><span class="token punctuation">(</span><span class="token class-name">HttpConfiguration</span> config<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// Web API 配置和服务</span>
            config<span class="token punctuation">.</span><span class="token function">EnableCors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Web API 路由</span>
            config<span class="token punctuation">.</span><span class="token function">MapHttpAttributeRoutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            config<span class="token punctuation">.</span>Routes<span class="token punctuation">.</span><span class="token function">MapHttpRoute</span><span class="token punctuation">(</span>
                <span class="token named-parameter punctuation">name</span><span class="token punctuation">:</span> <span class="token string">&quot;DefaultApi&quot;</span><span class="token punctuation">,</span>
                <span class="token named-parameter punctuation">routeTemplate</span><span class="token punctuation">:</span> <span class="token string">&quot;api/{controller}/{id}&quot;</span><span class="token punctuation">,</span>
                <span class="token named-parameter punctuation">defaults</span><span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> id <span class="token operator">=</span> RouteParameter<span class="token punctuation">.</span>Optional <span class="token punctuation">}</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>全局配置</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>config<span class="token punctuation">.</span><span class="token function">EnableCors</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">EnableCorsAttribute</span><span class="token punctuation">(</span><span class="token named-parameter punctuation">origins</span><span class="token punctuation">:</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">headers</span><span class="token punctuation">:</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">methods</span><span class="token punctuation">:</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>单独配置</p> <p><code>StudentController.cs</code></p> <p>using System.Web.Http.Cors;</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">EnableCors</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token named-parameter punctuation">origins</span><span class="token punctuation">:</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">headers</span><span class="token punctuation">:</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">methods</span><span class="token punctuation">:</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StudentController</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ApiController</span></span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpGet</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">Getmethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;get&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="参数的传递"><a href="#参数的传递" class="header-anchor">#</a> 参数的传递</h3> <p><strong>Get</strong></p> <blockquote><p><strong>1.单参数传递 QueryString</strong></p></blockquote> <p>前端</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">params</span><span class="token operator">:</span><span class="token string">'张三'</span>
</code></pre></div><p>后端</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpGet</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">GetStudnet</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">FromUri</span></span><span class="token punctuation">]</span><span class="token class-name">String</span> name<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><strong>2.多参数传递 QueryString</strong></p></blockquote> <p>前端</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">params</span><span class="token operator">:</span>
</code></pre></div><p>后端</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpGet</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">GetStudnet</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">FromUri</span></span><span class="token punctuation">]</span><span class="token class-name">String</span> name<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><strong>3.对象参数传递</strong></p></blockquote> <p>前端</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">id</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span> <span class="token operator">:</span> <span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">create_time</span> <span class="token operator">:</span> <span class="token string">'2023-07-11'</span> <span class="token punctuation">}</span>

<span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span>		<span class="token comment">//必须写</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://localhost:44371/api/student'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'get'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">params</span><span class="token operator">:</span>obj
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>后端</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpGet</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">GetStudnet</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">FromUri</span></span><span class="token punctuation">]</span><span class="token class-name">Student</span> student<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>Post、Put、Delete</strong></p> <blockquote><p><strong>1.单参数传递</strong></p></blockquote> <p>前端：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://localhost:44343/api/student'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'post'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span><span class="token string">'张三'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>后端：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpPost</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">Post</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">FromBody</span></span><span class="token punctuation">]</span> <span class="token class-name"><span class="token keyword">string</span></span> <span class="token keyword">value</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token string">&quot;post&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><strong>2.多参数，多参数传递时需要使用对象，不能使用多个[FromBody]</strong></p></blockquote> <p>前端：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> obj<span class="token operator">=</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'123'</span><span class="token punctuation">,</span><span class="token literal-property property">age</span><span class="token operator">:</span><span class="token number">123</span><span class="token punctuation">,</span><span class="token literal-property property">create_time</span><span class="token operator">:</span><span class="token string">'2023-08-08'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://localhost:44343/api/student'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'post'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span>obj<span class="token comment">//对象</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>后端：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpPost</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">Post</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">FromBody</span></span><span class="token punctuation">]</span> <span class="token class-name">Student</span> model<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token string">&quot;post&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>使用postman访问接口</strong></p> <blockquote><p>1)传递一个参数:</p></blockquote> <p>在body中使用raw</p> <p>raw传参方式指的是使用json进行传递，并且在headers中需要指定Content-Type为application/json</p> <blockquote><p>2)传递一个对象:</p></blockquote> <p>同上，只是json为一个对象</p> <h3 id="swaggerui"><a href="#swaggerui" class="header-anchor">#</a> SwaggerUI</h3> <p>一个基于webapi框架的接口生成UI库，能够自动生成接口网页。</p> <blockquote><p>使用</p></blockquote> <p><strong>步骤一：安装Swashbuckle</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code>Install-Package Swashbuckle
</code></pre></div><p><strong>步骤二：配置swagger的xml文件</strong></p> <p>右键项目&gt;属性&gt;生成&gt;将XML文档文件改为&quot;bin\SwaggerF.xml&quot;</p> <p><strong>步骤三：找到App_Start文件夹下的SwaggerConfig.cs，复制以下代码更改命名空间</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Web<span class="token punctuation">.</span>Http</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">WebActivatorEx</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">WebAPIApp</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Swashbuckle<span class="token punctuation">.</span>Application</span><span class="token punctuation">;</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token target keyword">assembly</span><span class="token punctuation">:</span> <span class="token class-name">PreApplicationStartMethod</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">SwaggerConfig</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;Register&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>

<span class="token keyword">namespace</span> <span class="token namespace">WebAPIApp</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SwaggerConfig</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Register</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> thisAssembly <span class="token operator">=</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">SwaggerConfig</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Assembly<span class="token punctuation">;</span>
            GlobalConfiguration<span class="token punctuation">.</span>Configuration
                <span class="token punctuation">.</span><span class="token function">EnableSwagger</span><span class="token punctuation">(</span>c <span class="token operator">=&gt;</span>
                <span class="token punctuation">{</span>
                    c<span class="token punctuation">.</span><span class="token function">SingleApiVersion</span><span class="token punctuation">(</span><span class="token string">&quot;v1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;SwaggerF&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//版本号+项目名称</span>
                    <span class="token class-name"><span class="token keyword">var</span></span> webApiXmlPath <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">&quot;{0}/bin/SwaggerF.xml&quot;</span><span class="token punctuation">,</span> System<span class="token punctuation">.</span>AppDomain<span class="token punctuation">.</span>CurrentDomain<span class="token punctuation">.</span>BaseDirectory<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//配置生成路径</span>
                    c<span class="token punctuation">.</span><span class="token function">IncludeXmlComments</span><span class="token punctuation">(</span>webApiXmlPath<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">EnableSwaggerUi</span><span class="token punctuation">(</span>c <span class="token operator">=&gt;</span>
                <span class="token punctuation">{</span>

                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="asp-net-core"><a href="#asp-net-core" class="header-anchor">#</a> ASP.NET Core</h2> <p>.NET Framework 特别大的一个类库，提供了各种各样的程序集供开发人员使用。</p> <p>问题：</p> <p>.NET Framework天生在设计的时候依赖于windows操作系统的。在windows运行是最好的解决方案，也是效率最高的解决方案。</p> <p>开源的组件，一般都是在linux发布的，导致很多组件无法在.NET Framework上运行。</p> <p>所以微软在2015年时候宣布，退出了一个新的.NET 框架底层，叫ASP.NET Core。</p> <p>优势：</p> <p>1实现跨平台，支持linux操作系统和windows操作系统</p> <p>2微软core推出了很多类库，程序包；希望我们转型.net core平台上   同时支持.net framework（4.8）</p> <h3 id="托管方式"><a href="#托管方式" class="header-anchor">#</a> 托管方式</h3> <p><strong>使用iisexpress进行程序包托管（进程内托管）</strong></p> <p>特点：应用程序托管在IIS工作进程中</p> <p>​           只有一个服务器</p> <p>​           从性能上说，在进程托管中优于进程外托管</p> <p><strong>使用kestrel进行进程外托管</strong></p> <p>特点：充当一个托管服务器</p> <p>​           还可以与反向代理服务器结合使用，例如：IIS,Nginx或Apache</p> <h3 id="appsettings-json文件"><a href="#appsettings-json文件" class="header-anchor">#</a> appsettings.json文件</h3> <p>配置源</p> <p>appsettings.json文件需要使用configuration配置服务捕获</p> <blockquote><p>使用.NET Core 5.0（vs2019）</p></blockquote> <p><code>Startup.cs</code></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>Configuration</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Startup</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">IConfiguration</span> _configuration<span class="token punctuation">;</span>
	<span class="token comment">//将IConfiguration注入进来</span>
    <span class="token keyword">public</span> <span class="token function">Startup</span><span class="token punctuation">(</span><span class="token class-name">IConfiguration</span> configuration<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _configuration <span class="token operator">=</span> configuration<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> services<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token range operator">..</span><span class="token punctuation">.</span>
		<span class="token comment">//获取key为user的配置文件的值</span>
        configuration<span class="token punctuation">[</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">//获取key为student下的age的值</span>
        configuration<span class="token punctuation">[</span><span class="token string">&quot;student:age&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">IApplicationBuilder</span> app<span class="token punctuation">,</span> <span class="token class-name">IWebHostEnvironment</span> env<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
		<span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>使用.NET Core 6.0（vs2023）</p></blockquote> <p><code>Program.cs</code></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> _configuration<span class="token operator">=</span>builder<span class="token punctuation">.</span>Configuration<span class="token punctuation">;</span>

<span class="token comment">//获取key为user的配置文件的值</span>
configuration<span class="token punctuation">[</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//获取key为student下的age的值</span>
configuration<span class="token punctuation">[</span><span class="token string">&quot;student:age&quot;</span><span class="token punctuation">]</span>
</code></pre></div><p><strong>User secrets用户机密</strong></p> <p>通常在项目中，我们会使用到一些涉密的账号密码，如支付宝或微信的配置信息，如果我们将配置信息写入appsettings.json文件中，代码push到云服务器上可能存在着安全隐患。此时可以使用用户机密功能。</p> <blockquote><p>使用</p></blockquote> <p><strong>步骤一：右键项目点击管理用户机密，在secrets.json中编写机密信息</strong></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;MyKey&quot;</span><span class="token operator">:</span> <span class="token string">&quot;asdvnajsxasmxalsxmb&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>步骤二：在appsettings.json中配置</strong></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;Logging&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;LogLevel&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;Default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Information&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;Microsoft&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Warning&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;Microsoft.Hosting.Lifetime&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Information&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;AllowedHosts&quot;</span><span class="token operator">:</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;myKey&quot;</span><span class="token operator">:</span> <span class="token string">&quot;MyKey&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>tips：appsettings.json中的键和secrets.json中的键必须叫MyKey不区分大小写</strong></p> <h3 id="asp-net内置注入服务"><a href="#asp-net内置注入服务" class="header-anchor">#</a> ASP.NET内置注入服务</h3> <p><strong>Swagger配置</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//注入服务</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> services<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//先安装ASP.NET SwaggerGen的包才会有</span>
    services<span class="token punctuation">.</span><span class="token function">AddSwaggerGen</span><span class="token punctuation">(</span>c <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        c<span class="token punctuation">.</span><span class="token function">SwaggerDoc</span><span class="token punctuation">(</span><span class="token string">&quot;v1&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OpenApiInfo</span> <span class="token punctuation">{</span> Title <span class="token operator">=</span> <span class="token string">&quot;Your API&quot;</span><span class="token punctuation">,</span> Version <span class="token operator">=</span> <span class="token string">&quot;v1&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//配置中间件</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">IApplicationBuilder</span> app<span class="token punctuation">,</span> <span class="token class-name">IWebHostEnvironment</span> env<span class="token punctuation">,</span> <span class="token class-name">IConfiguration</span> configuration<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>env<span class="token punctuation">.</span><span class="token function">IsDevelopment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        app<span class="token punctuation">.</span><span class="token function">UseSwagger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    	app<span class="token punctuation">.</span><span class="token function">UseSwaggerUI</span><span class="token punctuation">(</span>c <span class="token operator">=&gt;</span>
        <span class="token punctuation">{</span>
            c<span class="token punctuation">.</span><span class="token function">SwaggerEndpoint</span><span class="token punctuation">(</span><span class="token string">&quot;/swagger/v1/swagger.json&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Your API V1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            c<span class="token punctuation">.</span>RoutePrefix <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">;</span> <span class="token comment">// 设置 Swagger UI 的根路径</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
	<span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>EFCore配置</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//注入服务</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> services<span class="token punctuation">,</span> <span class="token class-name">IConfiguration</span> configuration<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//安装Microsoft.EntityFrameworkCore包 和 Microsoft.EntityFrameworkCore.SqlServe包（用什么数据库就安装对应的包）</span>
    services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddDbContext</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>DataContext<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>opt <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        opt<span class="token punctuation">.</span><span class="token function">UseSqlServer</span><span class="token punctuation">(</span>configuration<span class="token punctuation">[</span><span class="token string">&quot;connStr&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>JSON文件中中文乱码服务</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//注入服务</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> services<span class="token punctuation">,</span> <span class="token class-name">IConfiguration</span> configuration<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    services<span class="token punctuation">.</span><span class="token function">AddControllers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">AddJsonOptions</span><span class="token punctuation">(</span>cfg <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        cfg<span class="token punctuation">.</span>JsonSerializerOptions<span class="token punctuation">.</span>Encoder <span class="token operator">=</span> JavaScriptEncoder<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>UnicodeRanges<span class="token punctuation">.</span>All<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="中间件"><a href="#中间件" class="header-anchor">#</a> 中间件</h3> <p>官方文档：https://learn.microsoft.com/zh-cn/aspnet/core/fundamentals/middleware/?view=aspnetcore-7.0</p> <p>请求委托使用<code>Run</code>，<code>Map</code>和<code>Use</code>扩展方法进行配置。单独的请求委托可以以内联匿名方法（称为内联中间件）指定，或者可以在可重用的类中定义它。这些可重用的类和内联匿名方法是中间件或中间件组件。请求流程中的每个中间件组件都负责调用流水线中的下一个组件，如果适当，则负责链接短路。</p> <p>ASP.NET Core请求流程由一系列请求委托组成，如图所示</p> <p><img src="https://zhangwen0612.github.io/assets/img/668104-20171031100753449-11207087.040d860b.png" alt="668104-20171031100753449-11207087.png"></p> <p>每个委托可以在下一个委托之前和之后执行操作。委托还可以决定不将请求传递给下一个委托，这称为请求管道的短路。短路通常是可取的，因为它避免了不必要的工作。例如，静态文件中间件可以返回一个静态文件的请求，并使管道的其余部分短路。需要在管道早期调用异常处理委托，因此它们可以捕获后面管道的异常。</p> <p><strong>中间件使用方法</strong></p> <p>Use：通过Use的方式注册中间件，可以控制是否将请求传递到下一个中间件；</p> <p>Map:  通过Map的方式注册中间件，可以对管道增加分支，条件匹配走分支，不匹配切回主分支</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>app<span class="token punctuation">.</span><span class="token function">Map</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">PathString</span><span class="token punctuation">(</span><span class="token string">&quot;/test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> application <span class="token operator">=&gt;</span>
            <span class="token punctuation">{</span>
                application<span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
                <span class="token punctuation">{</span>
                    <span class="token keyword">await</span> context<span class="token punctuation">.</span>Response<span class="token punctuation">.</span><span class="token function">WriteAsync</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        　　　　　　　<span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Run：通过Run的方式注册中间件，一般用于断路或请求管道末尾，即不会将请求传递下去；</p> <p>Run又称为终端中间件，即最后一个执行的。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>app<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token keyword">async</span> context <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;end&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>ASP.NET Core的中间件</strong></p> <ul><li><p>可以被访问和请求</p></li> <li><p>可以处理请求后，将请求传递给下一个中间件</p></li> <li><p>可以让管道短路</p></li> <li><p>可以处理传出相应</p></li> <li><p>中间件的执行顺序是按添加顺序运行</p> <p><strong>asp.net core MVC模型下的中间件执行顺序</strong></p></li></ul> <p><img src="https://learn.microsoft.com/zh-cn/aspnet/core/fundamentals/middleware/index/_static/middleware-pipeline.svg?view=aspnetcore-6.0" alt="ASP.NET Core 中间件管道"></p> <p>典型建议顺序</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">IndividualAccountsExample<span class="token punctuation">.</span>Data</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Identity</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>EntityFrameworkCore</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> builder <span class="token operator">=</span> WebApplication<span class="token punctuation">.</span><span class="token function">CreateBuilder</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Add services to the container.</span>
<span class="token class-name"><span class="token keyword">var</span></span> connectionString <span class="token operator">=</span> builder<span class="token punctuation">.</span>Configuration<span class="token punctuation">.</span><span class="token function">GetConnectionString</span><span class="token punctuation">(</span><span class="token string">&quot;DefaultConnection&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddDbContext</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ApplicationDbContext<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>options <span class="token operator">=&gt;</span>
    options<span class="token punctuation">.</span><span class="token function">UseSqlServer</span><span class="token punctuation">(</span>connectionString<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddDatabaseDeveloperPageExceptionFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddDefaultIdentity</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IdentityUser<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>options <span class="token operator">=&gt;</span> options<span class="token punctuation">.</span>SignIn<span class="token punctuation">.</span>RequireConfirmedAccount <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddEntityFrameworkStores</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ApplicationDbContext<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddRazorPages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> app <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Configure the HTTP request pipeline.</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>app<span class="token punctuation">.</span>Environment<span class="token punctuation">.</span><span class="token function">IsDevelopment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    app<span class="token punctuation">.</span><span class="token function">UseMigrationsEndPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span>
<span class="token punctuation">{</span>
    app<span class="token punctuation">.</span><span class="token function">UseExceptionHandler</span><span class="token punctuation">(</span><span class="token string">&quot;/Error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// The default HSTS value is 30 days. You may want to change this for production scenarios, see https://aka.ms/aspnetcore-hsts.</span>
    app<span class="token punctuation">.</span><span class="token function">UseHsts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

app<span class="token punctuation">.</span><span class="token function">UseHttpsRedirection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">UseStaticFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// app.UseCookiePolicy();</span>

app<span class="token punctuation">.</span><span class="token function">UseRouting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// app.UseCors();</span>

app<span class="token punctuation">.</span><span class="token function">UseAuthentication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">UseAuthorization</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// app.UseSession();</span>
<span class="token comment">// app.UseResponseCompression();</span>
<span class="token comment">// app.UseResponseCaching();</span>

app<span class="token punctuation">.</span><span class="token function">MapRazorPages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">MapControllerRoute</span><span class="token punctuation">(</span>
    <span class="token named-parameter punctuation">name</span><span class="token punctuation">:</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span>
    <span class="token named-parameter punctuation">pattern</span><span class="token punctuation">:</span> <span class="token string">&quot;{controller=Home}/{action=Index}/{id?}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="常用的服务"><a href="#常用的服务" class="header-anchor">#</a> 常用的服务</h3> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//注入EF SQL服务</span>
services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddDbContextPool</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>AppDbContext<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>options <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
  options<span class="token punctuation">.</span><span class="token function">UseSqlServer</span><span class="token punctuation">(</span>_configuration<span class="token punctuation">.</span><span class="token function">GetConnectionString</span><span class="token punctuation">(</span><span class="token string">&quot;StudentDBConnection&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//mvc中间件</span>
services<span class="token punctuation">.</span><span class="token function">AddMvc</span><span class="token punctuation">(</span>options <span class="token operator">=&gt;</span> options<span class="token punctuation">.</span>EnableEndpointRouting <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//IOC容器中间件</span>
services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">addTransient</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IStudentRepository<span class="token punctuation">,</span> SQLStudentRepository<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddScoped</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IStudentRepository<span class="token punctuation">,</span> SQLStudentRepository<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSingleton</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IClassesRepository<span class="token punctuation">,</span> SQLClassesRepository<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//中文编码中间件</span>
services<span class="token punctuation">.</span><span class="token function">AddControllers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">AddJsonOptions</span><span class="token punctuation">(</span>options <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
  options<span class="token punctuation">.</span>JsonSerializerOptions<span class="token punctuation">.</span>Encoder<span class="token operator">=</span>JavaScriptEncoder<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>UnicodeRanges<span class="token punctuation">.</span>All<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="常用中间件"><a href="#常用中间件" class="header-anchor">#</a> 常用中间件</h3> <p><strong>开发模式中间件</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//开发模式中间件</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>env<span class="token punctuation">.</span><span class="token function">IsDevelopment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    app<span class="token punctuation">.</span><span class="token function">UseDeveloperExceptionPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>使用mvc和默认路由中间件</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//使用mvc和默认路由中间件</span>
app<span class="token punctuation">.</span><span class="token function">UseMvc</span><span class="token punctuation">(</span>routers <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    routers<span class="token punctuation">.</span><span class="token function">MapRoute</span><span class="token punctuation">(</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;{controller=Home}/{action=List}/{id?}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>加载静态资源</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>app<span class="token punctuation">.</span><span class="token function">UseStaticFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>加载默认文件</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>app<span class="token punctuation">.</span><span class="token function">UseDefaultFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>设置初始页</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">FileServerOptions</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">FileServerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
options<span class="token punctuation">.</span>DefaultFilesOptions<span class="token punctuation">.</span>DefaultFileNames<span class="token punctuation">.</span><span class="token function">Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
options<span class="token punctuation">.</span>DefaultFilesOptions<span class="token punctuation">.</span>DefaultFileNames<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;index.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">UseFileServer</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="asp-net-core-mvc使用"><a href="#asp-net-core-mvc使用" class="header-anchor">#</a> ASP.NET Core MVC使用</h3> <p><strong>步骤一：在服务中添加MVC组件</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> services<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//MVC中间件								不使用内置默认路由配置</span>
    services<span class="token punctuation">.</span><span class="token function">AddMvc</span><span class="token punctuation">(</span>options <span class="token operator">=&gt;</span> options<span class="token punctuation">.</span>EnableEndpointRouting <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>步骤二：配置MVC路由中间件</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>app<span class="token punctuation">.</span><span class="token function">UseMvc</span><span class="token punctuation">(</span>routers <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    routers<span class="token punctuation">.</span><span class="token function">MapRoute</span><span class="token punctuation">(</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;{controller=Home}/{action=List}/{id?}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>tips：配置完MVC后WebApi控制器也可以使用</strong></p> <h3 id="viewstart和viewimport"><a href="#viewstart和viewimport" class="header-anchor">#</a> ViewStart和ViewImport</h3> <p>ViewStart：用户设置母版页,可以让页面继承母版页后省略Layout下的路径填写</p> <p>ViewImport:用于统一设置强类型页面中类型的命名空间</p> <p>ViewImports文件支持指令：</p> <p>Razor语法：https://learn.microsoft.com/zh-cn/aspnet/core/mvc/views/razor?view=aspnetcore-7.0</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>@addTagHelper			<span class="token comment">//使用.NET Core内置的一些标签</span>
						<span class="token comment">//例：@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers</span>
						<span class="token comment">//语法参考:https://blog.csdn.net/Cheng_XZ/article/details/112894788</span>

@removeTagHelper	    <span class="token comment">//从视图中删除以前添加的标记帮助程序。 </span>

@model					<span class="token comment">//指定传递到视图或页面的模型类型</span>

@inherits				<span class="token comment">//可以自定义Razor</span>

@inject					<span class="token comment">//将服务注入到视图	例：@inject IConfiguration _configuration</span>
						<span class="token comment">//这样在强类型页面就可以用 @_configuration[&quot;key&quot;]</span>

@tagHelperPrefix

@<span class="token keyword">using</span>					<span class="token comment">//在viewimport引入，之后的强类型页面可以直接使用</span>
</code></pre></div><p><strong>使用TagHelper的优势</strong></p> <p>TagHelper是根据应用程序的路由模板生成的链接，这意味着如果我们更改路由模板，则TagHelper生成的链接会针对路由模板所做的更改自动修改和适配，让生成的链接正常工作。</p> <h3 id="libman使用"><a href="#libman使用" class="header-anchor">#</a> LibMan使用</h3> <p>客户端（前端）库管理工具，类似npm</p> <p>libman安装前端插件.css .js...</p> <p>nuget安装后端插件.dll</p> <h3 id="asp-net-core自带的ioc容器"><a href="#asp-net-core自带的ioc容器" class="header-anchor">#</a> ASP.NET Core自带的IOC容器</h3> <p>IServiceCollection下有三个自带IOC容器可以让我们使用他们分别是：</p> <p><strong>AddSingleton（单例模式）</strong></p> <p>首次请求会创建一个服务，然后后续请求使用的都是<strong>相同实例</strong>，整个应用程序声明周期中使用该单个实例。</p> <p><strong>AddScoped</strong></p> <p>在范围内<strong>每个请求</strong>创建一个服务实例，例如在web应用程序中，他为每个http请求创建一个实例，但是同一个web请求中的其他服务在请求的时候，都会使用相同的实例。在多个客户端请求中是不同的。</p> <p><strong>AddTransient</strong></p> <p><strong>每次</strong>请求时，都创建一个<strong>新的服务实例</strong>。</p> <p><img src="https://zhangwen0612.github.io/assets/img/image-20210926135408254.be2ab6c6.png" alt="image-20210926135408254"></p> <blockquote><p>使用</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> services<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token comment">//Singleton				接口					注入的类</span>
    services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSingleton</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IStudentRepository<span class="token punctuation">,</span>StudentRepository<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//Scoped</span>
    services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddScoped</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IStudentRepository<span class="token punctuation">,</span>StudentRepository<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//Transient</span>
    services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddTransient</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IStudentRepository<span class="token punctuation">,</span>StudentRepository<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="ef-orm-的使用"><a href="#ef-orm-的使用" class="header-anchor">#</a> EF(ORM)的使用</h3> <p>.NET Core中使用EntityFramework</p> <p><strong>步骤一：安装EntityFrameworkCore</strong></p> <p><strong>步骤二：安装数据库服务Microsoft.EntityFrameworkCore.SqlServer</strong></p> <p>数据库服务参考：https://docs.microsoft.com/zh-cn/ef/core/providers/?tabs=dotnet-core-cli</p> <p><strong>步骤三：创建DbContext文件</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StudentDbContext</span><span class="token punctuation">:</span><span class="token type-list"><span class="token class-name">DbContext</span></span>
<span class="token punctuation">{</span>
    <span class="token comment">//要将应用程序配置信息传递给DbContext，需要对DbContextOptions进行实例化</span>
    <span class="token keyword">public</span> <span class="token function">StudentDbContext</span><span class="token punctuation">(</span><span class="token class-name">DbContextOptions<span class="token punctuation">&lt;</span>StudentDbContext<span class="token punctuation">&gt;</span></span> options<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
    <span class="token comment">//数据库表注册</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DbSet<span class="token punctuation">&lt;</span>Student<span class="token punctuation">&gt;</span></span> Student <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>步骤四：Startup.cs中进行服务注入</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>Configuration</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>EntityFrameworkCore</span><span class="token punctuation">;</span>


<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> services<span class="token punctuation">,</span><span class="token class-name">IConfiguration</span> configuration<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//注入sqlserver服务</span>
    services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddDbContextPool</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>StudentDbContext<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>options <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        options<span class="token punctuation">.</span><span class="token function">UseSqlServer</span><span class="token punctuation">(</span>configuration<span class="token punctuation">.</span><span class="token function">GetConnectionString</span><span class="token punctuation">(</span><span class="token string">&quot;SqlServer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>步骤五：配置连接字符串信息</strong></p> <p><code>appsettings.json</code></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token string">&quot;ConnectionStrings&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;SqlServer&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;server=.;uid=sa;pwd=sa;database=TestStudent&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="数据迁移"><a href="#数据迁移" class="header-anchor">#</a> 数据迁移</h3> <blockquote><p>使用</p></blockquote> <p><strong>安装Microsoft.EntityFrameworkCore.Tools包</strong></p> <p><strong>迁移命令</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code>//添加新迁移记录
add-migration 记录名称

//将数据库更新为指定的迁移
update-database 记录名称<span class="token punctuation">(</span>不写默认最后一次迁移<span class="token punctuation">)</span>
</code></pre></div><h3 id="种子数据"><a href="#种子数据" class="header-anchor">#</a> 种子数据</h3> <p>自动生成一些基础数据</p> <blockquote><p>使用</p></blockquote> <p><code>StudentDbContext.cs</code></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StudentDbContext</span><span class="token punctuation">:</span><span class="token type-list"><span class="token class-name">DbContext</span></span>
<span class="token punctuation">{</span>
    <span class="token comment">//要将应用程序配置信息传递给DbContext，需要对DbContextOptions进行实例化</span>
    <span class="token keyword">public</span> <span class="token function">StudentDbContext</span><span class="token punctuation">(</span><span class="token class-name">DbContextOptions<span class="token punctuation">&lt;</span>StudentDbContext<span class="token punctuation">&gt;</span></span> options<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DbSet<span class="token punctuation">&lt;</span>Student<span class="token punctuation">&gt;</span></span> Student <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
	
    <span class="token comment">//种子数据</span>
    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnModelCreating</span><span class="token punctuation">(</span><span class="token class-name">ModelBuilder</span> modelBuilder<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        modelBuilder<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Entity</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Student<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">HasData</span><span class="token punctuation">(</span>
            <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Student</span>
            <span class="token punctuation">{</span>
                id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
                name <span class="token operator">=</span> <span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span>
                age <span class="token operator">=</span> <span class="token number">18</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Student</span>
            <span class="token punctuation">{</span>
                id <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>
                name <span class="token operator">=</span> <span class="token string">&quot;王五&quot;</span><span class="token punctuation">,</span>
                age<span class="token operator">=</span><span class="token number">20</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>扩展方法</strong></p> <p>随着数据中的表越来越多，种子数据也会越来越多，此时DbContext类就会特别的臃肿，我们可以利用扩展方法解决这个问题。</p> <p><code>StudentDbContext</code></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//要将应用程序配置信息传递给DbContext，需要对DbContextOptions进行实例化</span>
<span class="token keyword">public</span> <span class="token function">StudentDbContext</span><span class="token punctuation">(</span><span class="token class-name">DbContextOptions<span class="token punctuation">&lt;</span>StudentDbContext<span class="token punctuation">&gt;</span></span> options<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
<span class="token punctuation">{</span>

<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token return-type class-name">DbSet<span class="token punctuation">&lt;</span>Student<span class="token punctuation">&gt;</span></span> Student <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnModelCreating</span><span class="token punctuation">(</span><span class="token class-name">ModelBuilder</span> modelBuilder<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    modelBuilder<span class="token punctuation">.</span><span class="token function">Seed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>ModelBuilderExtensions</code></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//扩展访问类</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">classs</span> ModelBuilderExtensions
<span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Seed</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token class-name">ModelBuilder</span> modelBuilder<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
       modelBuilder<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Entity</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Student<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">HasData</span><span class="token punctuation">(</span>
            <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Student</span>
            <span class="token punctuation">{</span>
                Id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
                Name <span class="token operator">=</span> <span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span>
                ClassId <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
                Emali <span class="token operator">=</span> <span class="token string">&quot;30856896@qq.com&quot;</span><span class="token punctuation">,</span>
                Phone <span class="token operator">=</span> <span class="token string">&quot;13803797005&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Student</span>
            <span class="token punctuation">{</span>
                Id <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>
                Name <span class="token operator">=</span> <span class="token string">&quot;王五&quot;</span><span class="token punctuation">,</span>
                ClassId <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
                Emali <span class="token operator">=</span> <span class="token string">&quot;872330790@qq.com&quot;</span><span class="token punctuation">,</span>
                Phone <span class="token operator">=</span> <span class="token string">&quot;13803797005&quot;</span>
            <span class="token punctuation">}</span>
    	<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="sqlsugar-orm-的使用"><a href="#sqlsugar-orm-的使用" class="header-anchor">#</a> SqlSugar(ORM)的使用</h3> <p>文档：https://www.donet5.com/home/doc</p> <blockquote><p>使用</p></blockquote> <p><strong>步骤一：安装SqlSugarCore包</strong></p> <p><strong>步骤二：注册服务</strong></p> <p><code>Startup.cs</code></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">SqlSugar</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> services<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//SqlSuger服务</span>
    <span class="token comment">//注册SqlSugar用AddScoped</span>
    services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddScoped</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ISqlSugarClient<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
    	<span class="token comment">//Scoped用SqlSugarClient </span>
        <span class="token class-name">SqlSugarClient</span> sqlSugar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlSugarClient</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">ConnectionConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
        	<span class="token comment">//使用的数据库</span>
            DbType <span class="token operator">=</span> SqlSugar<span class="token punctuation">.</span>DbType<span class="token punctuation">.</span>MySql<span class="token punctuation">,</span>
            ConnectionString <span class="token operator">=</span> <span class="token string">&quot;server=localhost;uid=root;pwd=lifei666;database=studenttest;charset=utf8&quot;</span><span class="token punctuation">,</span>
            IsAutoCloseConnection <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        db <span class="token operator">=&gt;</span>
        <span class="token punctuation">{</span>
         	<span class="token comment">//单例参数配置，所有上下文生效</span>
            db<span class="token punctuation">.</span>Aop<span class="token punctuation">.</span>OnLogExecuting <span class="token operator">=</span> <span class="token punctuation">(</span>sql<span class="token punctuation">,</span> pars<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
            <span class="token punctuation">{</span>
                <span class="token comment">//获取IOC对象不要求在一个上下文</span>
                <span class="token comment">//vra log=s.GetService&lt;Log&gt;()</span>

                <span class="token comment">//获取IOC对象要求在一个上下文</span>
                <span class="token comment">//var appServive = s.GetService&lt;IHttpContextAccessor&gt;();</span>
                <span class="token comment">//var log= appServive?.HttpContext?.RequestServices.GetService&lt;Log&gt;();</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> sqlSugar<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">IApplicationBuilder</span> app<span class="token punctuation">,</span> <span class="token class-name">IWebHostEnvironment</span> env<span class="token punctuation">)</span>
<span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre></div><p><strong>步骤三：注入使用</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StudentController</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Controller</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">ISqlSugarClient</span> _db<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">StudentController</span><span class="token punctuation">(</span><span class="token class-name">ISqlSugarClient</span> db<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _db <span class="token operator">=</span> db<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">Index</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">View</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="session-2"><a href="#session-2" class="header-anchor">#</a> Session</h3> <blockquote><p>使用</p></blockquote> <p><strong>步骤一：使用IDistributedcache接口服务启用内存缓存</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>services<span class="token punctuation">.</span><span class="token function">AddDistributedMemoryCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>步骤二：调用addsession方法</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>services<span class="token punctuation">.</span><span class="token function">AddSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>步骤三：配置中间件(需在useMvc()方法前调用)</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>app<span class="token punctuation">.</span><span class="token function">UseSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//中间件：配置mvc中的路由</span>
app<span class="token punctuation">.</span><span class="token function">UseMvc</span><span class="token punctuation">(</span>routers <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    routers<span class="token punctuation">.</span><span class="token function">MapRoute</span><span class="token punctuation">(</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;{controller=Student}/{action=List}/{id?}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>步骤四：session的存储</strong></p> <p>.NET Core 5.0</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Http</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StudentController</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Controller</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">Home</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//存</span>
        HttpContext<span class="token punctuation">.</span>Session<span class="token punctuation">.</span><span class="token function">SetString</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//取</span>
        HttpContext<span class="token punctuation">.</span>Session<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">View</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="日志记录nlog"><a href="#日志记录nlog" class="header-anchor">#</a> 日志记录nlog</h3> <p>我们需要对程序的请求过程进行日志记录，常用的日志记录库非常多，例如NLog、Stackdriver、Gelf、Log4net、Logger等。</p> <h3 id="filter拦截器"><a href="#filter拦截器" class="header-anchor">#</a> Filter拦截器</h3> <p><strong>AuthonizationFilter</strong></p> <p>验权过滤器：可以实现复杂的<code>权限角色认证</code>、<code>登陆授权</code>等操作</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//                                  特性标注类     </span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AuthonizationFilter</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Attribute</span><span class="token punctuation">,</span> <span class="token class-name">IAuthorizationFilter</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnAuthorization</span><span class="token punctuation">(</span><span class="token class-name">AuthorizationFilterContext</span> context<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//访问路径为/student/login</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>context<span class="token punctuation">.</span>HttpContext<span class="token punctuation">.</span>Request<span class="token punctuation">.</span>Path<span class="token operator">==</span><span class="token string">&quot;/student/login&quot;</span><span class="token punctuation">)</span> 
        <span class="token punctuation">{</span>
            <span class="token comment">//未通过验证则跳转到无权限提示页</span>
            <span class="token class-name">RedirectToActionResult</span> content <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">RedirectToActionResult</span><span class="token punctuation">(</span><span class="token string">&quot;index&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;student&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            context<span class="token punctuation">.</span>Result <span class="token operator">=</span> content<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>ResourceFilter</strong></p> <p>资源过滤器：可以进行<code>资源缓存</code>、<code>防盗链</code>等操作。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ResourceFilter</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Attribute</span><span class="token punctuation">,</span> <span class="token class-name">IResourceFilter</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnResourceExecuted</span><span class="token punctuation">(</span><span class="token class-name">ResourceExecutedContext</span> context<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 执行完后的操作</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnResourceExecuting</span><span class="token punctuation">(</span><span class="token class-name">ResourceExecutingContext</span> context<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 执行中的过滤器管道</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>ExceptionFilter</strong></p> <p>异常过滤器：可以进行全局的<code>异常日志收集</code> 等操作。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExceptionFilter</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Attribute</span><span class="token punctuation">,</span> <span class="token class-name">IExceptionFilter</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">ILogger<span class="token punctuation">&lt;</span>ExceptionFilter<span class="token punctuation">&gt;</span></span> _logger<span class="token punctuation">;</span>

    <span class="token comment">//注入日志类</span>
    <span class="token keyword">public</span> <span class="token function">ExceptionFilter</span><span class="token punctuation">(</span><span class="token class-name">ILogger<span class="token punctuation">&lt;</span>ExceptionFilter<span class="token punctuation">&gt;</span></span> logger<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _logger <span class="token operator">=</span> logger<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnException</span><span class="token punctuation">(</span><span class="token class-name">ExceptionContext</span> context<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//日志收集</span>
        _logger<span class="token punctuation">.</span><span class="token function">LogError</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Exception<span class="token punctuation">,</span> context<span class="token punctuation">?.</span>Exception<span class="token punctuation">?.</span>Message <span class="token operator">??</span> <span class="token string">&quot;异常&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>ActionFilter</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ActionFilter</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Attribute</span><span class="token punctuation">,</span> <span class="token class-name">IActionFilter</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnActionExecuted</span><span class="token punctuation">(</span><span class="token class-name">ActionExecutedContext</span> context<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//进入动作之后</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnActionExecuting</span><span class="token punctuation">(</span><span class="token class-name">ActionExecutingContext</span> context<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//进入动作之前</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>ResultFilter</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ResultFilter</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Attribute</span><span class="token punctuation">,</span> <span class="token class-name">IResultFilter</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnResultExecuted</span><span class="token punctuation">(</span><span class="token class-name">ResultExecutedContext</span> context<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//动作结束后</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnResultExecuting</span><span class="token punctuation">(</span><span class="token class-name">ResultExecutingContext</span> context<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//动作结束前</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="过滤器的注册方式"><a href="#过滤器的注册方式" class="header-anchor">#</a> <strong>过滤器的注册方式</strong></h4> <ol><li><p>Action上进行特性标注</p></li> <li><p>Controller上进行特性标注</p></li> <li><p>全局注册</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">DotNETCoreCURD<span class="token punctuation">.</span>Filter</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> services<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//全局注册异常过滤器</span>
    services<span class="token punctuation">.</span><span class="token function">AddControllersWithViews</span><span class="token punctuation">(</span>option <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">//					注册的过滤器类</span>
        option<span class="token punctuation">.</span>Filters<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Add</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ExceptionFilter<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol> <h4 id="typefilter和servicefilter"><a href="#typefilter和servicefilter" class="header-anchor">#</a> <strong>TypeFilter和ServiceFilter</strong></h4> <p>如果过滤器类的构造函数<strong>需要注入</strong>（构造函数不是无参构造）时，此时在特性标注的时候就不能直接使用过滤器类来直接进行特性标注。需要使用<code>TypeFilter</code> 或者<code>ServiceFilter</code> 方式进行过滤器的标注。</p> <p><code>TypeFilter</code> 和<code>ServiceFilter</code> 的区别。</p> <ul><li>ServiceFilter和TypeFilter都实现了IFilterFactory</li> <li>ServiceFilter需要对自定义的Filter进行注册，TypeFilter不需要</li> <li>ServiceFilter的Filter生命周期源自于您如何注册（Transient或者Scoped或者Singleton），而TypeFilter每次都会创建一个新的实例（Transient方式注入）</li></ul> <blockquote><p>使用</p></blockquote> <p><strong>TypeFilter</strong></p> <p>直接在控制器或动作上进行标注使用</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//					   过滤器类</span>
<span class="token punctuation">[</span><span class="token function">TypeFilter</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">ExecptionFilter</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name">IActionFilter</span> <span class="token function">Index2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>	<span class="token comment">//控制器或动作</span>
<span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">View</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>ServiceFilter</strong></p> <p>步骤一：<code>Startup.cs</code>文件中服务注册</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> services<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token comment">//注册过滤器服务，使用ServiceFilter 方式必须要注册 否则会报没有注册该服务的相关异常</span>
    services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSingleton</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ExecptionFilter<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>步骤二：在控制器或动作上进行标注使用</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//						过滤器类</span>
<span class="token punctuation">[</span><span class="token function">ServiceFilter</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">ExecptionFilter</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name">IActionFilter</span> <span class="token function">Index2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>	<span class="token comment">//控制器或动作</span>
<span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">View</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="获取当前项目路径"><a href="#获取当前项目路径" class="header-anchor">#</a> 获取当前项目路径</h3> <p>方法一：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>IO</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">string</span></span> path <span class="token operator">=</span> Path<span class="token punctuation">.</span><span class="token function">GetFullPath</span><span class="token punctuation">(</span><span class="token string">&quot;./&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>方法二：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Hosting</span><span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">IWebHostEnvironment</span> _env<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token function">StudentController</span><span class="token punctuation">(</span><span class="token class-name">IWebHostEnvironment</span> env<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    _env <span class="token operator">=</span> env<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

_env<span class="token punctuation">.</span>ContentRootPath
</code></pre></div><h2 id="sqlsuger"><a href="#sqlsuger" class="header-anchor">#</a> SqlSuger</h2> <p>文档：https://www.donet5.com/home/doc</p> <blockquote><p>使用</p></blockquote> <p>步骤一：安装SqlSugar（安装数据库的包如：使用MySQL则安装MySQL.Data）</p> <p>步骤二：创建实体</p> <p>步骤三：创建db对象</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">SqlSugarHelper</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">SqlSugarScope</span> Db <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlSugarScope</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">ConnectionConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            ConnectionString <span class="token operator">=</span> ConfigurationManager<span class="token punctuation">.</span>ConnectionStrings<span class="token punctuation">[</span><span class="token string">&quot;mysql&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ConnectionString<span class="token punctuation">,</span><span class="token comment">//连接符字串</span>
            DbType <span class="token operator">=</span> DbType<span class="token punctuation">.</span>MySql<span class="token punctuation">,</span><span class="token comment">//数据库类型</span>
            IsAutoCloseConnection <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment">//不设成true要手动close</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
          db <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token comment">//(A)全局生效配置点，一般AOP和程序启动的配置扔这里面 ，所有上下文生效</span>
              <span class="token comment">//调试SQL事件，可以删掉</span>
              db<span class="token punctuation">.</span>Aop<span class="token punctuation">.</span>OnLogExecuting <span class="token operator">=</span> <span class="token punctuation">(</span>sql<span class="token punctuation">,</span> pars<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
              <span class="token punctuation">{</span>
                  Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//输出sql,查看执行sql 性能无影响</span>

                  <span class="token comment">//获取原生SQL推荐 5.1.4.63  性能OK</span>
                  <span class="token comment">//UtilMethods.GetNativeSql(sql,pars)</span>

                  <span class="token comment">//获取无参数化SQL 对性能有影响，特别大的SQL参数多的，调试使用</span>
                  <span class="token comment">//UtilMethods.GetSqlString(DbType.SqlServer,sql,pars)</span>

              <span class="token punctuation">}</span><span class="token punctuation">;</span>

              <span class="token comment">//多个配置就写下面</span>
              <span class="token comment">//db.Ado.IsDisableMasterSlaveSeparation=true;</span>

              <span class="token comment">//注意多租户 有几个设置几个</span>
              <span class="token comment">//db.GetConnection(i).Aop</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h3 id="实体-2"><a href="#实体-2" class="header-anchor">#</a> 实体</h3> <p>[SugarColumn(IsIgnore =true)]	不处理该字段，可用于VO查询时该列不在该表中</p> <h2 id="comet技术"><a href="#comet技术" class="header-anchor">#</a> Comet技术</h2> <p>Ajax轮询：每经过一段时间，就发起一次ajax请求。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    $<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>优点：保证数据的即使更新。</p> <p>缺点：造成无效的请求。</p> <p><strong>Coment技术</strong></p> <p><strong>概念</strong>：Comet是一种用于web的技术，能使服务器能实时地将更新的信息传送到客户端，而无须客户端发出请求，目前有两种实现方式，长<a href="https://so.csdn.net/so/search?q=%E8%BD%AE%E8%AF%A2&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">轮询<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>和iframe流。</p> <p>简单的说是一种基于现有Http协议基础上的长轮询技术，之所有会产生这种技术的主要原因是Http协议是无状态的所以客户端和服务端之间没办法建立起一套长时间的连接。比如我们要做一个聊天室，在Web环境下我们通常不能从服务端推送消息到浏览器里，而只能通过每个客户端不断的轮询服务器，以获取最新的消息，这样一来效率非常低，而且不断的向服务器发送请求对于访问量大的应用来说也会造成很大的资源占用。</p> <p>于是人们就发现了这种技术，向服务器发起一个请求，然后服务器一直不响应这个请求，这样客户端和服务端之间就形成了一个长连接，直到服务端响应这个请求后结束本次连接。借用一下IBM里的图片：</p> <p><img src="https://img-blog.csdn.net/20151213154207268" alt="这里写图片描述"></p> <p>通过Ajax技术可以实现长轮询的服务器推模型，客户端和服务端之间通过不断的发起长轮询即可以实现数据的交互，这个过程由于是Ajax实现的异步操作所以体验上会比较好，效率也很高。哎呀呀，说不清楚，找个网上的资料：</p> <p>Comet方式通俗的说就是一种长连接机制(long lived http)。同样是由Browser端主动发起请求，但是Server端以一种似乎非常慢的响应方式给出回答。这样在这个期间内，服务器端可以使用同一个connection把要更新的数据主动发送给Browser。因此请求可能等待较长的时间，期间没有任何数据返回，但是一旦有了新的数据，它将立即被发送到客户机。Comet又有很多种实现方式，但是总的来说对Server端的负载都会有增加.虽然对于单位操作来说，每次只需要建议一次connection,但是由于connection是保持较长时间的,对于 server端的资源的占用要有所增加。</p> <p>优点： 实时性好（消息延时小）；性能好（能支持大量用户）</p> <p>缺点： 长期占用连接，丧失了无状态高并发的特点。</p> <p>应用： 股票系统、实时通讯。</p> <blockquote><p>使用：通过长连接查询支付状态</p></blockquote> <p><code>长连接接口</code></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name">JsonResult</span> <span class="token function">validPay</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">,</span><span class="token class-name"><span class="token keyword">int</span></span> SendTime<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//计算超时时间</span>
    <span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Thread<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        i<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">&lt;</span> SendTime<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">GoChecked</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token function">Json</span><span class="token punctuation">(</span><span class="token string">&quot;true&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> SendTime<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">Json</span><span class="token punctuation">(</span><span class="token string">&quot;false&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//判断支付状态</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">GoChecked</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">Contract</span> contract <span class="token operator">=</span> _contractService<span class="token punctuation">.</span><span class="token function">GetNoChche</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>contract<span class="token punctuation">.</span>pay_status <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>前端</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//轮询查询支付状态</span>
<span class="token keyword">function</span> <span class="token function">SendXHR</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;post&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&quot;/AliPay/validPay/@ViewBag.id&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">cache</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token literal-property property">timeout</span><span class="token operator">:</span> <span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">SendTime</span><span class="token operator">:</span> <span class="token number">60</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> textStatus</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            layer<span class="token punctuation">.</span><span class="token function">msg</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//刷新父页面</span>
            parent<span class="token punctuation">.</span>table<span class="token punctuation">.</span><span class="token function">reload</span><span class="token punctuation">(</span><span class="token string">&quot;tb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//关闭弹出层</span>
            <span class="token keyword">var</span> index <span class="token operator">=</span> parent<span class="token punctuation">.</span>layer<span class="token punctuation">.</span><span class="token function">getFrameIndex</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//从父页面上把layer关闭</span>
            parent<span class="token punctuation">.</span>layer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">XMLHttpRequest<span class="token punctuation">,</span> textStatus<span class="token punctuation">,</span> errorThrown</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>textStatus <span class="token operator">==</span> <span class="token string">&quot;timeout&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//超时间重发</span>
                <span class="token function">SendXHR</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="socket"><a href="#socket" class="header-anchor">#</a> Socket</h2> <p>基于C/S架构</p> <p>服务器端：</p> <p>第一步：创建一个用于监听连接的Socket对像；</p> <p>第二步：用指定的端口号和服务器的ip建立一个EndPoint对像； 127.0.0.1:5000用于监听</p> <p>第三步：用socket对像的Bind()方法绑定EndPoint；</p> <p>第四步：用socket对像的Listen()方法开始监听；</p> <p>第五步：接收到客户端的连接，用socket对像的Accept()方法创建一个新的用于和客户端进行通信的socket对像;</p> <p>第六步：通信结束后一定记得关闭socket;</p> <p>客户端：</p> <p>第一步：建立一个Socket对像；</p> <p>第二步：用指定的端口号和服务器的ip建立一个EndPoint对像；</p> <p>第三步：用socket对像的Connect()方法以上面建立的EndPoint对像做为参数，向服务器发出连接请求；</p> <p>第四步：如果连接成功，就用socket对像的Send()方法向服务器发送信息；</p> <p>第五步：用socket对像的Receive()方法接受服务器发来的信息 ;</p> <p>第六步：通信结束后一定记得关闭socket；</p> <h2 id="websocket"><a href="#websocket" class="header-anchor">#</a> WebSocket</h2> <p><strong>HTML5 WebSocket</strong></p> <p>WebSocket 是 HTML5 开始提供的一种在单个 TCP 连接上进行全双工通讯的协议。</p> <p>WebSocket 使得客户端和服务器之间的数据交换变得更加简单，允许服务端主动向客户端推送数据。在 WebSocket API 中，浏览器和服务器只需要完成一次握手，两者之间就直接可以创建持久性的连接，并进行双向数据传输。</p> <p>在 WebSocket API 中，浏览器和服务器只需要做一个握手的动作，然后，浏览器和服务器之间就形成了一条快速通道。两者之间就直接可以数据互相传送。</p> <p>现在，很多网站为了实现推送技术，所用的j技术都是 Ajax 轮询。轮询是在特定的的时间间隔（如每1秒），由浏览器对服务器发出HTTP请求，然后由服务器返回最新的数据给客户端的浏览器。这种传统的模式带来很明显的缺点，即浏览器需要不断的向服务器发出请求，然而HTTP请求可能包含较长的头部，其中真正有效的数据可能只是很小的一部分，显然这样会浪费很多的带宽等资源。</p> <p>HTML5 定义的 WebSocket 协议，能更好的节省服务器资源和带宽，并且能够更实时地进行通讯。</p> <p><img src="https://www.runoob.com/wp-content/uploads/2016/03/ws.png" alt="img"></p> <p>浏览器通过 JavaScript 向服务器发出建立 WebSocket 连接的请求，连接建立以后，客户端和服务器端就可以通过 TCP 连接直接交换数据。</p> <p>当你获取 Web Socket 连接后，你可以通过 <strong>send()</strong> 方法来向服务器发送数据，并通过 <strong>onmessage</strong> 事件来接收服务器返回的数据。</p> <p>以下 API 用于创建 WebSocket 对象。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> Socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">WebSocket</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">protocol</span></span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>以上代码中的第一个参数 url, 指定连接的 URL。第二个参数 protocol 是可选的，指定了可接受的子协议。</p> <hr> <p><strong>WebSocket 属性</strong></p> <p>以下是 WebSocket 对象的属性。假定我们使用了以上代码创建了 Socket 对象：</p> <table><thead><tr><th style="text-align:left;">属性</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;">Socket.readyState</td> <td style="text-align:left;">只读属性 <strong>readyState</strong> 表示连接状态，可以是以下值：0 - 表示连接尚未建立。1 - 表示连接已建立，可以进行通信。2 - 表示连接正在进行关闭。3 - 表示连接已经关闭或者连接不能打开。</td></tr> <tr><td style="text-align:left;">Socket.bufferedAmount</td> <td style="text-align:left;">只读属性 <strong>bufferedAmount</strong> 已被 send() 放入正在队列中等待传输，但是还没有发出的 UTF-8 文本字节数。</td></tr></tbody></table> <hr> <p><strong>WebSocket 事件</strong></p> <p>以下是 WebSocket 对象的相关事件。假定我们使用了以上代码创建了 Socket 对象：</p> <table><thead><tr><th style="text-align:left;">事件</th> <th style="text-align:left;">事件处理程序</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;">message</td> <td style="text-align:left;">Socket.onmessage</td> <td style="text-align:left;">客户端接收服务端数据时触发</td></tr> <tr><td style="text-align:left;">error</td> <td style="text-align:left;">Socket.onerror</td> <td style="text-align:left;">通信发生错误时触发</td></tr> <tr><td style="text-align:left;">open</td> <td style="text-align:left;">Socket.onopen</td> <td style="text-align:left;">连接建立时触发</td></tr> <tr><td style="text-align:left;">close</td> <td style="text-align:left;">Socket.onclose</td> <td style="text-align:left;">连接关闭时触发</td></tr></tbody></table> <hr> <p><strong>WebSocket 方法</strong></p> <p>以下是 WebSocket 对象的相关方法。假定我们使用了以上代码创建了 Socket 对象：</p> <table><thead><tr><th style="text-align:left;">方法</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;">Socket.send()</td> <td style="text-align:left;">使用连接发送数据</td></tr> <tr><td style="text-align:left;">Socket.close()</td> <td style="text-align:left;">关闭连接</td></tr></tbody></table> <p><strong>ASP.NET下的socket实现</strong></p> <p>发送推送消息</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">ArraySegment<span class="token punctuation">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">&gt;</span></span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArraySegment<span class="token punctuation">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">byte</span></span><span class="token punctuation">[</span><span class="token number">2048</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArraySegment<span class="token punctuation">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//登录提醒（包括自己）</span>
<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> socket <span class="token keyword">in</span> _UserDictionary<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>d <span class="token operator">=&gt;</span> d<span class="token punctuation">.</span>Value<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">await</span> socket<span class="token punctuation">.</span><span class="token function">SendAsync</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> WebSocketMessageType<span class="token punctuation">.</span>Text<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> cancellationToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>服务端接收指令</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">ArraySegment<span class="token punctuation">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">&gt;</span></span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArraySegment<span class="token punctuation">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">byte</span></span><span class="token punctuation">[</span><span class="token number">2048</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//接受指令</span>
<span class="token class-name">WebSocketReceiveResult</span> result <span class="token operator">=</span> <span class="token keyword">await</span> socket<span class="token punctuation">.</span><span class="token function">ReceiveAsync</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> cancellationToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//表示是关闭指令</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>MessageType <span class="token operator">==</span> WebSocketMessageType<span class="token punctuation">.</span>Close<span class="token punctuation">)</span>
<span class="token punctuation">{</span>	<span class="token comment">//断开指令</span>
    <span class="token keyword">await</span> socket<span class="token punctuation">.</span><span class="token function">CloseAsync</span><span class="token punctuation">(</span>WebSocketCloseStatus<span class="token punctuation">.</span>NormalClosure<span class="token punctuation">,</span> String<span class="token punctuation">.</span>Empty<span class="token punctuation">,</span> cancellationToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span>
<span class="token punctuation">{</span>
    <span class="token comment">//获取客户端发送内容</span>
    <span class="token class-name"><span class="token keyword">string</span></span> userMsg <span class="token operator">=</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span>Array<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>Count<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id=""><a href="#" class="header-anchor">#</a></h2> <h2 id="singalr"><a href="#singalr" class="header-anchor">#</a> SingalR</h2> <p>https://docs.microsoft.com/zh-cn/aspnet/signalr/</p> <p>ASP .NET SignalR是一个ASP .NET 下的类库，可以在ASP .NET 的Web项目中实现实时通信.</p> <p><img src="https://images0.cnblogs.com/blog/15172/201412/061436271702087.png" alt="image"></p> <p>Asp.net SignalR 2 实现 服务端消息推送到Web端, 更加简单. 为了获取更好的可伸缩性, 我们引入消息队列, 看如下基本流程图:</p> <p><a href="https://images0.cnblogs.com/blog/15172/201412/061436278897701.png" target="_blank" rel="noopener noreferrer"><img src="https://images0.cnblogs.com/blog/15172/201412/061436285762559.png" alt="image"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <blockquote><p>使用</p></blockquote> <p><strong>步骤一：安装包</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code>Install-Package Microsoft.AspNet.SignalR
</code></pre></div><p><strong>步骤二：更新jquery</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code>UPDATE-Package Microsoft.AspNet.SignalR <span class="token parameter variable">-Version</span> <span class="token number">2.4</span>.0
UPDATE-Package jQuery <span class="token parameter variable">-Version</span> <span class="token number">1.8</span>.2
</code></pre></div><p><strong>步骤三：创建一个集线器</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>AspNet<span class="token punctuation">.</span>SignalR</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>AspNet<span class="token punctuation">.</span>SignalR<span class="token punctuation">.</span>Hubs</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Linq</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Web</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">Singalr<span class="token punctuation">.</span>Hubs</span>
<span class="token punctuation">{</span>
    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// 自定义SignalR集线器代理类名称</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token punctuation">[</span><span class="token function">HubName</span><span class="token punctuation">(</span><span class="token string">&quot;myChatHub&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyChatHub</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Hub</span></span>
    <span class="token punctuation">{</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 推送至所有客户端</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;message&quot;&gt;消息&lt;/param&gt;</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Send</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> message<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">//调用所有客户端的SendMessage方法</span>
            Clients<span class="token punctuation">.</span>All<span class="token punctuation">.</span><span class="token function">SendMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>步骤四：前端代码</strong></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/1999/xhtml<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span> <span class="token attr-name">runat</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>server<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Content-Type<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/html; charset=utf-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>SignalR实时消息推送到客户端<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Scripts/jquery-1.8.2.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--引用SignalR库--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Scripts/jquery.signalR-2.1.2.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--引用自动生成的SignalR集线器(Hub)脚本.在运行的时候在浏览器的Source下可看到--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/signalr/hubs<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//引用服务端的集线器代理类       </span>
            <span class="token keyword">var</span> chat <span class="token operator">=</span> $<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>myChatHub<span class="token punctuation">;</span>
            <span class="token comment">//定义服务器端调用的客户端SendMessage方法来显示新消息</span>
            chat<span class="token punctuation">.</span>client<span class="token punctuation">.</span><span class="token function-variable function">SendMessage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                
                <span class="token function">ShowMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>

            <span class="token comment">//设置焦点到输入框</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#message'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//开始连接服务器</span>
            $<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>hub<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#SendMessage'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">//调用服务器端定义的Send方法</span>
                    chat<span class="token punctuation">.</span>server<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#message'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//清空输入框信息并获取焦点</span>
                    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#message'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//向页面添加消息</span>
        <span class="token keyword">function</span> <span class="token function">ShowMessage</span><span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                 
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#list'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'&lt;li&gt;'</span> <span class="token operator">+</span> message <span class="token operator">+</span> <span class="token string">'&lt;/li&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>      
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">runat</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>server<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>message<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>SendMessage<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>发送<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>步骤五：添加启动类StartUp</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Owin</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Owin</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Linq</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Web</span><span class="token punctuation">;</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token target keyword">assembly</span><span class="token punctuation">:</span> <span class="token class-name">OwinStartup</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">Singalr<span class="token punctuation">.</span>App_Start<span class="token punctuation">.</span>Startup</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">namespace</span> <span class="token namespace">Singalr<span class="token punctuation">.</span>App_Start</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Startup</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configuration</span><span class="token punctuation">(</span><span class="token class-name">IAppBuilder</span> app<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// Any connection or hub wire up and configuration should go here</span>
            app<span class="token punctuation">.</span><span class="token function">MapSignalR</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>每一个使用的OWin组件的Web框架都需要一个StartUp入口类，用来声明OWin组件：</p> <ol><li>项目会自动扫描程序集根下的名为StartUp的类作为入口类</li> <li>通过添加 [assembly: OwinStartup(typeof(SignalRDEMO.Startup))] 标签标记入口类</li></ol> <p><strong>常用的推送方式</strong></p> <p>以下列出其他推送方式：</p> <ul><li><p>所有连接的客户端　　
Clients.All.show(content);</p></li> <li><p>仅调用的客户端
Clients.Caller.show(content);</p></li> <li><p>除调用客户端之外的所有客户端
Clients.Others.show(content);</p></li> <li><p>特定的客户端标识的连接 id
Clients.Client(Context.ConnectionId).show(content);</p></li> <li><p>所有连接的客户端除外指定客户端，由连接 ID 标识
Clients.AllExcept(connectionId1, connectionId2).show(content);</p></li> <li><p>指定组中的所有连接的客户端
Clients.Group(groupName).show(content);</p></li> <li><p>指定组中的所有连接的客户端除外指定客户端，由连接 ID 标识。
Clients.Group(groupName, connectionId1, connectionId2).show(content);</p></li> <li><p>所有连接的客户端指定组中除调用客户端
Clients.OthersInGroup(groupName).show(content);</p></li> <li><p>所有客户端和组列表中的连接 Id
Clients.Clients(ConnectionIds).show(content);</p></li> <li><p>组的列表。
Clients.Groups(GroupIds).show(content);</p></li> <li><p>按名称的用户
Clients.Client(username).show(content); //这里的username我还没理解是怎么创建的</p></li> <li><p>（在 SignalR 2.1 中引入） 的用户名称的列表。
Clients.Users(new string[] { &quot;myUser&quot;, &quot;myUser2&quot; }).show(content)</p></li></ul> <p><strong>关于ConnectionId</strong></p> <p>每个连接的页面都会产生不同的连接id，并且这个连接id是随机产生，不能自定义的</p> <p>集线器中为我们提供了Context对象可以获取到这个连接id</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">/// &lt;summary&gt;</span>
<span class="token comment">/// 返回每个连接的id</span>
<span class="token comment">/// &lt;/summary&gt;</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ReturnConnectionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Clients<span class="token punctuation">.</span>Caller<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span>Context<span class="token punctuation">.</span>ConnectionId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>服务端自身调用Hub进行广播推送</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">IHubContext</span> chat <span class="token operator">=</span> GlobalHost<span class="token punctuation">.</span>ConnectionManager<span class="token punctuation">.</span><span class="token function">GetHubContext</span><span class="token punctuation">(</span><span class="token string">&quot;myChatHub&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="sqldependency-signalr实现数据即时更新"><a href="#sqldependency-signalr实现数据即时更新" class="header-anchor">#</a> SqlDependency+SignalR实现数据即时更新</h2> <p>应用：数据实时性较高的场景、新闻、监控数据等。</p> <blockquote><p>使用</p></blockquote> <p><strong>步骤一：sqlserver数据库启用监听服务，以便支持SqlDependency特性。</strong></p> <div class="language-mssql extra-class"><pre class="language-text"><code>--查询是否开启服务  0未开启 1开启
SELECT is_broker_enabled FROM sys.databases WHERE name = '数据库名'

--为某一数据库开启服务
ALTER DATABASE 数据库名 SET NEW_BROKER WITH ROLLBACK IMMEDIATE;
ALTER DATABASE 数据库名 SET ENABLE_BROKER;
</code></pre></div><p><strong>步骤二：配置Signalr</strong></p> <p>App_Start中注册管道，将signalr注册到全局运行对象中</p> <p>创建集线器hub</p> <p><strong>步骤三：监听SQLDependency</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>ChatUser<span class="token punctuation">&gt;</span></span> <span class="token function">GetData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> sqlconnection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlConnection</span><span class="token punctuation">(</span>ConfigurationManager<span class="token punctuation">.</span>ConnectionStrings<span class="token punctuation">[</span><span class="token string">&quot;connString&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ConnectionString<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>

        sqlconnection<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">SqlCommand</span> cmd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlCommand</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT * FROM dbo.Chat_User&quot;</span><span class="token punctuation">,</span> sqlconnection<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            cmd<span class="token punctuation">.</span>Notification <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token class-name">SqlDependency</span> dependency <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlDependency</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span><span class="token punctuation">;</span>
            dependency<span class="token punctuation">.</span>OnChange <span class="token operator">+=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OnChangeEventHandler</span><span class="token punctuation">(</span>dependency_Onchange<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>sqlconnection<span class="token punctuation">.</span>State <span class="token operator">==</span> ConnectionState<span class="token punctuation">.</span>Closed<span class="token punctuation">)</span>
                sqlconnection<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">SqlDataReader</span> reader <span class="token operator">=</span> cmd<span class="token punctuation">.</span><span class="token function">ExecuteReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">List<span class="token punctuation">&lt;</span>ChatUser<span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>ChatUser<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>reader<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token class-name">ChatUser</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ChatUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                m<span class="token punctuation">.</span>id <span class="token operator">=</span> Convert<span class="token punctuation">.</span><span class="token function">ToInt32</span><span class="token punctuation">(</span>reader<span class="token punctuation">[</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                m<span class="token punctuation">.</span>account <span class="token operator">=</span> Convert<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span>reader<span class="token punctuation">[</span><span class="token string">&quot;account&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                m<span class="token punctuation">.</span>img_url <span class="token operator">=</span> Convert<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span>reader<span class="token punctuation">[</span><span class="token string">&quot;img_url&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                list<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> list<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">dependency_Onchange</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">SqlNotificationEventArgs</span> e<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>Type <span class="token operator">==</span> SqlNotificationType<span class="token punctuation">.</span>Change<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">IHubContext</span> context <span class="token operator">=</span> GlobalHost<span class="token punctuation">.</span>ConnectionManager<span class="token punctuation">.</span><span class="token function">GetHubContext</span><span class="token punctuation">(</span><span class="token string">&quot;chatUserHub&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span>Clients<span class="token punctuation">.</span>All<span class="token punctuation">.</span><span class="token function">SendData</span><span class="token punctuation">(</span><span class="token function">GetData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p><strong>步骤四：在global中注册SQLDependency启动项</strong></p> <p><code>Global.asax.cs</code></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MvcApplication</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">System<span class="token punctuation">.</span>Web<span class="token punctuation">.</span>HttpApplication</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Application_Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        AreaRegistration<span class="token punctuation">.</span><span class="token function">RegisterAllAreas</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        RouteConfig<span class="token punctuation">.</span><span class="token function">RegisterRoutes</span><span class="token punctuation">(</span>RouteTable<span class="token punctuation">.</span>Routes<span class="token punctuation">)</span><span class="token punctuation">;</span>
        SqlDependency<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span>ConfigurationManager<span class="token punctuation">.</span>ConnectionStrings<span class="token punctuation">[</span><span class="token string">&quot;connString&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ConnectionString<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Application_End</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//当被监测的数据库中的数据发生变化时,SqlDependency会自动触发OnChange事件来通知应用程序,从而达到让系统自动更新数据(或缓存)的目的。</span>
        SqlDependency<span class="token punctuation">.</span><span class="token function">Stop</span><span class="token punctuation">(</span>ConfigurationManager<span class="token punctuation">.</span>ConnectionStrings<span class="token punctuation">[</span><span class="token string">&quot;connString&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ConnectionString<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>步骤五：前台调用加载</strong></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Index<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>~/Scripts/jquery-1.8.2.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>~/Scripts/jquery.signalR-2.4.3.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/signalr/hubs<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> chat <span class="token operator">=</span> $<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>chatUserHub<span class="token punctuation">;</span>
            <span class="token comment">//定义客户端的javascript</span>
            chat<span class="token punctuation">.</span>client<span class="token punctuation">.</span><span class="token function-variable function">sendData</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">userList</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>userList<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            $<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>hub<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                chat<span class="token punctuation">.</span>server<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><em><em>注意：监听SQLDependency时，监视的字段必须一一指定，不能写</em>，也不能用group by</em>*</p> <h2 id="jwt-json-web-token"><a href="#jwt-json-web-token" class="header-anchor">#</a> JWT(Json Web Token)</h2> <p>是一种用于双方之间传递安全信息的简洁的、URL安全的表述性声明规范。JWT作为一个开放的标准（ RFC 7519 ），定义了一种简洁的，自包含的方法用于通信双方之间以Json对象的形式安全的传递信息。因为数字签名的存在，这些信息是可信的，JWT可以使用HMAC算法或者是RSA的公私秘钥对进行签名。</p> <h3 id="jwt的结构"><a href="#jwt的结构" class="header-anchor">#</a> <strong>JWT的结构</strong></h3> <p>JWT一般由三段构成，用.号分隔开，第一段是header，第二段是payload，第三段是signature，例如：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9<span class="token punctuation">.</span>eyJuYW1lIjoiTXJCdWciLCJleHAiOjE1MTI5NTkzMDMuMCwianRpIjoibHVvemhpcGVuZyJ9<span class="token punctuation">.</span>9iwGMHmS0mophyFgliLK15hs_eE770IchaZ<span class="token operator">-</span>bWcX5c0
</code></pre></div><p><strong>1.header</strong></p> <p>jwt的头部承载两部分信息：</p> <p>声明类型。这里是JWT。</p> <p>声明加密的算法。通常直接使用 HMAC SHA256，其它还有RS256等。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span><span class="token property">&quot;alg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;HS256&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;typ&quot;</span><span class="token operator">:</span> <span class="token string">&quot;JWT&quot;</span><span class="token punctuation">}</span>
</code></pre></div><p>然后将头部进行base64加密（该加密是可以对称解密的),构成了第一部分</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9
</code></pre></div><p><strong>2.payload</strong></p> <p>载荷就是存放有效信息的地方。这些有效信息包含三个部分：<strong>标准中注册的声明</strong>、公共的声明、私有的声明</p> <p><strong>标准中注册的声明 (建议但不强制使用) ：</strong></p> <p>iss ： jwt签发者</p> <p>sub：jwt所面向的用户</p> <p>aud：接收jwt的一方</p> <p>exp：jwt的过期时间，这个过期时间必须要大于签发时间</p> <p>nbf：定义在什么时间之前，该jwt都是不可用的.</p> <p>iat ：jwt的签发时间</p> <p>jti ：jwt的唯一身份标识，主要用来作为一次性token,从而回避重放攻击。</p> <p><strong>公共的声明 ：</strong></p> <p>公共的声明可以添加任何的信息，一般添加用户的相关信息或其他业务需要的必要信息.但不建议添加敏感信息，因为该部分在客户端可解密。</p> <p><strong>私有的声明 ：</strong></p> <p>私有声明是提供者和消费者所共同定义的声明，一般不建议存放敏感信息，因为base64是对称解密的，意味着该部分信息可以归类为明文信息。</p> <p>定义一个playload</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span> <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;MrBug&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;exp&quot;</span><span class="token operator">:</span> <span class="token number">1512959303</span><span class="token punctuation">,</span> <span class="token property">&quot;jti&quot;</span><span class="token operator">:</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">}</span>
</code></pre></div><p>然后将其进行base64加密，得到Jwt的第二部分</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>eyJuYW1lIjoiTXJCdWciLCJleHAiOjE1MTI5NTkzMDMuMCwianRpIjoibHVvemhpcGVuZyJ9
</code></pre></div><p><strong>3.signature</strong></p> <p>jwt的第三部分是一个签证信息，这个签证信息由三部分组成：header (base64后的)、payload (base64后的)、<strong>secret</strong></p> <p>这个部分需要base64加密后的header和base64加密后的payload使用.连接组成的字符串，然后通过header中声明的加密方式进行加secret组合加密，然后就构成了jwt的第三部分。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>9iwGMHmS0mophyFgliLK15hs_eE770IchaZ<span class="token operator">-</span>bWcX5c0
</code></pre></div><p>注意：secret是保存在服务器端的，jwt的签发生成也是在服务器端的，secret就是用来进行jwt的签发和jwt的验证，所以，它就是你服务端的私钥，在任何场景都不应该流露出去。一旦客户端得知这个secret, 那就意味着客户端是可以自我签发jwt了。</p> <h3 id="使用"><a href="#使用" class="header-anchor">#</a> 使用</h3> <p><strong>安装JWT包、JWTBearer包</strong></p> <blockquote><p>方式一：声明一个帮助类来完成token的生成和验证</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TokenHelper</span>
<span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">string</span></span> secretKey <span class="token operator">=</span> <span class="token string">&quot;AnDeLiYa&quot;</span><span class="token punctuation">;</span><span class="token comment">//口令加密秘钥</span>
    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// token加密</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token comment">/// &lt;param name=&quot;userName&quot;&gt;&lt;/param&gt;</span>
    <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">GenerateToken</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> userName<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> tokenHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JwtSecurityTokenHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 扩展密钥大小为 128 位（32 字节）</span>
        <span class="token class-name"><span class="token keyword">var</span></span> key <span class="token operator">=</span> Encoding<span class="token punctuation">.</span>ASCII<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span>secretKey<span class="token punctuation">.</span><span class="token function">PadRight</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token char">'\0'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token class-name"><span class="token keyword">var</span></span> tokenDescriptor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SecurityTokenDescriptor</span>
        <span class="token punctuation">{</span>
            Subject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ClaimsIdentity</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token punctuation">{</span>
            	<span class="token keyword">new</span> <span class="token constructor-invocation class-name">Claim</span><span class="token punctuation">(</span><span class="token string">&quot;customClaim&quot;</span><span class="token punctuation">,</span> userName<span class="token punctuation">)</span>  <span class="token comment">// 设置其他声明</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            Expires <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>UtcNow<span class="token punctuation">.</span><span class="token function">AddHours</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// 设置过期时间为当前时间 + 1 小时</span>
            SigningCredentials <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SigningCredentials</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">SymmetricSecurityKey</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span> SecurityAlgorithms<span class="token punctuation">.</span>HmacSha256Signature<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token class-name"><span class="token keyword">var</span></span> token <span class="token operator">=</span> tokenHandler<span class="token punctuation">.</span><span class="token function">CreateToken</span><span class="token punctuation">(</span>tokenDescriptor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">var</span></span> tokenString <span class="token operator">=</span> tokenHandler<span class="token punctuation">.</span><span class="token function">WriteToken</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> tokenString<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// 解密</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token comment">/// &lt;param name=&quot;token&quot;&gt;&lt;/param&gt;</span>
    <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">ValidateToken</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> token<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> tokenHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JwtSecurityTokenHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 扩展密钥大小为 128 位（32 字节）</span>
        <span class="token class-name"><span class="token keyword">var</span></span> key <span class="token operator">=</span> Encoding<span class="token punctuation">.</span>ASCII<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span>secretKey<span class="token punctuation">.</span><span class="token function">PadRight</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token char">'\0'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  

        <span class="token keyword">try</span>
        <span class="token punctuation">{</span>
            tokenHandler<span class="token punctuation">.</span><span class="token function">ValidateToken</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TokenValidationParameters</span>
            <span class="token punctuation">{</span>
                IssuerSigningKey <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SymmetricSecurityKey</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span>
                ValidateIssuerSigningKey <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                ValidateIssuer <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                ValidateAudience <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                ClockSkew <span class="token operator">=</span> TimeSpan<span class="token punctuation">.</span>Zero
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">out</span> <span class="token class-name"><span class="token keyword">var</span></span> validatedToken<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//获取token</span>
TokenHelper<span class="token punctuation">.</span><span class="token function">GenerateToken</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//验证token</span>
TokenHelper<span class="token punctuation">.</span><span class="token function">ValidateToken</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>方式二：使用ASP.NET Core服务注册</p></blockquote> <p><strong>步骤一：创建配置类将SecurityKey和Domain常量进行存储或者放到配置文件中</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JWTConst</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">string</span></span> SecurityKey <span class="token operator">=</span> <span class="token string">&quot;MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDSfLGu+kcFDcJUCV46J+SbgR0lNc2NqgCGzojQTWW9xqjuzPF3mpisvTggYZSGfBzN+88YLZYbBLrDTUMJ4nTieElbP6SHkBFu8F+7fFBi7w3UPsaAXDr2E2srQYU5ZlKAcFBoNajNWj3sfSVRoYRPdqDTj4WdJlUPSNGz0wgRrQIDAQAB&quot;</span><span class="token punctuation">;</span>
 	<span class="token comment">//定义范围、域</span>
    <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">string</span></span> Domain <span class="token operator">=</span> <span class="token string">&quot;http://localhost:5000&quot;</span><span class="token punctuation">;</span>
 
<span class="token punctuation">}</span>
</code></pre></div><p><strong>步骤二：在startup.cs中添加服务</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//配置jwt服务</span>
services<span class="token punctuation">.</span><span class="token function">AddAuthentication</span><span class="token punctuation">(</span>JwtBearerDefaults<span class="token punctuation">.</span>AuthenticationScheme<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">AddJwtBearer</span><span class="token punctuation">(</span>options <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        options<span class="token punctuation">.</span>TokenValidationParameters <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TokenValidationParameters</span>
        <span class="token punctuation">{</span>
            ValidateIssuer <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//是否验证Issuer</span>
            ValidateAudience <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//是否验证Audience</span>
            ValidateLifetime <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//是否验证失效时间</span>
            ClockSkew <span class="token operator">=</span> TimeSpan<span class="token punctuation">.</span><span class="token function">FromSeconds</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            ValidateIssuerSigningKey <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//是否验证SecurityKey</span>
            ValidAudience <span class="token operator">=</span> JWTConst<span class="token punctuation">.</span>Domain<span class="token punctuation">,</span><span class="token comment">//Audience</span>
            ValidIssuer <span class="token operator">=</span> JWTConst<span class="token punctuation">.</span>Domain<span class="token punctuation">,</span><span class="token comment">//Issuer，这两项和前面签发jwt的设置一致</span>
            IssuerSigningKey <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SymmetricSecurityKey</span><span class="token punctuation">(</span>Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span>JWTConst<span class="token punctuation">.</span>SecurityKey<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//拿到SecurityKey</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//JWT全局验权配置(每一个接口都需要验权)</span>
builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddRazorPages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">AddMvcOptions</span><span class="token punctuation">(</span>option <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    option<span class="token punctuation">.</span>Filters<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AuthorizeFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>步骤三：添加验证中间件</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>app<span class="token punctuation">.</span><span class="token function">UseAuthentication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>步骤四：获取token接口</strong></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AllowAnonymous</span></span><span class="token punctuation">]</span><span class="token comment">//指定此属性应用于的类或方法不需要授权验证。</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpGet</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">Get</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> userName<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> pwd<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span>userName<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span>pwd<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> claims <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Claim</span><span class="token punctuation">(</span>JwtRegisteredClaimNames<span class="token punctuation">.</span>Nbf<span class="token punctuation">,</span><span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token keyword">new</span> <span class="token constructor-invocation class-name">DateTimeOffset</span><span class="token punctuation">(</span>DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToUnixTimeSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Claim</span> <span class="token punctuation">(</span>JwtRegisteredClaimNames<span class="token punctuation">.</span>Exp<span class="token punctuation">,</span><span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token keyword">new</span> <span class="token constructor-invocation class-name">DateTimeOffset</span><span class="token punctuation">(</span>DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">.</span><span class="token function">AddMinutes</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToUnixTimeSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Claim</span><span class="token punctuation">(</span>ClaimTypes<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> userName<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">var</span></span> key <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SymmetricSecurityKey</span><span class="token punctuation">(</span>Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span>JWTConst<span class="token punctuation">.</span>SecurityKey<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">var</span></span> creds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SigningCredentials</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> SecurityAlgorithms<span class="token punctuation">.</span>HmacSha256<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">var</span></span> token <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JwtSecurityToken</span><span class="token punctuation">(</span>
            <span class="token named-parameter punctuation">issuer</span><span class="token punctuation">:</span> JWTConst<span class="token punctuation">.</span>Domain<span class="token punctuation">,</span>
            <span class="token named-parameter punctuation">audience</span><span class="token punctuation">:</span> JWTConst<span class="token punctuation">.</span>Domain<span class="token punctuation">,</span>
            <span class="token named-parameter punctuation">claims</span><span class="token punctuation">:</span> claims<span class="token punctuation">,</span>
            <span class="token named-parameter punctuation">expires</span><span class="token punctuation">:</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">.</span><span class="token function">AddMinutes</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token named-parameter punctuation">signingCredentials</span><span class="token punctuation">:</span> creds<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token function">Ok</span><span class="token punctuation">(</span><span class="token keyword">new</span>
        <span class="token punctuation">{</span>
        	token <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JwtSecurityTokenHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">WriteToken</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">BadRequest</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token punctuation">{</span> message <span class="token operator">=</span> <span class="token string">&quot;username or password is incorrect.&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>tips：[Authorize]标签表示需要验权，[AllowAnonymous]标签表示不需要授权验证。如果配置了全局验权则不需要使用[Authorize]标签，只需在不需要验权的地方加上[AllowAnonymous]标签</strong></p> <p><strong>用postman测试的时候在授权里面选择Bearer Token进行令牌填写</strong></p> <h1 id="设计模式-六大原则"><a href="#设计模式-六大原则" class="header-anchor">#</a> 设计模式——六大原则</h1> <h2 id="单一职责-single-responsibility-principle"><a href="#单一职责-single-responsibility-principle" class="header-anchor">#</a> <strong>单一职责（Single Responsibility Principle）</strong></h2> <blockquote><p>一个类只负责一个功能领域中的相应职责</p></blockquote> <p><strong>优点：</strong></p> <ul><li>可以降低类的复杂度；</li> <li>提高类的可读性；</li> <li>提高系统的可维护性；</li> <li>变更引起的风险降低。</li></ul> <h2 id="开闭原则-open-closed-principle"><a href="#开闭原则-open-closed-principle" class="header-anchor">#</a> <strong>开闭原则（open closed principle）</strong></h2> <blockquote><p>一个软件实体应当对扩展开放，对修改关闭。即软件实体应尽量在不修改原有代码的情况下进行扩展。</p></blockquote> <p>优点：</p> <ul><li>降低耦合性；</li> <li>提高复用性；</li> <li>提高可扩展性；</li> <li>减少代码冗余；</li> <li>提高可读性；</li> <li>提高可维护性；</li> <li>降低风险。</li></ul> <h2 id="里氏替换"><a href="#里氏替换" class="header-anchor">#</a> 里氏替换</h2> <blockquote><p><strong>子类可以扩展父类的功能，但不能改变父类原有的功能。</strong> （子类可以继承父类，但是不能覆盖父类的非抽象方法）</p> <p>里氏代换原则是<a href="https://so.csdn.net/so/search?q=%E5%BC%80%E9%97%AD%E5%8E%9F%E5%88%99&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">开闭原则<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的重要方式之一，由于使用父类对象的地方都可以使用子类对象，因此在程序中尽量使用父类类型来对对象进行定义，而在运行时再确定其子类类型，用子类对象来替换父类对象。</p></blockquote> <p><strong>总结</strong></p> <p>不要覆盖父类中的方法，如果要改写，则在父类中编写虚方法（virtual），子类重写虚方法（override）。或者在父类中定义抽象方法（abstract），子类进行实现（override）</p> <p><strong>里氏替换原则的优点</strong></p> <ol><li>代码共享，减少创建类的工作量，每个子类都拥有父类的方法和属性；</li> <li>提高代码的重用性；</li> <li>子类可以形似父类，但又异于父类。</li> <li>提高代码的可扩展性。</li> <li>提高产品或项目的开放性。</li></ol> <p><strong>里氏替换原则的缺点</strong></p> <ol><li>继承是侵入性的。只要继承，就必须拥有父类的所有属性和方法；</li> <li>降低代码的灵活性。子类必须拥有父类的属性和方法。</li> <li>增强了耦合性。当父类的常量、变量和方法被修改时，需要考虑子类的修改，可能导致大段的代码需要重构。</li></ol> <h2 id="迪米特法则"><a href="#迪米特法则" class="header-anchor">#</a> 迪米特法则</h2> <p><strong>迪米特法则</strong>又叫做最少知道原则，就是说一个对象应当对其它对象有尽可能少的了解，不要和陌生人说话。</p> <p>一个类对自己需要耦合或调用的类知道得最少，你（调用的类的）的内部是多么复杂都和我没有关系，那是你的事情，我只关心你提供的public方法，你提供我就调用，其他一概不关心。</p> <p>强调只和朋友说话，不和陌生人说话。这里的朋友指的是:出现在成员中<strong>变量</strong>，<strong>方法输入</strong>，<strong>输出参数</strong>中的类称为成员朋友类，而出现在方法体内部的类不属于朋友类。</p> <p>从迪米特法则的定义和特点可知，它强调以下两点：</p> <ol><li><p>从依赖者的角度来说，只依赖应该依赖的对象。</p></li> <li><p>从被依赖者的角度说，只暴露应该暴露的方法。</p></li></ol> <p><strong>示例：订披萨</strong></p> <p>违反示例</p> <p><code>PizzaStore.cs</code></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PizzaStore</span> <span class="token punctuation">{</span>
 
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">takeOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span><span class="token keyword">out</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;披萨店接收订单&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">prepareSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span><span class="token keyword">out</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;披萨店准备披萨制作原料&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">cookPizza</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span><span class="token keyword">out</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;披萨店烹制披萨&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">packPizza</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span><span class="token keyword">out</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;披萨店打包披萨&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">deliveryPizza</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span><span class="token keyword">out</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;披萨店配送披萨&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>Customer.cs</code></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Customer</span> <span class="token punctuation">{</span>
 
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">orderPizza</span><span class="token punctuation">(</span><span class="token class-name">PizzaStore</span> pizzaStore<span class="token punctuation">)</span><span class="token punctuation">{</span>
        pizzaStore<span class="token punctuation">.</span><span class="token function">takeOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pizzaStore<span class="token punctuation">.</span><span class="token function">prepareSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pizzaStore<span class="token punctuation">.</span><span class="token function">cookPizza</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pizzaStore<span class="token punctuation">.</span><span class="token function">packPizza</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pizzaStore<span class="token punctuation">.</span><span class="token function">deliveryPizza</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>main</code></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String<span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">Customer</span> xiaoming <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Customer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">PizzaStore</span> pizzaStore <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">PizzaStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xiaoming<span class="token punctuation">.</span><span class="token function">orderPizza</span><span class="token punctuation">(</span>pizzaStore<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>改正示例</p> <p><code>PizzaStore.cs</code></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PizzaStore</span> <span class="token punctuation">{</span>
 
    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">takeOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span><span class="token keyword">out</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;披萨店接收订单&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">prepareSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span><span class="token keyword">out</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;披萨店准备披萨制作原料&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">cookPizza</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span><span class="token keyword">out</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;披萨店烹制披萨&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">packPizza</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span><span class="token keyword">out</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;披萨店打包披萨&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">deliveryPizza</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span><span class="token keyword">out</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;披萨店配送披萨&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">orderPizza</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">takeOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">prepareSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">cookPizza</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">packPizza</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">deliveryPizza</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>Customer.cs</code></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Customer</span> <span class="token punctuation">{</span>
 
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">orderPizza</span><span class="token punctuation">(</span><span class="token class-name">PizzaStore</span> pizzaStore<span class="token punctuation">)</span><span class="token punctuation">{</span>
        pizzaStore<span class="token punctuation">.</span><span class="token function">orderPizza</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>main</code></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String<span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">Customer</span> xiaoming <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Customer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">PizzaStore</span> pizzaStore <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">PizzaStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xiaoming<span class="token punctuation">.</span><span class="token function">orderPizza</span><span class="token punctuation">(</span>pizzaStore<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这样改之后，客户和披萨店之间的沟通只有orderPizza()方法了，其他的方法客户根本访问不了，因为其他方法都是private属性。这样极大的减少了二者之间的沟通，这就是迪米特法则所要求的<strong>尽量减少两个实体之间的交互</strong>。</p> <h2 id="接口隔离"><a href="#接口隔离" class="header-anchor">#</a> 接口隔离</h2> <p><strong>原则定义</strong></p> <p>接口隔离原则要求程序员尽量将臃肿庞大的接口拆分成更小的和更具体的接口，让接口中只包含客户感兴趣的方法。</p> <p>客户端不应该被迫依赖于它不使用的方法。该原则还有另外一个定义：一个类对另一个类的依赖应该建立在最小的接口上。</p> <p>要为各个类建立它们需要的专用接口，而不要试图去建立一个很庞大的接口供所有依赖它的类去调用。</p> <p><strong>实现原理</strong></p> <p>在具体应用接口隔离原则时，应该根据以下几个规则来衡量。</p> <ol><li>接口尽量小，但是要有限度。一个接口只服务于一个子模块或业务逻辑。</li> <li>为依赖接口的类定制服务。只提供调用者需要的方法，屏蔽不需要的方法。</li> <li>了解环境，拒绝盲从。每个项目或产品都有选定的环境因素，环境不同，接口拆分的标准就不同深入了解业务逻辑。</li> <li>提高内聚，减少对外交互。使接口用最少的方法去完成最多的事情。</li></ol> <h2 id="依赖倒置dependence-inversion-principle"><a href="#依赖倒置dependence-inversion-principle" class="header-anchor">#</a> 依赖倒置Dependence Inversion Principle</h2> <p><strong>原则定义</strong></p> <ul><li><p>高层模块不应该依赖低层模块，两者都应该依赖其抽象</p> <p>​                                         UI层不可以实例化Service</p></li> <li><p>抽象不应该依赖细节      接口不能继承类</p></li> <li><p>细节应该依赖抽象          类要继承接口</p></li></ul> <p>例子：司机开车</p> <p><code>ICar.cs</code></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">internal</span> <span class="token keyword">interface</span> <span class="token class-name">ICar</span>
<span class="token punctuation">{</span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>IDriver.cs</code></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">internal</span> <span class="token keyword">interface</span> <span class="token class-name">IDriver</span>
<span class="token punctuation">{</span>
    <span class="token comment">//司机开车抽象方法</span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">driver</span><span class="token punctuation">(</span><span class="token class-name">ICar</span> car<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>Benz.cs</code></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">internal</span> <span class="token keyword">class</span> <span class="token class-name">Benz</span><span class="token punctuation">:</span><span class="token type-list"><span class="token class-name">ICar</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;奔驰车开动&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>BMW.cs</code></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//细节依赖于抽象</span>
<span class="token keyword">internal</span> <span class="token keyword">class</span> <span class="token class-name">BMW</span><span class="token punctuation">:</span><span class="token type-list"><span class="token class-name">ICar</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;宝马车开动&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>main</code></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">//准备一个奔驰车</span>
<span class="token class-name">Benz</span> a100 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Benz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">BMW</span> x1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">BMW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//通过接口创建一个类对象</span>
<span class="token class-name">IDriver</span> xiaowang <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Driver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xiaowang<span class="token punctuation">.</span><span class="token function">driver</span><span class="token punctuation">(</span>a100<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在新增低层模块时，只修改了高层模块(业务场景类)，对其他低层模块(Driver类)不需要做任何修改，可以把&quot;变更&quot;的风险降低到最低。</p> <p>总结：所谓的依赖倒置中的倒置，指的是原本司机开什么车是由司机决定的，但是现在是由接口接收的注入对象决定的。</p> <h1 id="git"><a href="#git" class="header-anchor">#</a> GIT</h1> <blockquote><p>源代码管理仓库</p></blockquote> <p>常用命令</p> <blockquote><p>git clone 克隆链接：将线上项目克隆下来</p></blockquote> <h1 id="一些更加方便的写法"><a href="#一些更加方便的写法" class="header-anchor">#</a> 一些更加方便的写法</h1> <blockquote><p>ForEach（Action）</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code>List<span class="token punctuation">.</span><span class="token function">ForEach</span><span class="token punctuation">(</span>x<span class="token operator">=&gt;</span>x<span class="token punctuation">.</span>name<span class="token operator">=</span>'admin'<span class="token punctuation">)</span><span class="token punctuation">;</span>

List<span class="token punctuation">.</span><span class="token function">ForEach</span><span class="token punctuation">(</span>x<span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    x<span class="token punctuation">.</span>name<span class="token operator">=</span>'admin'<span class="token punctuation">;</span>
    x<span class="token operator">=&gt;</span>x<span class="token punctuation">.</span>age<span class="token operator">=</span><span class="token number">18</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
List<span class="token punctuation">.</span><span class="token function">ForEach</span><span class="token punctuation">(</span>x<span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>age<span class="token operator">&gt;</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        x<span class="token punctuation">.</span>istrue<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="datetime"><a href="#datetime" class="header-anchor">#</a> DateTime</h1> <div class="language-csharp extra-class"><pre class="language-csharp"><code>DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">&quot;yyMMdd HHmmss&quot;</span><span class="token punctuation">)</span> <span class="token comment">//以指定形式格式化时间</span>
</code></pre></div><h1 id="支付宝支付"><a href="#支付宝支付" class="header-anchor">#</a> 支付宝支付</h1> <h2 id="公共响应参数"><a href="#公共响应参数" class="header-anchor">#</a> 公共响应参数</h2> <table><thead><tr><th style="text-align:left;">参数</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">是否必选</th> <th style="text-align:left;">最大长度</th> <th style="text-align:left;">描述</th> <th style="text-align:left;">示例值</th></tr></thead> <tbody><tr><td style="text-align:left;">code</td> <td style="text-align:left;">String</td> <td style="text-align:left;">必选</td> <td style="text-align:left;">-</td> <td style="text-align:left;">网关返回码,<a href="https://opendoc.alipay.com/common/02km9f" target="_blank" rel="noopener noreferrer">详见文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">40004</td></tr> <tr><td style="text-align:left;">msg</td> <td style="text-align:left;">String</td> <td style="text-align:left;">必选</td> <td style="text-align:left;">-</td> <td style="text-align:left;">网关返回码描述,<a href="https://opendoc.alipay.com/common/02km9f" target="_blank" rel="noopener noreferrer">详见文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">Business Failed</td></tr> <tr><td style="text-align:left;">sub_code</td> <td style="text-align:left;">String</td> <td style="text-align:left;">可选</td> <td style="text-align:left;">-</td> <td style="text-align:left;">业务返回码，参见具体的API接口文档</td> <td style="text-align:left;">ACQ.TRADE_HAS_SUCCESS</td></tr> <tr><td style="text-align:left;">sub_msg</td> <td style="text-align:left;">String</td> <td style="text-align:left;">可选</td> <td style="text-align:left;">-</td> <td style="text-align:left;">业务返回码描述，参见具体的API接口文档</td> <td style="text-align:left;">交易已被支付</td></tr> <tr><td style="text-align:left;">sign</td> <td style="text-align:left;">String</td> <td style="text-align:left;">必选</td> <td style="text-align:left;">-</td> <td style="text-align:left;">签名,<a href="https://opendoc.alipay.com/common/02kf5q" target="_blank" rel="noopener noreferrer">详见文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td style="text-align:left;">DZXh8eeTuAHoYE3w1J+POiPhfDxOYBfUNn1lkeT/V7P4zJdyojWEa6IZs6Hz0yDW5Cp/viufUb5I0/V5WENS3OYR8zRedqo6D+fUTdLHdc+EFyCkiQhBxIzgngPdPdfp1PIS7BdhhzrsZHbRqb7o4k3Dxc+AAnFauu4V6Zdwczo=</td></tr></tbody></table> <h1 id="发送qq邮箱"><a href="#发送qq邮箱" class="header-anchor">#</a> 发送QQ邮箱</h1> <blockquote><p>获取授权码</p></blockquote> <p>进入QQ邮箱主页，点击左上角设置==》账户==》在SMTP服务点击开启服务获取到授权码</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Net<span class="token punctuation">.</span>Mail</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Net</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token return-type class-name">JsonResult</span> <span class="token function">sendEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">MailMessage</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MailMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//收件人地址</span>
    message<span class="token punctuation">.</span>To<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;3208446980@qq.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//发件人地址 不用加，加了自己也会收到一份信息</span>
    <span class="token comment">//message.CC.Add(&quot;1357265300@qq.com&quot;);</span>
    <span class="token comment">//发件人邮箱，名称</span>
    message<span class="token punctuation">.</span>From <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MailAddress</span><span class="token punctuation">(</span><span class="token string">&quot;1357265300@qq.com&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//邮件标题和内容</span>
    message<span class="token punctuation">.</span>Subject <span class="token operator">=</span> <span class="token string">&quot;库存低于阈值&quot;</span><span class="token punctuation">;</span>
    message<span class="token punctuation">.</span>SubjectEncoding <span class="token operator">=</span> System<span class="token punctuation">.</span>Text<span class="token punctuation">.</span>Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">;</span><span class="token comment">//格式为utf-8</span>
    message<span class="token punctuation">.</span>Body <span class="token operator">=</span> <span class="token string">&quot;你有库存低于阈值&quot;</span><span class="token punctuation">;</span>
    message<span class="token punctuation">.</span>BodyEncoding <span class="token operator">=</span> System<span class="token punctuation">.</span>Text<span class="token punctuation">.</span>Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">;</span><span class="token comment">//格式为utf-8</span>

    <span class="token comment">//                                    SMTP服务器地址   （SMTP端口）qq邮箱587</span>
    <span class="token class-name">SmtpClient</span> smtpClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SmtpClient</span><span class="token punctuation">(</span><span class="token string">&quot;smtp.qq.com&quot;</span><span class="token punctuation">,</span> <span class="token number">587</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    smtpClient<span class="token punctuation">.</span>UseDefaultCredentials <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token comment">//启用SSL加密</span>
    smtpClient<span class="token punctuation">.</span>EnableSsl <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token comment">//发件人邮箱账号，授权码</span>
    smtpClient<span class="token punctuation">.</span>Credentials <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">NetworkCredential</span><span class="token punctuation">(</span><span class="token string">&quot;1357265300@qq.com&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;rdoxtruusumphgef&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">try</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//发送邮件</span>
        smtpClient<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">Json</span><span class="token punctuation">(</span><span class="token string">&quot;true&quot;</span><span class="token punctuation">,</span>JsonRequestBehavior<span class="token punctuation">.</span>AllowGet<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">Json</span><span class="token punctuation">(</span><span class="token string">&quot;error:&quot;</span> <span class="token operator">+</span> ex<span class="token punctuation">.</span>Message<span class="token punctuation">,</span> JsonRequestBehavior<span class="token punctuation">.</span>AllowGet<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>UseDefaultCredentials：是否使用当前已登录用户的 Windows 凭据来进行身份验证。如果将此属性设置为true，则SMTP客户端将使用当前已登录用户的 Windows 凭据来进行身份验证，而无需在代码中指定用户名和密码。</p></blockquote> <h1 id="定时调度"><a href="#定时调度" class="header-anchor">#</a> 定时调度</h1> <blockquote><p>Quartz.NET： 一个最简单任务至少包括三部分实现：job(作业),trigger（触发器）以及scheduler(调度器)。其中job 是你需要在一个定时任务中具体执行的业务逻辑，trigger则规定job何时并按照何种规则执行，最终job和trigger会被注册到 scheduler(调度器)中，scheduler负责协调job和trigger的运行。</p></blockquote> <blockquote><p>简单使用</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">AutoTimer</span><span class="token punctuation">(</span><span class="token class-name">IContainer</span> container<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//创建任务调度器</span>
    <span class="token class-name">ISchedulerFactory</span> schedulerFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StdSchedulerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">IScheduler</span> scheduler <span class="token operator">=</span> <span class="token keyword">await</span> schedulerFactory<span class="token punctuation">.</span><span class="token function">GetScheduler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//使用autofacJobFactory代替默认的JobFactory，并传入autofac容器实例(如果在任务中需要进行依赖注入则需要配置)</span>
    scheduler<span class="token punctuation">.</span>JobFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">AutoFacJobFactory</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//创建一个作业</span>
    <span class="token class-name">IJobDetail</span> job <span class="token operator">=</span> JobBuilder<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Create</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>SendSalary<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">WithIdentity</span><span class="token punctuation">(</span><span class="token string">&quot;myjob&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//创建一个触发器</span>
    <span class="token class-name">ITrigger</span> trigger <span class="token operator">=</span> TriggerBuilder<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">WithIdentity</span><span class="token punctuation">(</span><span class="token string">&quot;myjob&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">StartNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//现在开始</span>
        <span class="token punctuation">.</span><span class="token function">WithSimpleSchedule</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span><span class="token function">WithIntervalInSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">RepeatForever</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//10s执行一次,无限循环执行</span>
        <span class="token comment">//.WithCronSchedule(&quot;0 0 10 1 * ? &quot;)  //每个月的1号上午10点触发</span>
        <span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//将作业，触发器加入调度器</span>
    <span class="token keyword">await</span> scheduler<span class="token punctuation">.</span><span class="token function">ScheduleJob</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span> trigger<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//启动</span>
    <span class="token keyword">await</span> scheduler<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>QuartzJob.cs</code></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QuartzJob</span>
<span class="token punctuation">{</span>
    <span class="token comment">//定时发放薪水</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SendSalary</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IJob</span></span>
    <span class="token punctuation">{</span>
        <span class="token comment">//依赖注入，注意:在Job中使用DI得在Global中进行注册替换</span>
        <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">IStaffService</span> _staffService<span class="token punctuation">;</span>
        
        <span class="token keyword">public</span> <span class="token function">SendSalary</span><span class="token punctuation">(</span><span class="token class-name">IStaffService</span> staffService<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
			_staffService <span class="token operator">=</span> staffService<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">Execute</span><span class="token punctuation">(</span><span class="token class-name">IJobExecutionContext</span> context<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> description <span class="token operator">=</span> context<span class="token punctuation">.</span>JobDetail<span class="token punctuation">.</span>Description<span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">var</span></span> identity <span class="token operator">=</span> context<span class="token punctuation">.</span>JobDetail<span class="token punctuation">.</span>Key<span class="token punctuation">.</span>Name<span class="token punctuation">;</span>
            <span class="token comment">//需要执行的任务逻辑</span>
            System<span class="token punctuation">.</span>IO<span class="token punctuation">.</span>File<span class="token punctuation">.</span><span class="token function">AppendAllText</span><span class="token punctuation">(</span><span class="token string">@&quot;C:\A\a.txt&quot;</span><span class="token punctuation">,</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>使用DI需要的配置方法</strong></p> <p><code>AutoFacJobFactory.cs</code></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AutoFacJobFactory</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IJobFactory</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">IContainer</span> _container<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">AutoFacJobFactory</span><span class="token punctuation">(</span><span class="token class-name">IContainer</span> container<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _container <span class="token operator">=</span> container<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">IJob</span> <span class="token function">NewJob</span><span class="token punctuation">(</span><span class="token class-name">TriggerFiredBundle</span> bundle<span class="token punctuation">,</span> <span class="token class-name">IScheduler</span> scheduler<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>IJob<span class="token punctuation">)</span>_container<span class="token punctuation">.</span><span class="token function">Resolve</span><span class="token punctuation">(</span>bundle<span class="token punctuation">.</span>JobDetail<span class="token punctuation">.</span>JobType<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ReturnJob</span><span class="token punctuation">(</span><span class="token class-name">IJob</span> job<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>Global.asax.cs</code></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Application_Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    AreaRegistration<span class="token punctuation">.</span><span class="token function">RegisterAllAreas</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    RouteConfig<span class="token punctuation">.</span><span class="token function">RegisterRoutes</span><span class="token punctuation">(</span>RouteTable<span class="token punctuation">.</span>Routes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token comment">//配置autofac容器</span>
    <span class="token class-name">IContainer</span> container <span class="token operator">=</span> <span class="token function">AutofacRegister</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//定时调度</span>
    <span class="token function">AutoTimer</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//注册容器</span>
<span class="token keyword">private</span> <span class="token return-type class-name">IContainer</span> <span class="token function">AutofacRegister</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token comment">//注册工作</span>
    builder<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">RegisterType</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>SendSalary<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">AsSelf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">InstancePerDependency</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//薪资发放工作</span>
	<span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword">return</span> container<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//定时调度</span>
<span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">AutoTimer</span><span class="token punctuation">(</span><span class="token class-name">IContainer</span> container<span class="token punctuation">)</span>
<span class="token punctuation">{</span>

    <span class="token comment">//创建任务调度器</span>
    <span class="token class-name">ISchedulerFactory</span> schedulerFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StdSchedulerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">IScheduler</span> scheduler <span class="token operator">=</span> <span class="token keyword">await</span> schedulerFactory<span class="token punctuation">.</span><span class="token function">GetScheduler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//使用autofacJobFactory代替默认的JobFactory，并传入autofac容器实例</span>
    scheduler<span class="token punctuation">.</span>JobFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">AutoFacJobFactory</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//创建一个作业</span>
    <span class="token class-name">IJobDetail</span> job <span class="token operator">=</span> JobBuilder<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Create</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>SendSalary<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">WithIdentity</span><span class="token punctuation">(</span><span class="token string">&quot;myjob&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//创建一个触发器</span>
    <span class="token class-name">ITrigger</span> trigger <span class="token operator">=</span> TriggerBuilder<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">WithIdentity</span><span class="token punctuation">(</span><span class="token string">&quot;myjob&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">StartNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//现在开始</span>
        <span class="token punctuation">.</span><span class="token function">WithSimpleSchedule</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span><span class="token function">WithIntervalInSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">RepeatForever</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//10s执行一次,无限循环执行</span>
        <span class="token comment">//.WithCronSchedule(&quot;0 0 10 1 * ? &quot;)  //每个月的1号上午10点触发</span>
        <span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//将作业，触发器加入调度器</span>
    <span class="token keyword">await</span> scheduler<span class="token punctuation">.</span><span class="token function">ScheduleJob</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span> trigger<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//启动</span>
    <span class="token keyword">await</span> scheduler<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>tips</strong></p> <ol><li>格式: [秒] [分] [小时] [日] [月] [周] [年]</li></ol> <table><thead><tr><th>说明</th> <th>是否必填</th> <th>允许填写的值</th> <th>允许的通配符</th> <th></th></tr></thead> <tbody><tr><td>1</td> <td>秒</td> <td>是</td> <td>0-59</td> <td>, - * /</td></tr> <tr><td>2</td> <td>分</td> <td>是</td> <td>0-59</td> <td>, - * /</td></tr> <tr><td>3</td> <td>小时</td> <td>是</td> <td>0-23</td> <td>, - * /</td></tr> <tr><td>4</td> <td>日</td> <td>是</td> <td>1-31</td> <td>, - * ? / L W</td></tr> <tr><td>5</td> <td>月</td> <td>是</td> <td>1-12 or JAN-DEC</td> <td>, - * /</td></tr> <tr><td>6</td> <td>周</td> <td>是</td> <td>1-7 or SUN-SAT</td> <td>, - * ? / L #</td></tr> <tr><td>7</td> <td>年</td> <td>否</td> <td>empty 或 1970-2099</td> <td>, - * /</td></tr></tbody></table> <p><strong>常用示例:</strong></p> <p>格式: [秒] [分] [小时] [日] [月] [周] [年]</p> <p>0 0 12 * * ?      每天12点触发
0 15 10 ? * *     每天10点15分触发
0 15 10 * * ?     每天10点15分触发
0 15 10 * * ? *    每天10点15分触发
0 15 10 * * ? 2005   2005年每天10点15分触发
0 * 14 * * ?      每天下午的 2点到2点59分每分触发
0 0/5 14 * * ?     每天下午的 2点到2点59分(整点开始，每隔5分触发)
0 0/5 14,18 * * ?    每天下午的 18点到18点59分(整点开始，每隔5分触发)</p> <p>0 0-5 14 * * ?      每天下午的 2点到2点05分每分触发
0 10,44 14 ? 3 WED     3月分每周三下午的 2点10分和2点44分触发
0 15 10 ? * MON-FRI    从周一到周五每天上午的10点15分触发
0 15 10 15 * ?       每月15号上午10点15分触发
0 15 10 L * ?       每月最后一天的10点15分触发
0 15 10 ? * 6L      每月最后一周的星期五的10点15分触发
0 15 10 ? * 6L 2002-2005 从2002年到2005年每月最后一周的星期五的10点15分触发</p> <p>0 15 10 ? * 6#3      每月的第三周的星期五开始触发
0 0 12 1/5 * ?      每月的第一个中午开始每隔5天触发一次
0 11 11 11 11 ?      每年的11月11号 11点11分触发(光棍节)</p> <h1 id="mongodb设置局域网可连接"><a href="#mongodb设置局域网可连接" class="header-anchor">#</a> MongoDB设置局域网可连接</h1> <blockquote><p>一、管理员运行cmd命令行进入MongoDB的bin文件夹</p></blockquote> <blockquote><p>二、执行<code>mongod --remove</code>关闭MongoDB服务</p></blockquote> <blockquote><p>三、修改bin文件夹中的mongod.cfg文件中的bindIp为0.0.0.0</p></blockquote> <blockquote><p>四、命令行中执行<code>mongod --config D:\mongoDB\bin\mongod.cfg --logpath D:\mongoDB\log\mongod.log --logappend --dbpath D:\mongoDB\data --serviceName MongoDB --install</code> 安装mongoDB服务</p> <p><strong>如果报错路径不对，把log文件夹中的mongod.log删除了重新执行</strong></p></blockquote> <blockquote><p>五、命令行中执行<code>net start MongoDB</code>启动mongoDB服务</p></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.65a534cf.js" defer></script><script src="/blog/assets/js/2.9b17f659.js" defer></script><script src="/blog/assets/js/10.b6e5bbc7.js" defer></script>
  </body>
</html>
